#IFDEF WINDOWS
	#INCLUDE "FiveWin.ch"
#ENDIF
/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcao    ³LocXFat   ³ Autor ³Bruno Sobieski         ³ Data ³28.04.99   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Esta funcao agrupa todas as fun‡oes usadas especificamente   ³±±
±±³          ³pelo departamento de Localiza‡oes no modulo de Faturamento.  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ ATUALIZACOES SOFRIDAS DESDE A CONSTRUCAO INICIAL.                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ PROGRAMADOR  ³ DATA   ³ BOPS ³  MOTIVO DA ALTERACAO                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Bruno Sobieski³26.07.99³Melhor³Considerar se foi usado remito na atuali-³±±
±±³              ³        ³      ³zacao da QTD entregue (a460atuarg()).    ³±±
±±³Bruno Sobieski³15.12.09³Melhor³Inclusao de ponto de entrada M468SD2.    ³±±
±±³Lucas         ³07.04.00³Acerto³Substituir a variavel nModulo por cModu- ³±±
±±³              ³        ³      ³lo (Torna se mas clara para alteracoes)  ³±±
±±³Lucas         ³21.04.00³16262A³Tratamento de Consignacao e Exportacao   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡Æo    ³A460AtuArg³ Autor ³Jos‚ Lucas             ³ Data ³ 05/08/98 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡Æo ³ Atualizacoes de Saldos,Custos,Pedidos Poder 3 Argentina.   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ A460AtuArg()                                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso       ³ MATA460                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A460AtuArg(aCusto,nQuant,nItemValTot,nFreteItem,cSeqLibC9,cLoteCtl,cNumLote)
Local cRemito := Space(12)
Local cPedido := Space(6)
Local nQtdBaixa:=0,nQtdFat:=0
Local cNum, nRec:=0,lGped:=.F.
Local cMes := " "
Local aCM:={}, aEnvCus:={}

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verificar a Existencia de Remito de Sa¡da.      	³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
cRemito  := If(lJunta,TRB->CZ_REMITO,SCZ->CZ_REMITO)
cPedido  := If(lJunta,TRB->CZ_PEDIDO,SCZ->CZ_PEDIDO)
cTipoRem := If(lJunta,TRB->CZ_TIPOREM,SCZ->CZ_TIPOREM)

If SF4->F4_ESTOQUE == "S"
   If Empty(SD2->D2_REMITO) .Or. cTipoRem	==	"1"
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ S¢ movientar stock, cuando Cliente nao for Exportacao.   	³
		//ÀÄLucas Kluber ArgentinaÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If SA1->A1_TIPO != "E" //Cliente Exportacao Nao Mover Estoque 
	      If Empty(SC5->C5_NUMPROF)
   	      aEnvCus:={nItemValTot+nFreteItem,aImpCusto,0.00,;
      	               " "," ",SD2->D2_NFORI,SD2->D2_SERIORI,;
         	            SD2->D2_COD,SD2->D2_LOCAL,SD2->D2_QUANT,0.00}

		         IF SF4->F4_PODER3 == "D"
   		         aCM    := PegaCMAtu(SD2->D2_COD,SD2->D2_LOCAL,"D", aEnvCus)
      		   Else
         		   aCM    := PegaCMAtu(SD2->D2_COD,SD2->D2_LOCAL,SD2->D2_TIPO, aEnvCus)
	         	Endif

   	      	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
      	   	//³ Grava o custo da nota fiscal de entrada           ³
         		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	         	aCusto := GravaCusD2(aCM,IIF(SF4->F4_PODER3 == "D","D",SD2->D2_TIPO))

   	      	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
      	   	//³ Atualiza o saldo final (VFIM) com os dados do SD2 ³
         		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	         	B2AtuComD2(aCusto)


	         nQtdFat:= SD2->D2_QUANT

   	      //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
      	   //³ So efetuar o controle de Poder de Terceiros se n„o houver           ³
         	//³ Remito, Se existir o Controle j  foi efetuado na Gera‡„o do Remito. ³
	         //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
  	      	dbSelectArea("SB2")
     	   	RecLock("SB2",.F.)
   	      If SD2->D2_TIPO=='N'
      	      If SF4->F4_PODER3=='D'
         	      Replace B2_QTNP  With B2_QTNP-SD2->D2_QUANT
            	ElseIf SF4->F4_PODER3=='R'
               	Replace B2_QNPT  With B2_QNPT+SD2->D2_QUANT
	            EndIf
         	ElseIf SD2->D2_TIPO=='B'
   		      If SF4->F4_PODER3=='R'
            	   Replace B2_QNPT  With B2_QNPT+SD2->D2_QUANT
            	ElseIf SF4->F4_PODER3=='D'
               	Replace B2_QTNP  With B2_QTNP-SD2->D2_QUANT
            	EndIf
         	EndIf
				MsUnLock()
      	Endif
      	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
      	//³ Atualiza o arquivo de Demandas SB3 com dados SD2. ³
      	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		EndIf
	Else
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ So efetuar o controle de Poder de Terceiros se n„o houver           ³
		//³ Remito, Se existir o Controle j  foi efetuado na Gera‡„o do Remito. ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If cTipoRem $ "1"
		
			cCodConsig := SD2->D2_COD
			cLocConsig := SCN->CN_LOCDEST
			If Empty(cLocConsig)
				cLocConsig := GetMV("MV_PODER3")
			EndIf	

			dbSelectArea("SB2")
			If dbSeek(xFilial("SB2")+cCodConsig+cLocConsig)
			
				aEnvCus:={nItemValTot+nFreteItem,aImpCusto,0.00,;
      	             " "," ",SD2->D2_NFORI,SD2->D2_SERIORI,;
                      cCodConsig,cLocConsig,SD2->D2_QUANT,0.00}

         	aCM := PegaCMAtu(cCodConsig,cLocConsig,SD2->D2_TIPO, aEnvCus)

  	      	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
     	   	//³ Grava o custo da nota fiscal de entrada           ³
        		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				aCusto := GravaCusD2(aCM,IIF(SF4->F4_PODER3 == "D","D",SD2->D2_TIPO))

   	      //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
      	   //³ Atualiza o saldo final (VFIM) com os dados do SD2 ³
         	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	         B2AtuComD2(aCusto)
			EndIf
		EndIf						
	EndIf
	
  	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
  	//³ Atualiza o arquivo de Demandas SB3 com dados SD2. ³
  	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
   If !(SD2->D2_TIPO $ "DB")
      cMes := "B3_Q"+StrZero(Month(SD2->D2_EMISSAO),2)
      dbSelectArea("SB3")
      dbSeek( xFilial("SB3")+SD2->D2_COD)
      If !Found()
         RecLock("SB3",.T.)
         Replace B3_FILIAL With xFilial("SB3"), B3_COD With SD2->D2_COD
      Else
         RecLock("SB3",.F.)
      EndIf
      If SD2->D2_TES <= "500"
         Replace &(cMes) With &(cMes) - SD2->D2_QUANT
      Else
         Replace &(cMes) With &(cMes) + SD2->D2_QUANT
      EndIf
      Replace B3_MES With SD2->D2_EMISSAO
      MsUnLock()
	EndIf	
Else
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ So efetuar o controle de Poder de Terceiros se n„o houver           ³
	//³ Remito, Se existir o Controle j  foi efetuado na Gera‡„o do Remito. ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If Empty(cRemito)
		aCusto := {0,0,0,0,0}
		If SF4->F4_PODER3 $ 'DR'
			dbSelectArea("SB2")
			dbSetOrder(1)
			dbSeek(cFilial+SD2->D2_COD+SD2->D2_LOCAL)
			If Found()
				RecLock("SB2",.F.)
			Else
				CriaSB2(SD2->D2_COD,SD2->D2_LOCAL)
			Endif
			If SF4->F4_PODER3 == "D"
				Replace B2_QTER  With B2_QTER-SD2->D2_QUANT
			Else
				Replace B2_QTER  With B2_QTER+SD2->D2_QUANT
			Endif
		EndIf
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Grava qtde entregue do pedido					  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
DbSelectArea("SC6")
RecLock("SC6",.F.)
If Empty(cRemito)
	If ! SA1->A1_TIPO $ "E"
		Replace 	C6_QTDENT With C6_QTDENT + nQuant,;
					C6_QTDEMP With C6_QTDEMP - nQuant
	EndIf
	Replace 	C6_NOTA	 With cNumero
	//Bruno Cremaschi - Projeto chave única.
	//Replace		C6_SERIE  With cSerie
	SerieNFID("SC6", 1, "C6_SERIE",dDataBase, cEspecie,cSerie)
	Replace		C6_DATFAT With dDataBase
ElseIf !Empty(cPedido)
	Replace	C6_NOTA	 With cNumero
	//Bruno Cremaschi - Projeto chave única.
	//Replace C6_SERIE  With cSerie
	SerieNFID("SC6", 1, "C6_SERIE",dDataBase, cEspecie,cSerie)
	Replace C6_DATFAT With dDataBase
EndIf
MsUnLock()

If ! Empty(cRemito)
   If ! Empty(cPedido)
      nRec := Recno()
      lGPed:=.T.
      dbSelectArea("SC6")
      dbSetOrder(1)
		If dbSeek(xFilial("SC6")+cPedido)
      	While !Eof() .And. C6_NUM==cPedido
         	If C6_QTDVEN > C6_QTDENT
            	lGPed := .F.
         	EndIf
         	dbSkip()
      	End
      	dbGoto(nRec)
      	If lGPed
         	dbSelectArea("SC5")
         	If dbSeek(xFilial("SC5")+cPedido)
            	RecLock("SC5",.F.)
            	Replace SC5->C5_NOTA  with cNumero
            	//Bruno Cremaschi - Projeto chave única.
            	//Replace SC5->C5_SERIE with cSerie
            	SerieNFID("SC5", 1, "C5_SERIE",dDataBase, cEspecie,cSerie)
            	MsUnlock()
         	EndIf
      	EndIf
		EndIf	
   EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Gera Lancamento Controle Poder Terceiros 			³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Empty(cRemito)
	If SC5->C5_TIPO $ 'NB' .and. SF4->F4_PODER3 $ 'RD'
		aCpoSD[01]:=SD2->D2_CLIENTE
		aCpoSD[02]:=SD2->D2_LOJA
		aCpoSD[03]:=SD2->D2_COD
		aCpoSD[04]:=SD2->D2_LOCAL
		aCpoSD[05]:=SD2->D2_PRCVEN
		aCpoSD[06]:="E"
		aCpoSD[07]:=SD2->D2_DOC
		aCpoSD[08]:=SD2->D2_SERIE
		aCpoSD[09]:=SD2->D2_EMISSAO
		aCpoSD[10]:=SD2->D2_EMISSAO
		aCpoSD[11]:=SD2->D2_CF
		aCpoSD[12]:=SD2->D2_QUANT
		aCpoSD[13]:=SD2->D2_UM
		aCpoSD[14]:=SD2->D2_QTSEGUM
		aCpoSD[15]:=SD2->D2_SEGUM
		aCpoSD[16]:=""
		aCpoSD[17]:=SD2->D2_NUMSEQ
		cChaveSB6 := SD2->D2_IDENTB6+SD2->D2_COD
		AtuaSB6(SD2->D2_TES,cChaveSB6,aCpoSD,aCusto,SC5->C5_TIPO)
	Endif

	If SF4->F4_PODER3 == "R"
		reclock("SD2",.f.)
		Replace SD2->D2_IDENTB6 With SB6->B6_IDENT
		msunlock()	
	Endif
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de entrada, para atualizar os Remitos de Vendas ³
//³ utiliza‡„o na Internacionaliza‡„o (Argentina).        ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄLucasÄÙ
If FindFunction("M460GRAV") .and. cModulo != "LOJ"
	//Bruno Cremaschi - Projeto chave única.
	cSerieId := SerieNFID("SC9", 4, "C9_SERIE",dDataBase, cEspecie,cSerie) // Retorna o id do campo série para o ponto de entrada.
	ExecBlock( "M460GRAV",.F.,.F., { SC9->C9_REMITO, SC9->C9_ITEMREM, cNumero, cSerieId } )
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de entrada, para gravar o que for necesario     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("M468SD2")
   ExecBlock( "M468SD2" )
EndIf
Return

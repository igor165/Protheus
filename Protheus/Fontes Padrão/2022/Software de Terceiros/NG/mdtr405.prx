#INCLUDE "mdtr405.ch"
#Include "Protheus.ch"

#DEFINE _nVERSAO 3 //Versao do fonte
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ё MDTR405  Ё Autor Ё Marcio Costa          Ё Data Ё 10.01.00 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o ЁMedicamentos Necessarios                                    Ё╠╠
╠╠Ё          ЁLista os  registros da tabela de medicamentos (TM1),         ╠╠
╠╠Ё          Ёo Usuario podera listar todos ou apenas aqueles medicamentosЁ╠╠
╠╠Ё          Ёcom saldo atual menor do que o valor informado no campo     Ё╠╠
╠╠Ё          Ёquantidade minima em estoque.                               Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe e Ё MDTR405(void)                                              Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё Generico                                                   Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/
Function MDTR405()
//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Armazena variaveis p/ devolucao (NGRIGHTCLICK) 				  		  	  Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
Local aNGBEGINPRM := NGBEGINPRM(_nVERSAO)

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define Variaveis                                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
LOCAL wnrel   := "MDTR405"
LOCAL limite  := 132
LOCAL cDesc1  := STR0001 //"Relatorio de apresentacao dos medicamentos, o usuario podera listar todos"
LOCAL cDesc2  := STR0002 //"ou apenas aqueles com a quantidade atual em estoque menor do que a       "
LOCAL cDesc3  := STR0003 //"quantidade minima.   Opcao disponivel atraves do botao de  parametros.   "
LOCAL cString := "TM1"

PRIVATE nomeprog := "MDTR405"
PRIVATE tamanho  := "M"
PRIVATE aReturn  := { STR0008, 1,STR0004, 2, 2, 1, "",1 } //"Administracao" //"Zebrado"
PRIVATE titulo   := STR0005 //"Medicamentos"
PRIVATE ntipo    := 0
PRIVATE nLastKey := 0
PRIVATE cPerg    := "MDT405    "
PRIVATE cabec1, cabec2

If !MDTRESTRI(cPrograma)
	//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Devolve variaveis armazenadas (NGRIGHTCLICK) 			 			  Ё
	//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	NGRETURNPRM(aNGBEGINPRM)
	Return .F.
Endif
/*
//--------------------------------------------------------------
//PERGUNTAS PADRуES E PRESTADOR										|
|  MDT405    |1		|Medicamento De ?								|
|  MDT405    |2		|Medicamento Ate ?							|
|  MDT405    |3		|Imprimir(Todos/Itens abaixo do minimo)	|
//---------------------------------------------------------------
*/

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Verifica as perguntas selecionadas                           Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
pergunte(cPerg,.F.)
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Envia controle para a funcao SETPRINT                        Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
wnrel:="MDTR405"

wnrel:=SetPrint(cString,wnrel,cPerg,titulo,cDesc1,cDesc2,cDesc3,.F.,"")

If nLastKey == 27
	Set Filter to
	Return
Endif

SetDefault(aReturn,cString)

If nLastKey == 27
	Set Filter to
	Return
Endif

#IFDEF WINDOWS
    RptStatus({|lEnd| R405Imp(@lEnd,wnRel,titulo,tamanho)},titulo)
#ELSE
    R405Imp(.F.,wnRel,titulo,tamanho)
#ENDIF
//зддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Devolve variaveis armazenadas (NGRIGHTCLICK)                          Ё
//юддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
NGRETURNPRM(aNGBEGINPRM)
Return NIL
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤└o    Ё R405Imp  Ё Autor Ё Inacio Luiz Kolling   Ё Data Ё   /06/97 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤└o Ё Chamada do Relat╒rio                                       Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё MDTR405                                                    Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ
/*/

Static Function R405Imp(lEnd,wnRel,titulo,tamanho)

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Define Variaveis                                             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Variaveis para controle do cursor de progressao do relatorio Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Variaveis locais exclusivas deste programa                   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

LOCAL lContinua        := .T.
//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Variaveis tipo Private padrao de todos os relatorios         Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Contadores de linha e pagina                                 Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
PRIVATE li := 80 ,m_pag := 1

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Variaveis locais exclusivas deste programa                   Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
// PRIVATE

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Verifica se deve comprimir ou nao                            Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
nTipo  := IIF(aReturn[4]==1,15,18)

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Monta os Cabecalhos                                          Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

cabec1 := STR0009 //"Codigo           Nome Medicamento                        Qtde Atual   Qtde Minima     DiferenГa   Un.Med"
cabec2 := " " 
/*
          1         2         3         4         5         6         7         8         9         0         1         2         3
0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789012
Codigo           Nome Medicamento                      Quant. Atual  Quant. Minima     DiferenГa   Un.Med
----------------------------------------------------------------------------------------------------------
xxxxxxxxxxxxxxx  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  x.xxx.xxx,xx  x.xxx.xxx,xx  x.xxx.xxx,xx   xxxxxx
xxxxxxxxxxxxxxx  xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  x.xxx.xxx,xx  x.xxx.xxx,xx  x.xxx.xxx,xx   xxxxxx

*/
dbSelectArea("TM1")
dbSetOrder(01)
dbSeek(xFilial("TM1")+MV_PAR01,.T.)

SetRegua(LastRec())

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Correr TM1 para ler os  Medicamentos                     Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддды

While lContinua                                .And.;
      !Eof()                                   .AND.;
      TM1->TM1_FILIAL == xFIlial('TM1')        .AND.;
      TM1->TM1_CODMED <= MV_PAR02
        
        #IFNDEF WINDOWS
                If LastKey() = 286    //ALT_A
                        lEnd := .t.
                End
        #ENDIF

        If lEnd
                @ PROW()+1,001 PSay STR0007 //"CANCELADO PELO OPERADOR"
                Exit
        EndIf

    	IncRegua()
        If TM1->TM1_QTATUA < TM1->TM1_QTMINI .OR. mv_par03 = 1
                SomaLinha()
                @ Li,000 PSay TM1->TM1_CODMED
                @ Li,017 PSay SUBSTR(TM1->TM1_NOMEDI,1,30) 
                @ LI,055 PSay TM1->TM1_QTATUA  Picture "@E 9,999,999.99"
                @ Li,069 PSay TM1->TM1_QTMINI  Picture "@E 9,999,999.99"
                @ Li,084 PSay (TM1->TM1_QTATUA - TM1->TM1_QTMINI) Picture "@E 9,999,999.99"
                @ Li,099 PSay TM1->TM1_UNIDAD
        EndIf

        dbSelectArea("TM1")
        dbskip()

Enddo 

//EJECT

//Roda(nCntImpr,cRodaTxt,Tamanho)

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Devolve a condicao original do arquivo principal             Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
RetIndex("TM1")

Set Filter To

Set device to Screen

If aReturn[5] = 1
        Set Printer To
        dbCommitAll()
        OurSpool(wnrel)
Endif
//SET CENTURY ON
MS_FLUSH()


Return NIL
/*/
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠Ё Fun┤┘o   Ё SomaLinhaЁ Autor Ё Inacio Luiz Kolling   Ё Data Ё   /06/97 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠Ё Descri┤┘oЁ Incrementa Linha e Controla Salto de Pagina                Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Sintaxe  Ё SomaLinha()                                                Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁParametrosЁ                                                            Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё MDTR405                                                    Ё╠╠
╠╠юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
/*/
Static Function Somalinha()
    Li++
    If Li > 58
        Cabec(titulo,cabec1,cabec2,nomeprog,tamanho,nTipo)
    EndIf
Return
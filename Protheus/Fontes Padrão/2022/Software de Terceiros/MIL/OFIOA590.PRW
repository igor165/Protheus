// ÉÍÍÍÍÍÍÍÍËÍÍÍÍ»
// º Versao º 01 º
// ÈÍÍÍÍÍÍÍÍÊÍÍÍÍ¼

#Include "OFIOA590.CH"
#Include "PROTHEUS.CH"

/*
===============================================================================
###############################################################################
##+----------+------------+-------+-----------------------+------+----------+##
##|Funcao    | OFIOA590   | Autor | Rubens Takahashi      | Data | 25/11/15 |##
##+----------+------------+-------+-----------------------+------+----------+##
##|Descricao | Alteração da Senha do Tecnico para Comunicacao com a Fabrica |##
##+----------+--------------------------------------------------------------+##
##| Uso      | DMS                                                          |##
##+----------+--------------------------------------------------------------+##
###############################################################################
===============================================================================
*/
Function OFIOA590()

Private aRotina   := MenuDef()
Private cCadastro := STR0001 // "Senha para Comunicação com a Fábrica"
                                        
mBrowse( 6, 1,22,75,"VAI",,,,,,,,,,,,,, IIF( __cUserId == "000000" , "" , " VAI_CODUSR='"+__cUserId+"' " ) )

Return()

/*
===============================================================================
###############################################################################
##+----------+------------+-------+-----------------------+------+----------+##
##|Funcao    | OFIOA590A  | Autor | Rubens Takahashi      | Data | 25/11/15 |##
##+----------+------------+-------+-----------------------+------+----------+##
##|Descricao | Alteração da senha para comunicacao com a fabrica            |##
##+----------+--------------------------------------------------------------+##
##| Uso      | DMS                                                          |##
##+----------+--------------------------------------------------------------+##
###############################################################################
===============================================================================
*/
Function OFIOA590A()

Local aRetParam := {}
Local aParamBox := {}

DbSelectArea("VAI")

AADD(aParamBox,{1,RetTitle("VAI_FABUSR"),VAI->VAI_FABUSR,PesqPict("VAI","VAI_FABUSR"),"","",IIf( !Empty(VAI->VAI_FABUSR) , ".F." , ".T.") ,50,.T.})
AADD(aParamBox,{8,RetTitle("VAI_FABPWD"),Space(TamSX3("VAI_FABPWD")[1]),PesqPict("VAI","VAI_FABPWD"),"","","",50,.F.})

If !ParamBox(aParamBox,STR0002,@aRetParam,,,,,,,,.f.) // 'Alterar senha'
	Return .f.
EndIf

// Altera senha ... 
RecLock("VAI",.f.)
VAI->VAI_FABUSR := aRetParam[1]
VAI->VAI_FABPWD := aRetParam[2]
VAI->(MsUnlock())
// 

MsgInfo(STR0003,STR0004) // 'Senha alterada'

Return .t.

/*
===============================================================================
###############################################################################
##+----------+------------+-------+-----------------------+------+----------+##
##|Funcao    | MenuDef    | Autor | Rubens Takahashi      | Data | 25/11/15 |##
##+----------+------------+-------+-----------------------+------+----------+##
##| Uso      | DMS                                                          |##
##+----------+--------------------------------------------------------------+##
###############################################################################
===============================================================================
*/
Static Function MenuDef()
Local aRotina := {}
aRotina := {; 
	{ STR0005 , "AxPesqui"  , 0 , 1 },; // "Pesquisar"    
	{ STR0006 , "OFIOA590A" , 0 , 4 }}  // "Alterar Senha"
Return aRotina
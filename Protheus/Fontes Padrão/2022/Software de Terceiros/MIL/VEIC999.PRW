#INCLUDE "veic999.ch"
/*


Ŀ
 DATA    BOPS Prograd.ALTERACAO                                     
Ĵ
                                                                    
ٱ


*/

#Include "protheus.ch"
/*


Ŀ
Funcao     VEIC999   Autor  Alfredo Magalhaes      Data  28/12/99 
Ĵ
Descrio  Consulta as parcelas                                       
Ĵ
Sintaxe    VEIC999                                                    
Ĵ
 Uso       Generico                                                   
ٱ


*/
Function VEIC999()

Local cCondicao := Space(3)
Local nValTot := 0
Local aVenc	:= {}
Local nParcelas := 0
Local cFatura := ""
Local i := 0

Private nValFat := 0
Private cPrefixo := ""
Private aRotina :=	{	{ OemToAnsi(STR0001),"AxPesqui"  , 0 , 1 },; // //"Pesquisar"
						{ OemToAnsi(STR0002),"FA050Visua", 0 , 2 },; // //"Visualizar"
						{ OemToAnsi(STR0003),"FA290Aut"  , 0 , 3 },; // //"Selecionar"
						{ OemToAnsi(STR0004),"FA290Can"  , 0 , 6 } } // //"Cancelar"
Private aHeader	:= {}
Private aCols	:= {}

DEFINE MSDIALOG oDlg FROM	22,9 TO 177,453 TITLE OemToAnsi(STR0005) PIXEL //"Faturas a Pagar" //"Consulta as parcelas"

@ 004, 007 TO 036, 185 OF oDlg PIXEL
@ 038, 007 TO 070, 215 OF oDlg PIXEL

@ 020, 086 MSGET cCondicao	F3 "SE4" Valid VC999Con(cCondicao)	SIZE 33, 11 OF oDlg PIXEL
@ 054, 088 MSGET nValFat 	Picture "@E 9,999,999,999.99"    	SIZE 60, 11 OF oDlg PIXEL

@ 010, 042 SAY OemToAnsi(STR0006) SIZE 30, 7 OF oDlg PIXEL // //"Condicao de pagamento"
@ 044, 088 SAY OemToAnsi(STR0007) SIZE 50, 7 OF oDlg PIXEL // //"Valor da fatura"

DEFINE SBUTTON FROM 07, 191 TYPE 1 ACTION (nOpca:=1,IF(VC999Ok(),oDlg:End(),nOpca:=0)) ENABLE OF oDlg
DEFINE SBUTTON FROM 19, 191 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg

ACTIVATE MSDIALOG oDlg CENTERED

If nOpca == 0
	Return
EndIf

aVenc := Condicao(nValFat,cCondicao,0)

nParcelas := Len(aVenc)
aCols := GravaDup(nParcelas,cPrefixo,cFatura,nValFat,dDatabase,aVenc)


//Ŀ
// Mostra tela com as diversas parcelas				
//
nValTot := 0
For i :=1 To Len(aCols)
	nValTot += aCols[i][5]
Next i
nOpca := 0

DEFINE MSDIALOG oDlg2 TITLE OemToAnsi(STR0008) From 9,0 To 28,80 OF oMainWnd // //"Dados das parcelas"
@ 1.4 , 14		Say OemToAnsi(STR0006) //"Condio de Pagamento : " //"Condicao de pagamento"
@ 1.4 , 22		Say cCondicao
@ 1.4 , 27		Say OemToAnsi(STR0009) // //"Soma das parcelas"
@ 1.4 , 32		Say oValTot VAR nValTot Picture "@E 9,999,999,999.99" FONT oDlg2:oFont

oGet := MSGetDados():New(34,5,128,315,3,"VC999LinOk","VC999TudOk","",.T.)
ACTIVATE MSDIALOG oDlg2 ON INIT EnchoiceBar(oDlg2,{||nOpca:=1,if(oGet:TudoOk(),oDlg2:End(),nOpca := 0)},{||oDlg2:End()})

If nOpcA == 1
	MsgStop(STR0010) //"Pode gerar os titulos"
endif

Return (.T.)

/*

Ŀ
Funo	  VC999Con  Autor  Alfredo Magalhaes      Data  28/12/99 
Ĵ
Descrio  Verifica validade da condicao de pagamento                 
Ĵ
Sintaxe	  VC999Con(cCondicao)										  
Ĵ
 Uso		  VEIC999													  
ٱ


*/
Static Function VC999Con(cCondicao)
Local cAlias:=Alias(),lRet:=.T.

dbSelectArea("SE4")
dbSeek(cFilial+cCondicao)
IF !Found()
	Help(" ",1,"A150COND")
	lRet:=.F.
End

	dbSelectArea(cAlias)
Return lRet

/*

Ŀ
Funo	  VC999Ok	 Autor  Alfredo Magalhaes      Data  28/12/99 
Ĵ
Descrio  Exibe mensagem de OK para dados digitados         		  
Ĵ
Sintaxe	  VC999Ok()												  
Ĵ
 Uso		  VEIC999													  
ٱ


*/
Static Function VC999Ok()
Return (MsgYesNo(OemToAnsi(STR0011),OemToAnsi(STR0012))) //###"Ateno" //"Confirma Dados?"###"Atencao"

/*

Ŀ
Funo	 VC999LinOk Autor  Alfredo Magalhaes      Data  28/12/99 
Ĵ
Descrio  Confere se a linha digitada esta OK 						  
Ĵ
Sintaxe	  VC999LinOk()												  
Ĵ
 Uso		  VEIC999													  
ٱ


*/
FuncTion VC999LinOk()

If aCols[n,7]
	//Ŀ
	// Checa se no  uma linha Deletada.                   
	//
	Return .T.
Endif
IF aCols[n][1] != cPrefixo
	//Ŀ
	// Nao permite alterar PREFIXO !                        
	//
	Help(" ",1,"IGUALPREF")
	Return .f.
Endif

Return .T.

/*

Ŀ
Funo	 VC999TudOK Autor  Alfredo Magalhaes      Data  28/12/99 
Ĵ
Descrio  Verifica se aCols esta preenchida corretamente			  
Ĵ
Sintaxe	  VC999TudOk(ExpO1)										  
Ĵ
 Uso		  VEIC999   												  
ٱ


*/
Function VC999TudOk()

Local nX, nValTot := 0

For nx:=1 To Len(aCols)
	nValTot += aCols[nx][5]
Next nx

IF Str(nValFat,16,2) != Str(nValTot,16,2)
	Help(" ",1,"VALFAT1")
	Return .F.
End

oValTot:Refresh()
Return .T.

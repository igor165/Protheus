///Funcao    : EICDI410  
///Autor     : AVERAGE/ALEX WALLAUER 
///Data      : 06/09/00
///Descricao : Grava Item Extornado
///Sintaxe   : EICDI410 
///Uso       : PROTHEUS V508
#include "rwmake.ch"

*----------------------------------*
Function Eicpo411(ParamIXB)
*----------------------------------*
 
IF ParamIXB== 1
   lRetDI03:=PO420Cancela()
EndIF

If lRetDI03==Nil
   lRetDI03:=.T.
EndIf

Return(lRetDI03) 

*---------------------------------*
Static FUNCTION PO420Cancela()
*---------------------------------*
IF Work->WKSALDO_Q == Work->WKQTDE
   RETURN .T.
ENDIF

nAlias:=SELECT()
DBSELECTAREA('EI4')
nRecItPedidos:= SW3 ->(Recno())
nRecWork     := Work->(RECNO())

IF !EI4->(DBSEEK(xFilial('EI4')+TPO_NUM))
   EI4->(RecLock('EI4',.T.))
ELSE
   EI4->(RecLock('EI4',.F.))
ENDIF

EI4->EI4_FILIAL := xFilial('EI4')
AvReplace("SW2","EI4")
EI4->EI4_PO_NUM := SW2->W2_PO_NUM
EI4->EI4_PO_DT  := SW2->W2_PO_DT
EI4->EI4_NR_ALT := SW2->W2_NR_ALTE
EI4->EI4_DT_ALT := SW2->W2_DT_ALTE
EI4->EI4_FORN   := SW2->W2_FORN  
EI4->EI4_CLIENT := SW2->W2_CLIENTE
EI4->EI4_FOB_TO := SW2->W2_FOB_TOT
EI4->EI4_INLAND := SW2->W2_INLAND
EI4->EI4_DESCON := SW2->W2_DESCONT
EI4->EI4_PACKIN := SW2->W2_PACKING
EI4->EI4_OUT_DE := SW2->W2_OUT_DES
EI4->EI4_DT_IMP := SW2->W2_DT_IMP
EI4->EI4_NR_PRO := SW2->W2_NR_PRO
EI4->EI4_DT_PRO := SW2->W2_DT_PRO
EI4->EI4_TIPO_E := SW2->W2_TIPO_EM
EI4->EI4_ORIGEM := SW2->W2_ORIGEM
EI4->EI4_DEST   := SW2->W2_DEST  
EI4->EI4_FREPPC := SW2->W2_FREPPCC
EI4->EI4_FRETEI := SW2->W2_FRETEIN
EI4->EI4_COND_P := SW2->W2_COND_PA
EI4->EI4_DIAS_P := SW2->W2_DIAS_PA
EI4->EI4_AGENTE := SW2->W2_AGENTE
EI4->EI4_COMPRA := SW2->W2_COMPRA
EI4->EI4_PESO_B := SW2->W2_PESO_B
EI4->EI4_MOEDA  := SW2->W2_MOEDA 
EI4->EI4_DT_PAR := SW2->W2_DT_PAR
EI4->EI4_PARID  := SW2->W2_PARID_U 
EI4->EI4_FORWAR := SW2->W2_FORWARD
EI4->EI4_INCOTE := SW2->W2_INCOTER
EI4->EI4_IMPORT := SW2->W2_IMPORT
EI4->EI4_CONSIG := SW2->W2_CONSIG
EI4->EI4_OBS    := SW2->W2_OBS   
EI4->EI4_EMITID := SW2->W2_EMITIDO
EI4->EI4_DT_PC  := SW2->W2_DT_PC 
EI4->EI4_TAB_PC := SW2->W2_TAB_PC
EI4->EI4_STAT_P := SW2->W2_STAT_PC
EI4->EI4_DT_INT := SW2->W2_DT_INTE
EI4->EI4_EMISCC := SW2->W2_EMISCCA
EI4->EI4_NRCCAM := SW2->W2_NRCCAMB
EI4->EI4_RECCCA := SW2->W2_RECCCAM
EI4->EI4_BAN_RE := SW2->W2_BAN_REC
EI4->EI4_ENCARG := SW2->W2_ENCARGO
EI4->EI4_CORRET := SW2->W2_CORRETA
EI4->EI4_CUST_T := SW2->W2_CUST_TR
EI4->EI4_BANCO  := SW2->W2_BANCO 
EI4->EI4_AGENCI := SW2->W2_AGENCIA
EI4->EI4_TX_CAM := SW2->W2_TX_CAM
EI4->EI4_TX_DES := SW2->W2_TX_DESP
EI4->EI4_TX_RES := SW2->W2_TX_RESE
EI4->EI4_DESP_C := SW2->W2_DESP_CA
EI4->EI4_MOE_DE := SW2->W2_MOE_DES
EI4->EI4_FOB_AN := SW2->W2_FOB_ANT
EI4->EI4_LC_NUM := SW2->W2_LC_NUM
EI4->EI4_DES_IP := SW2->W2_DES_IPI
EI4->EI4_OK     := SW2->W2_OK    
EI4->EI4_CONF_P := SW2->W2_CONF_PE
EI4->EI4_EXPORT := SW2->W2_EXPORTA
EI4->EI4_COND_E := SW2->W2_COND_EX
EI4->EI4_DIAS_E := SW2->W2_DIAS_EX
EI4->EI4_E_LC   := SW2->W2_E_LC  
EI4->EI4_COMIS  := SW2->W2_COMIS 
EI4->EI4_TIP_CO := SW2->W2_TIP_COM
EI4->EI4_VAL_CO := SW2->W2_VAL_COM
EI4->EI4_PER_CO := SW2->W2_PER_COM
EI4->EI4_OUT_CO := SW2->W2_OUT_COM
EI4->EI4_COMPL  := SW2->W2_COMPL_I 
EI4->EI4_MT3    := SW2->W2_MT3   
EI4->EI4_REFCLI := SW2->W2_REFCLI
EI4->EI4_INTEGR := SW2->W2_INTEGRA
AvReplace("SW2","EI4")
EI4->(MsUnlock())
				
DBSELECTAREA('EI4')
EI5->(RecLock('EI5',.T.))
AvReplace("Work","EI5")
EI5->EI5_FILIAL :=  xFilial('EI5')
EI5->EI5_PO_NUM :=  TPO_NUM
EI5->EI5_CC     :=  Work->WKCC       
EI5->EI5_SI_NUM :=  Work->WKSI_NUM   
EI5->EI5_COD_I  :=  Work->WKCOD_I    
EI5->EI5_FLUXO  :=  Work->WKFLUXO
EI5->EI5_SEQ    :=  0
EI5->EI5_REG    :=  Work->WKREG      
EI5->EI5_FABR   :=  Work->WKFABR     
EI5->EI5_FORN   :=  Work->WKFORN     
EI5->EI5_QTDE   :=  Work->WKSALDO_Q
EI5->EI5_PRECO  :=  Work->WKPRECO    
EI5->EI5_SALDO  :=  Work->WKQTDE     
EI5->EI5_DT_EMB :=  Work->WKDT_EMB   
EI5->EI5_DT_ENT :=  Work->WKDT_ENTR  
EI5->EI5_POSICA :=  Work->WKPOSICAO  
EI5->EI5_REG_TR :=  Work->WK_REG_TRI
EI5->EI5_TEC    :=  Work->WK_TEC
EI5->EI5_EX_NCM :=  Work->WK_EX_NCM
EI5->EI5_EX_NBM :=  Work->WK_EX_NBM
EI5->EI5_DT_CAN :=  dDatabase
EI5->EI5_MOTIVO :=  Work->WKMOTIVO
EI5->(MsUnlock())

SELECT(nAlias)

SW3 ->(DBGOTO(nRecItPedidos))
Work->(DBGOTO(nRecWork))

RETURN .T.


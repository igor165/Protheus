#INCLUDE "MATA460.CH" 
#INCLUDE "PROTHEUS.CH"

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ MATA460	³ Autor ³ Claudinei M. Benzi     ³ Data ³ 15.01.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de geracao de Notas Fiscais	                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Generico 												   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ ATUALIZACOES SOFRIDAS DESDE A CONSTRUCAO INICIAL.                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ PROGRAMADOR  ³ DATA   ³ BOPS ³  MOTIVO DA ALTERACAO                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Edson   M.    ³06/01/99³XXXXXX³Inclusao do Ponto de Entrada M460COND.   ³±±
±±³Viviani       ³11/01/99³Melhor³Inclusao da FormBatch (Protheus)         ³±±
±±³Rodrigo Sarto ³19/01/99³19542A³Acerto na baixa de empenho do SB8        ³±±
±±³Viviani       ³28/01/99³16038A³Acerto no calculo de ipi na reducao.     ³±±
±±³Mauricio      ³02/02/99³19471A³Tratamento Inss                          ³±±
±±³Fernando Joly ³11/02/99³META  ³Tratamento das Movimenta‡”es do CQ.      ³±±
±±³Rodrigo Sarto.³11/02/99³XXXXXX³Acerto na funcao CriaSDB                 ³±±
±±³Viviani       ³24/02/99³18682A³Acerto na gravacao da comissao c/ aglut. ³±±
±±³Wagner        ³03/03/99³xxxxxx³Condicao para calculo do INSS            ³±±
±±³Wagner        ³05/03/99³xxxxxx³Implementacao do INSS por produto.       ³±±
±±³Andreia       ³12/03/99³19488A³Gravacao do campo F3_IPIOBS.             ³±±
±±³Aline         ³16/03/99³xxxxxx³Alteracao nos Locks do No. da NF         ³±±
±±³Eduardo       ³22/04/99³18950A³Alteracao das Aliquotas para poder de 3  ³±±
±±³Eduardo       ³27/04/99³Prothe³Alteracao da Pesquisa e Ordem para Prot. ³±±
±±³Edson   M.    ³27/04/99³XXXXXX³Disponibilizado ALIQIPI no PE M460IPI.   ³±±
±±³Bruno Sobieski³28/04/99³Melhor³Mudan‡a de Fun‡oes A460TesXIp() e        ³±±
±±³              ³        ³      ³A460AtuArg() para o FatXFun.PRX .        ³±±
±±³Aline C. Vale ³12/05/99³21367 ³Ver aliquotas de origem nas NFs Devolucao³±±
±±³Aline C. Vale ³13/05/99³19609 ³Calcular o Valor do ISS com NoRound      ³±±
±±³Eduardo       ³14/05/99³18950 ³Verificar C9_IDENTB6 p/localizar poder 3§³±±
±±³Edson   M.    ³14/05/99³XXXXXX³Inclusao do calculo do IPI Bruto ou Liq. ³±±
±±³Aline C. Vale ³19/05/99³21613 ³Setar ordem 1 antes do seek cliente/forn.³±±
±±³Fernando D.   ³10/06/99³xxxxx ³Acerto no parametro da Argentina         ³±±
±±³              ³        ³      ³nBasDup para nBaseDup                    ³±±
±±³Aline C. Vale ³15/06/99³21912 ³Criado MV_DATAINF p/ver se fatura quando ³±±
±±³              ³        ³      ³data de vencto < emissao (cond.pg tipo 9)³±±
±±³Andreia       ³16/06/99³21860A³Gravacao do campo F3_OBSERV quando devo- ³±±
±±³              ³        ³      ³lucao de diversas notas.                 ³±±
±±³Aline C. Vale ³24/06/99³22035 ³Se moeda do PV nao cadastrada,nao faturar³±±
±±³Aline C. Vale ³13/07/99³22974 ³AjustaSx1 p/emissao de Nota ou Cupom Fisc³±±
±±³Jose Lucas    ³15/07/99³19827A³Adapta‡”es realizadas na Argentina...    ³±±
±±³Jose Lucas    ³18/07/99³19827A³Tratamento da varivael cPaisLoc e dire-  ³±±
±±³              ³        ³      ³tiva de comipilacao #IFNDEF SPANISH      ³±±
±±³Bruno Sobieski³19/07/99³Melhor³Incluçao de #IFDEF WINDOWS e #IFDEF      ³±±
±±³              ³        ³      ³SPANISH nos BLocos de Localizações.      ³±±
±±³Aline C. Vale ³28/07/99³xxxxx ³Checagem do tipo da variavel lCond9      ³±±
±±³Wagner        ³28/07/99³xxxxx ³Desconsiderar icms retido do valor do SE1³±±
±±³              ³        ³      ³quando item nao gerar duplicata.         ³±±
±±³Aline C. Vale ³29/07/99³xxxxx ³Correcao do travamento do SC9 / TRB      ³±±
±±³Aline C. Vale ³02/08/99³21141 ³Nao somar IPI ao SE1 qdo F4_DUPL <> "S"  ³±±
±±³Aline C. Vale ³05/08/99³23170 ³Abater vlr. negativo do F2_VALMERC       ³±±
±±³Aline C. Vale ³16/08/99³14700/³14902 Calcular ICMS Solid.p/NF Devolucao ³±±
±±³Aline C. Vale ³24/08/99³14247 ³Gravacao do F2_PBRUTO igual C5_PBRUTO    ³±±
±±³Bruno Sobieski³30.08.99³16306A³So pegar a serie quando MV_FACTAUT=="S" e³±±
±±³              ³        ³      ³cPaisloc=="ARG".                         ³±±
±±³Bruno Sobieski³01.09.99³Melhor³Incluçao de cCalcImpV nos BLocos de Loc. ³±±
±±³Aline C. Vale ³02/09/99³Wagner³Truncar o Inss no Total e nao por Item   ³±±
±±³Paulo Augusto ³09/09/99³Melhor³Tratamento especifico do acrescimo finan-³±±
±±³              ³        ³      ³ceiro na Nota Fiscal para o Chile        ³±±
±±³Bruno Sobieski³09.09.99³Melhor³Modifica‡Æo de chamada de Execb. de Loc. ³±±
±±³Aline C. Vale ³24/09/99³xxxxxx³Considerar Excecao Fiscal p/ISS (FISXFUN)³±±
±±³Aline C. Vale ³08/10/99³23986 ³Tratamento para o F4_AGREG (I/N)         ³±±
±±³Aline C. Vale ³19/10/99³xxxxx ³Nao gravar F2_VALINSS < que MV_VLRETIN   ³±±
±±³Andreia       ³19/10/99³24594A³Acerto nos valores dos campos referentes ³±±
±±³              ³        ³      ³a ICMS Tributado e Isenta/Outras quando  ³±±
±±³              ³        ³      ³houver reducao de base de calculo.       ³±±
±±³Andreia       ³28/10/99³24462A³Quando material de consumo e base reduzi-³±±
±±³              ³        ³      ³da de ICMS, distribuir valor contabil da ³±±
±±³              ³        ³      ³seguinte maneira: base reduzida na coluna³±±
±±³              ³        ³      ³informada no TES; restante da base na co-³±±
±±³              ³        ³      ³luna oposta( isenta/Outras).             ³±±
±±³Denis Martins ³07.01.00³XXXXXX³Atualizacoes Gerais - Localizacoes Colom-³±±
±±³              ³        ³      ³bia e uso de cPaisLoc "COL".             ³±±
±±³Marcello      ³14.02.00³oooooo³Tratamento de retencoes de impostos para ³±±  
±±³              ³        ³      ³localizacoes Mexico                      ³±± 
±±³Leonardo      ³16/02/00³XXXXXX³Substituir diretiva SPANISH por cPaisLoc ³±±
±±³Patricia Sal. ³01/03/00³XXXXXX³Gravar campos D7_PRODUTO,D7_DOC,D7_SERIE,³±±
±±³              ³        ³      ³D7_FORNECE,D7_LOJA ao inves do D7_CHAVE  ³±± 
±±³Patricia Sal. ³05/05/00³003940³Acerto na Gravacao do campo F3_OBSERV    ³±± 
±±³              ³        ³      ³quando devolucao de diversas notas.      ³±±
±±³Norbert Waage ³16/05/07³125161³Altera status do orcamento do Televendas ³±± 
±±³              ³        ³      ³(SIGATMK) apos a geracao da NF.          ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MATA460
Return(MATA460A())

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A460AcumIt³ Autor ³ Claudinei M. Benzi    ³ Data ³ 11.02.92 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Inclui no aTots(array de itens da N.Fiscal)				  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA460													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A460AcumIt(aTots,nQuant,lReajuste,nVarDesc)
LOCAL nPrcVen, nPrcBrut, nItemValTot, nValBruto, nValOrig,nPrcTot
LOCAL nBItemInss
PRIVATE nPerIcm

dbSelectArea("SF4")
dbSetOrder(1)
dbSeek(xFilial()+SC6->C6_TES)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³  Posiciona o arquivo de Produto 		  -- SB1   	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SB1")
dbSetOrder(1)
dbSeek(xFilial()+SC6->C6_PRODUTO)

aExcecao:=ExcecFis(B1_GRTRIB,IF(SC5->C5_TIPO$"DB",,SA1->A1_GRPTRIB))
nPerIcm := AliqIcms(SC5->C5_TIPO,'S',SC5->C5_TIPOCLI)
If SF4->F4_ISS=='S'.and.SF4->F4_LFISS=="T"
	nPerISS:=nPerICM/100
   If (ExistBlock("M460ISS"))
      nPerIss := ExecBlock("M460ISS",.f.,.f.)
   Endif
Else
	nPerIss := 0
Endif
nPrcBrut:= IIF(!Empty(SC6->C6_PRUNIT),SC6->C6_PRUNIT,SC9->C9_PRCVEN)
nPrcVen := SC9->C9_PRCVEN
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³  Calcula acrescimo financeiro e reajuste  		  	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If !Empty(SC5->C5_REAJUST) .And. lReajuste
	nValOrig:= SC9->C9_PRCVEN
	nPrcVen := Formula(SC5->C5_REAJUST)
	nPrcBrut := nPrcVen
Endif

nVarDesc := nPrcVen / SC9->C9_PRCVEN	// O sistema nao usa mais nVarDesc

If SC5->C5_MOEDA > 1
	nPrcVen	:= xMoeda(nPrcVen,SC5->C5_MOEDA,1,dDataBase,nDecimal+4)
	nPrcBrut := xMoeda(nPrcBrut,SC5->C5_MOEDA,1,dDataBase,nDecimal+4)
	 //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	 //³ Ajustao Valor Em "N" Decimais Conforme MV_ARREFAT p/ Outras Moedas ³
	 //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	 If cMVARREFAT == "S"
		 nPrcVen  := Round(nPrcVen,nDecimal)
		 nPrcBrut := Round(nPrcBrut,nDecimal)
	 Else
		 nPrcVen  := NoRound(nPrcVen,nDecimal)
		 nPrcBrut := NoRound(nPrcBrut,nDecimal)
	 EndIf
Endif

If !Empty(nAcresFin) .And. SF4->F4_DUPLIC=="S"
	If cMVARREFAT=="S"
	 	nD2AcVal:= nPrcVen
		nPrcVen := Round(nPrcVen * (1+(nAcresFin/100)),nDecimal)
		nD2AcVal:= nPrcVen - nD2AcVal
	Else
	 	nD2AcVal:= nPrcVen
		nPrcVen := NoRound(nPrcVen * (1+(nAcresFin/100)),nDecimal)
		nD2AcVal:= nPrcVen - nD2AcVal
	EndIf
Else
	nD2AcVal := 0
Endif

If SC5->C5_MOEDA > 1 .and. SC5->C5_TIPO == "C"
	nPrcTot := xMoeda(SC6->C6_VALOR,SC5->C5_MOEDA,1,dDataBase)
Else
	nPrcTot := SC6->C6_VALOR
Endif

If cPaisLoc == "BRA"
	If SC5->C5_INCISS == "N" .and. SF4->F4_ISS!="N" .and. SC5->C5_TIPO == "N"
		nPrcVen := a410Arred(nPrcVen/(1-(nPerISS/100)),"D2_PRCVEN")
		nPrcTot := a410Arred((nPrcVen*nQuant)/(1-(nPerISS/100)),"D2_PRCVEN")
	Endif           
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Qdo compl.de preco("C") valor do item informado em SC6->C6_VALOR ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If SC5->C5_TIPO$"CIP" .Or. SF4->F4_QTDZERO == "1"
	nItemValTot:=nPrcTot
Else
	nItemValTot:=nQuant*nPrcVen
	If cMVARREFAT=="S"
		nItemValTot:=Round(nItemValTot,aTamSx3[2])
	Else
		nItemValTot:=Noround(nItemValTot,aTamSx3[2])
	Endif
Endif

nValBruto	:= nPrcBrut

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Inicializa array acumulador dos itens da Nota Fiscal ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
// 1) CODIGO FISCAL
// 2) PERCENTUAL DE ICMS
// 3) QUANTIDADE
// 4) VALOR TOTAL DO ITEM LIQUIDO
// 5) PRECO UNITARIO BRUTO DE VENDA
// 6) PRECO UNITARIO DE VENDA
// 7) NUMERO DO REGISTRO EM SC6
// 8) Identificacao de poder de terceiros do C9 para C6
// 9) Numero do Lote Da ISo9000
// 10) Flag de nota de servico
// 11) Item do SC6
// 12) Numero do SC6
// 13) F4_ISS
// 14) Recno do SC9

dbSelectArea("SC6")

If cPaisLoc == "BRA"
	nBaseFIcm += IIF(!Empty(nPerIcm).and.SF4->F4_ISS!="S", nItemValTot, 0)
	nBaseFIpi += IIF(SF4->F4_IPI=="S", nItemValTot, 0)
	nBaseISS  := IIF(SF4->F4_ISS=="S",nItemValTot,0.00)
	nBaseIRF  += IIf(SB1->B1_IRRF=="S",nItemValTot ,0)
	nBItemInss:= IIf(SB1->B1_INSS=="S",nItemValTot ,0)

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Reduz a Base de Calculo do INSS                      ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If SB1->(FieldPos("B1_REDINSS")) != 0
		nBItemInss := nBItemInss * IIF(SB1->B1_REDINSS!=0,SB1->B1_REDINSS/100,1)
	EndIf

	nBaseInss += nBItemInss

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Reduz a Base de Calculo do ISS - Por TES             ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If SF4->(FieldPos("F4_BASEISS")) != 0
		If SF4->F4_BASEISS > 0
			nBaseISS := nBaseIss * SF4->F4_BASEISS / 100
		EndIf
	Endif

EndIf

AADD(aTots,{ SC6->C6_CF,;
				 If(SF4->F4_ISS=="S",nPerISS,nPerIcm),;
				 nQuant,;
				 nItemValTot,;
				 nValBruto,;
				 nPrcVen,;
				 SC6->(Recno()),;
				 SC9->C9_IDENTB6,;
				 SC9->C9_NUMLOTE,;
				 nBaseISS,;
				 SC6->C6_ITEM,;
				 SC6->C6_NUM,;
				 SF4->F4_ISS,;
				 SC9->(Recno()),;
				 SC9->C9_LOTECTL,;
				 SC9->C9_SEQUEN,;
				 nD2AcVal})
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcao    ³A460Avalia³ Autor ³Armando Bucchina       ³ Data ³23.08.1999³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Tratamento das Cores da markbrowse                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpL1: Indica a Cor                                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³Nenhum                                                      ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/

Function A460Avalia()
Local lRet	:= .F.

lRet := (Empty(SC9->C9_BLEST) .And. Empty(SC9->C9_BLCRED)) 

If ( lRet ) .And. ( ! Empty(c460Cond) )
	lRet := &(c460Cond)
EndIf
lRet := !( lRet )

If !(lRet) .And. IntWMS() .And. FindFunction("WmsBlqPd")
    lRet := WmsBlqPd()
EndIf

Return( lRet )
 
?{"Nome do Arquivo INI","DIOPSCAD.INI"}
?{"Descicao Completa do Arquivo Magnetico","DIOPS Cadastral"}
?{"A Quem se Destina","Operadoras de Saúde do segmento Auto Gestão RH"}
?{"Objetivo","Gerar o arquivo XML do DIOPS"}
?{"Comentarios",""}
@XML
[XXX - Inicializacao]
(PRE) PutSx1 ("PLA091", "01", "Operadora ?", "Operadora ?", "Operadora ?", "mv_ch1", "C", 4, 0, 0, "G", "NaoVazio()", "B89PLS", "", "", "MV_PAR01", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "Informe a Operadora")
(PRE) Pergunte("PLA091",.T.)
(PRE) BA0->(DbSetOrder(1))
(PRE) BCI->(DbSetOrder(1))
(PRE) B07->(DbSetOrder(1))
(PRE) BA0->(DbSeek(xFilial("BA0")+mv_par01))
(PRE) _aTotal[001] := SubStr(DTos(DdataBase),1,4)+"-"+SubStr(DTos(DdataBase),5,2)+"-"+SubStr(DTos(DdataBase),7,2)
(PRE) _aTotal[002] := AllTrim(StrTran(StrTran(StrTran(BA0->BA0_TELEF1,"(",""),")",""),"-",""))
(PRE) _aTotal[003] := AllTrim(StrTran(StrTran(StrTran(BA0->BA0_TELEF2,"(",""),")",""),"-",""))
(PRE) _aTotal[004] := AllTrim(StrTran(StrTran(StrTran(BA0->BA0_TELEF3,"(",""),")",""),"-",""))
(PRE) _aTotal[005] := AllTrim(StrTran(StrTran(StrTran(BA0->BA0_FAX1,"(",""),")",""),"-",""))
(PRE) _aTotal[006] := AllTrim(StrTran(StrTran(StrTran(BA0->BA0_FAX2,"(",""),")",""),"-",""))
(PRE) _aTotal[007] := AllTrim(StrTran(StrTran(StrTran(BA0->BA0_FAX3,"(",""),")",""),"-",""))
(PRE) _aTotal[011] := "version="+'"1.0"'+" encoding="+'"UTF-8"'+" ?"
(PRE) _aTotal[012] := 'xmlns:ans="http://www.ans.gov.br/padroes/diops/schemas" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ans.gov.br/padroes/diops/schemas/diopsComplexTypes.xsd"'
(PRE) _aTotal[013] := Iif(BA0->BA0_MODALI == "ADMIN","administradora",Iif(BA0->BA0_MODALI =="COOPM","coopMedica",iif(BA0->BA0_MODALI =="COOPO","coopOdontologica",iif(BA0->BA0_MODALI =="FILAN","filantropia",iif(BA0->BA0_MODALI =="ODGRP","odontologiaGrupo",iif(BA0->BA0_MODALI =="SEGUR","seguradora",iif(BA0->BA0_MODALI =="MEGRP","medicinaGrupo",iif(BA0->BA0_MODALI =="SGSAU","seguradora",iif(BA0->BA0_MODALI =="AUTOG" .and. BA0->BA0_SEGMEN = "NPATR","autoGSemMantenedor",IIF(BA0->BA0_MODALI =="AUTOG" .and. BA0->BA0_SEGMEN = "PATRM","autoGComMantenedor",IIF(BA0->BA0_MODALI =="AUTOG" .and. BA0->BA0_SEGMEN = "AUTRH","autoGRH","medicinaGrupo")))))))))))
Linha1     C 000 0 MontaXML("?xml",,,,,,,.T.,.F.,.F.,_aTotal[011])
Linha2     C 000 0 MontaXML("",,,,,,,.F.,.F.)
Linha3     C 000 0 MontaXML("ans:diopsCadastral",,,,,,,.T.,.F.,.F.,_aTotal[012])

[BA0 Operadora]
(PRE) HashXmlI()
(CHV)BA0->(BA0_CODIDE+BA0_CODINT) == mv_par01
//<ans:identificador>
identif    C 000 0 MontaXML("ans:identificador",,,,,,3,.T.,.F.)
regans     C 000 0 MontaXML("ans:registroANS",AllTrim(BA0->BA0_SUSEP),,,,,6,.T.,.T.,,,,.T.)
razsocial  C 000 0 MontaXML("ans:razaoSocial",AllTrim(BA0->BA0_NOMINT),,,,,6,.T.,.T.,,,,.T.)
cnpj       C 000 0 MontaXML("ans:CNPJ",AllTrim(BA0->BA0_CGC) ,,,,,6,.T.,.T.,,,,.T.)
periodo    C 000 0 MontaXML("ans:periodo",AllTrim(_aTotal[001]),,,,,6,.T.,.T.,,,,.T.)
transc     C 000 0 MontaXML("ans:transacao","ENVIO_DIOPS_CADASTRAL" ,,,,,6,.T.,.T.,,,,.T.)
HashPwd    C 000 0 MontaXML("ans:hashPwd",AllTrim(Lower(MD5(AllTrim(PLSASenha()),2))),,,,,6,.T.,.T.,,,,.T.,.T.)
transc     C 000 0 MontaXML("ans:apTrans","PROTHEUS12" ,,,,,6,.T.,.T.,,,,.T.)
identif2   C 000 0 MontaXML("ans:identificador",,,,,,3,.F.,.T.)
//<ans:medicinaGrupo>
medic      C 000 0 MontaXML("ans:"+_aTotal[013],,,,,,3,.T.,.F.,.F.) 

//<ans:enquadramento>                                       
[XXX ans:enquadramento]
enquad     C 000 0 MontaXML("ans:enquadramento",,,,,,6,.T.,.F.)
segmen     C 000 0 MontaXML("ans:segmentacao",BA0->BA0_SEGMEN,,,,,9,.T.,.T.,.F.,,,.T.)

[XXX ans:enquadramento]
enquad2    C 000 0 MontaXML("ans:enquadramento",,,,,,6,.F.,.T.,.F.)

//<ans:acionQuotistas>
[XXX ans:acionQuotistas]
quot       C 000 0 MontaXML("ans:acionQuotistas",,,,,,6,.T.,.F.)
pulv       C 000 0 MontaXML("ans:totalmentePulverizado",AllTrim(BA0->BA0_ACOPUL),,,,,9,.T.,.T.,,,,.T.)
totaco     C 000 0 MontaXML("ans:totalAcoesQuotas",MaskDiops(STR(BA0->BA0_TOTACO)),,,,,9,.T.,.T.,.F.,,,.T.)
(PRE) FsQuery({"B07",""},1,"B07_FILIAL='"+xFilial("B07")+"' And B07_TIPO = '5'")
(PRE) B07->(DbGoTop())
[B07 Informações ANS Operadora]
acioqot    C 000 0 MontaXML("ans:acionistaQuotista",,,,,,9,.T.,.F.)
acioqotPJ  C 000 0 MontaXML("ans:acionista"+iif(B07->B07_TPDOC == "F","PF","PJ"),,,,,,9,.T.,.F.)
nome       C 000 0 MontaXML("ans:"+IIf(B07->B07_TPDOC == 'F',"nome","razaoSocial"),AllTrim(B07->B07_NOME),,,,,41,.T.,.T.,,,,.T.)
doc        C 000 0 MontaXML("ans:"+IIf(B07->B07_TPDOC == 'F',"CPF","CNPJ"),AllTrim(B07->B07_NUMDOC),,,,,41,.T.,.T.,,,,.T.)
qtdcot     C 000 0 MontaXML("ans:qtdAcoesQuotas",MaskDiops(STR(B07->B07_QTDACO)),,,,,41,.T.,.T.,,,,.T.)
acioqotPJ2 C 000 0 MontaXML("ans:acionista"+iif(B07->B07_TPDOC == "F","PF","PJ"),,,,,,9,.F.,.T.)
acioqot2   C 000 0 MontaXML("ans:acionistaQuotista",,,,,,9,.F.,.T.)
[XXX ans:acionQuotistas]
quot2      C 000 0 MontaXML("ans:acionQuotistas",,,,,,6,.F.,.T.,.F.)

//<ans:controlColigadas>
[XXX ans:controlColigadas]
(PRE) FsQuery({"B07",""},1,"B07_FILIAL='"+xFilial("B07")+"' And B07_TIPO = '6'")
(PRE) B07->(DbGoTop())
colig      C 000 0 MontaXML("ans:controlColigadas",,,,,,6,.T.,.F.,.F.)
[B07 Informações ANS Operadora]
empre      C 000 0 MontaXML("ans:empresa",,,,,,9,.T.,.F.)
cnpj       C 000 0 MontaXML("ans:CNPJ",AllTrim(B07->B07_NUMDOC),,,,,9,.T.,.T.,,,,.T.)
razaoSocia C 000 0 MontaXML("ans:razaoSocial",AllTrim(B07->B07_NOME),,,,,9,.T.,.T.,,,,.T.)
vinc       C 000 0 MontaXML("ans:tipoVinculo",AllTrim(B07->B07_TIPVIN),,,,,9,.T.,.T.,,,,.T.)
classif    C 000 0 MontaXML("ans:classificacaoEmpresa",AllTrim(B07->B07_CLASSI),,,,,9,.T.,.T.,,,,.T.)
qtdaco     C 000 0 MontaXML("ans:qtdeAcoesQuotas",MaskDiops(STR(B07->B07_QTDACO)),,,,,9,.T.,.T.,,,,.T.)
totaco     C 000 0 MontaXML("ans:totalAcoesQuotas",MaskDiops(STR(B07->B07_QTDACO)),,,,,9,.T.,.T.,,,,.T.)
empre2     C 000 0 MontaXML("ans:empresa",,,,,,9,.F.,.T.,.F.)
[XXX ans:controlColigadas]
colig2     C 000 0 MontaXML("ans:controlColigadas",,,,,,6,.F.,.T.,.F.)
[XXX ans:dependencias]
(PRE) FsQuery({"B07",""},1,"B07_FILIAL='"+xFilial("B07")+"' And B07_TIPO = '7'")
(PRE) B07->(DbGoTop())
depend     C 000 0 MontaXML("ans:dependencias",,,,,,6,.T.,.F.,.F.)
[B07 Informações ANS Operadora]
empdep     C 000 0 MontaXML("ans:empresaDependente",,,,,,9,.T.,.F.)
tipodep    C 000 0 MontaXML("ans:tipo",AllTrim(X3COMBO("B07_TIPDEP",B07->B07_TIPDEP)),,,,,9,.T.,.T.,nil,nil,.T.,.T.)
nome       C 000 0 MontaXML("ans:razaoSocial",AllTrim(B07->B07_NOME),,,,,9,.T.,.T.,,,,.T.)
cnpj       C 000 0 MontaXML("ans:CNPJ",AllTrim(B07->B07_NUMDOC),,,,,9,.T.,.T.,,,,.T.)
endereco   C 000 0 MontaXML("ans:enderecoDependente",,,,,,9,.T.,.F.)
logrepre   C 000 0 MontaXML("ans:logradouro",AllTrim(B07->B07_LOGRA),,,,,41,.T.,.T.,,,,.T.)
numLogRep  C 000 0 MontaXML("ans:numLogradouro",AllTrim(B07->B07_NUMLOG),,,,,41,.T.,.T.,,,,.T.)
compRep    C 000 0 MontaXML("ans:complemento",AllTrim(B07->B07_COMLOG),,,,,41,.T.,.T.,,,,.T.)
bairroRep  C 000 0 MontaXML("ans:bairro",AllTrim(B07->B07_BAILOG),,,,,41,.T.,.T.,,,,.T.)
munRep     C 000 0 MontaXML("ans:municipioIBGE",AllTrim(SUBSTR(B07->B07_MUNLOG,1,6)),,,,,41,.T.,.T.,,,,.T.)
siglaUFRep C 000 0 MontaXML("ans:siglaUF",AllTrim(Posicione("BID",1,xFilial("BID")+B07->B07_MUNLOG,"BID_EST")),,,,,41,.T.,.T.,,,,.T.)
cepRep     C 000 0 MontaXML("ans:cep",AllTrim(B07->B07_CEPLOG),,,,,41,.T.,.T.,,,,.T.)
endereco2  C 000 0 MontaXML("ans:enderecoDependente",,,,,,9,.F.,.T.)
telefone   C 000 0 MontaXML("ans:telefone",,,,,,9,.T.,.F.)
ddi        C 000 0 MontaXML("ans:codigoDDI",AllTrim(B07->B07_DDI),,,,,41,.T.,.T.,,,,.T.)
ddd        C 000 0 MontaXML("ans:codigoDDD",AllTrim(B07->B07_DDD),,,,,41,.T.,.T.,,,,.T.)
numtel     C 000 0 MontaXML("ans:numeroTel",AllTrim(B07->B07_TEL),,,,,41,.T.,.T.,,,,.T.)
ramal      C 000 0 MontaXML("ans:ramal",AllTrim(B07->B07_RAMAL),,,,,41,.T.,.T.,,,,.T.)
telefone2  C 000 0 MontaXML("ans:telefone",,,,,,9,.F.,.T.)
emailrep   C 000 0 MontaXML("ans:eMail",AllTrim(B07->B07_EMAIL),,,,,9,.T.,.T.,,,,.T.)
empdep2    C 000 0 MontaXML("ans:empresaDependente",,,,,,9,.F.,.T.)
[XXX ans:dependencias]
depend2    C 000 0 MontaXML("ans:dependencias",,,,,,6,.F.,.T.)
medic2     C 000 0 MontaXML("ans:"+_aTotal[013],,,,,,3,.F.,.T.) 

//<ans:epilogo>
epilogo    C 000 0 MontaXML("ans:epilogo",,,,,,3,.T.,.F.) 
hash       C 000 0 MontaXML("ans:hash",AllTrim(Lower(MD5(HashXmlF(),2))),,,,,6,.T.,.T.,,,.T.,.F.)
epilogo2   C 000 0 MontaXML("ans:epilogo",,,,,,3,.F.,.T.)
LinhaFim   C 000 0 MontaXML("ans:diopsCadastral",,,,,,,.F.,.T.,.F.)
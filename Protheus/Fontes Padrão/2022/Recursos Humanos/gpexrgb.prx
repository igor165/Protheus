#INCLUDE "PROTHEUS.CH"

/*/
зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©
ЁFun┤└o    ЁGPEXRGB   Ё Autor Ё Silvia Taguti         Ё Data Ё16/05/2008Ё
цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤└o ЁBiblioteca de Funcoes Genericas para uso em Formulas no RGB Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё Uso      Ё Generico                                                   Ё
цддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
Ё         ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL.             Ё
цддддддддддддбддддддддддбдддддддбддддддддддддддддддддддддддддддддддддддд╢
ЁProgramador Ё Data     Ё BOPS  ЁMotivo da Alteracao                    Ё
цддддддддддддеддддддддддедддддддеддддддддддддддддддддддддддддддддддддддд╢
юддддддддддддаддддддддддадддддддаддддддддддддддддддддддддддддддддддддддды/*/
/*/
зддддддддддбддддддддддддддддбдддддбдддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁGetRGB		    ЁAutorЁSilvia Taguti      Ё Data Ё16/05/2008Ё
цддддддддддеддддддддддддддддадддддадддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁObtem as Informacoes do RGB									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁNIL                      									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso	   ЁGenerica      										    	Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function GetRGB( cQueryWhere , lSqlWhere , lTopFilter )

Local cKey
Local cRetOrder
Local lGetRGB
Local nRGBOrder

IF Empty( cQueryWhere )
	cQueryWhere := WhereRGB()
	#IFDEF TOP
		IF !Empty( cQueryWhere ) 
			lSqlWhere	:= .T.
		EndIF	
	#ENDIF
EndIF

cRetOrder := "RGB_FILIAL + RGB_MAT+ RGB_PD + RGB_PERIOD + RGB_SEMANA"
nRGBOrder := RetOrder( "RGB" , cRetOrder , .T. )
IF ( nRGBOrder == 0 )
	cRetOrder	:= "RGB_FILIAL+RGB_MAT"
	nRGBOrder	:= RetOrder( "RGB" , cRetOrder , .F. )
EndIF

cKey	:= SRA->( RA_FILIAL + RA_MAT )

//Eh necessario ter o Mnemonico oSRR ( Tipo Private para reinicializar a cada registro )
IF (( ValType( oRGB ) == "O" ) .and.;
	( Len(oRGB:aHeader) > 0 ))
	oRGB:GetCols( nRGBOrder , cKey , cQueryWhere , lSqlWhere )
Else
	oRGB	:= GetDetFormula():New( "RGB" , nRGBOrder , cKey , cQueryWhere , @lSqlWhere , @lTopFilter )
EndIf

lGetRGB	:= oRGB:GetOk()

Return( lGetRGB )

/*/
зддддддддддбддддддддддддддддбдддддбдддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁPutRGB			ЁAutorЁSilvia Taguti      Ё Data Ё16/05/2008Ё
цддддддддддеддддддддддддддддадддддадддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁGrava as Informacoes do RGB									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁNIL                      									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso	   ЁGenerica      										    	Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function PutRGB()

Local aFieldsDel	:= Array( 4 )
Local aCntsDel		:= Array( 4 )

Return( oRGB:Put( aFieldsDel , aCntsDel ) )

/*/
зддддддддддбддддддддддддддддбдддддбдддддддддддддддддддбддддддбдддддддддд©
ЁFun┤┘o	   ЁWhereRGB		ЁAutorЁSilvia Taguti      Ё Data Ё16/05/2008Ё
цддддддддддеддддддддддддддддадддддадддддддддддддддддддаддддддадддддддддд╢
ЁDescri┤┘o ЁRetorna a Clausula Where para o RGB							Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁSintaxe   Ё<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁParametrosЁ<Vide Parametros Formais>									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁRetorno   ЁNIL                      									Ё
цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢
ЁUso	   ЁWhere para o RGB									    	Ё
юддддддддддадддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды/*/
Function WhereRGB()      

Local cQueryWhere
Local cRot := RcRoteirInit()

#IFDEF TOP

	cQueryWhere := "( RGB_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RGB_MAT='" + SRA->RA_MAT + "') "
	cQueryWhere += " AND "
	cQueryWhere += " RGB_PERIOD='" + RcPeriodoInit() + "'"
	cQueryWhere += " AND "
	cQueryWhere += " RGB_SEMANA='" + RcNumPgInit() + "'"
    If cRot != fGetCalcRot('4') //Caso roteiro seja diferente de recisao considerar o filtro por roteiro 
		cQueryWhere += " AND "
		cQueryWhere += "RGB_ROTEIR='" + RcRoteirInit() + "'"
	Endif
	cQueryWhere += " AND "
	cQueryWhere += "D_E_L_E_T_<>'*' "

#ELSE

	cQueryWhere := " RGB_PERIOD=='" + RcPeriodoInit() + "'"
	cQueryWhere += " .AND. "
	cQueryWhere += "RGB_SEMANA=='" + RcNumPgInit() + "'"
    If cRot != fGetCalcRot('4') //Caso roteiro seja diferente de recisao considerar o filtro por roteiro
		cQueryWhere += " .AND. "
		cQueryWhere += "RGB_ROTEIR=='" + RcRoteirInit() + "'"
	Endif

#ENDIF

Return( cQueryWhere )
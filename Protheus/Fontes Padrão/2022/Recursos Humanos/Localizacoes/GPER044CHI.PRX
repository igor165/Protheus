#INCLUDE "PROTHEUS.ch"
#INCLUDE "GPER044CHI.CH"
/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³ GPER044CHI ³ Autor ³ Jesus Peñaloza           ³ Data ³ 03.10.14   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Reporte Imposiciones Totales por Concepto y Entidad (Chile)       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ Generico                                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³              ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL.               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Programador   ³ Data   ³ BOPS/FNC  ³  Motivo da Alteracao                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Alex Hdez.    ³15/12/15³PCREQ-7944 ³Se paso a la v12 a partir de fuente de v11³±±
±±³              ³        ³           ³con la fecha 01/10/15 y Se agregan validac³±±
±±³              ³        ³           ³ión en todas las consultas LEN(ALLTRIM(cCo³±±
±±³              ³        ³           ³nd)) > 0. Se modifico función PCGeneral() ³±±
±±³              ³        ³           ³RC_PD por RD_PD.							    ³±±
±±³Alex Hdez.    ³22/02/16³PCREQ-7944 ³Se modifico función RepGralAll se agrega  ³±±
±±³              ³        ³           ³la sumatoria cuando es Total General y    ³±± 
±±³              ³        ³           ³aGral[nX,2] == ' '.                       ³±±
±±³              ³        ³           ³Se modifico Función Periodos() las condi- ³±±
±±³              ³        ³           ³ciones para concatenar las cadenas.       ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/

Function GPER044CHI()
Local oReport
Private aConceptos := {}
Private aProcesos:= {}
Private aIEC := {}
Private aInst := {}
Private aGral := {}
Private aTotal := {}
Private aTotales := {}
Private cPerg := 'GPER044CHI'
Private cTitulo := STR0028 //Reporte de Imposiciones Totales por Concepto y Entidad
Private nTam    := TamSX3("RC_VALOR")[1]+2
Private nTamEnt := TamSX3("RCO_NOME")[1] + TamSX3("RCO_NREPAT")[1]
Private cPict := "@E 99,999,999,999.99"
Private cPeriodosa := ''
Private cPagosa    := ''
Private cPeriodosc := ''
Private cPagosc    := ''
Private cProcesos := ''
Private cTabela := ''
Private cProc := ''
Private cTipnom:= ''
Private nAnio := 0
Private nMes := 0
Private nTipInf := 0
Private nTipIns := 0
Private nAllIns := 0
Private nMaxCol := 9 // columna para totales

If FindFunction("TRepInUse") .And. TRepInUse()
    //ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
    //³ Verifica las perguntas selecionadas      ³
    //ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
   If Pergunte(cPerg, .T.)
    	oReport := ReportDef()
    	oReport:PrintDialog()
    EndIf

EndIf

Return

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcion   ³ ReportDef  ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡ao ³ Definicion reporte Imposiciones totales                      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ GPER030CHI                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function ReportDef()

Local aOrd := {STR0017} //Entidad
Local   oReport
Local   oSection1
Local   oSection2     
Local   oSection3       
Local   oSection4
Local oSection5

oReport:=TReport():New(cPerg,OemToAnsi(cTitulo), cPerg ,{|oReport| PrintReport(oReport)})
oReport:SetPortrait()
oReport:nColSpace   := 1
oReport:nFontBody   := 6
oReport:nLineHeight := 24
oReport:cFontBody   := "COURIER NEW"
oReport:Setlandscape(.T.)
oReport:SetTotalInLine(.F.)

oSection1:= TRSection():New(oReport,oemtoansi(STR0018),,aOrd,/*Campos do SX3*/,/*Campos do SIX*/) //"Encabezado"
oSection1:SetTotalInLine(.F.)
oSection1:SetPageBreak(.T.)
oSection1:SetHeaderSection(.F.)
oSection1:SetHeaderPage(.T.)
oSection1:SetLineStyle(.T.)
oSection1:SetCharSeparator("")
oSection1:SetHeaderBreak(.T.)

TRCell():New(oSection1,"PROCESOS",,STR0019,,10,.T.,,"LEFT") //"Procesos:"
TRCell():New(oSection1,"TPNOMINA",,STR0020,,20,.T.,,"LEFT") //"T. Nomina:"
TRCell():New(oSection1,"ANIO",,STR0021,,10,.T.,,"LEFT") //"AÑO/MES:"

oSection2:= TRSection():New(oReport,oemtoansi(STR0022),,aOrd,,) //"Tipo de Institucion"
oSection2:SetTotalInLine(.f.)
oSection2:SetHeaderSection(.f.)
oSection2:SetHeaderPage(.f.)
oSection2:SetCharSeparator("")
oSection2:SetHeaderBreak(.T.)

TRCell():New(oSection2,"INSTITUCION",,STR0022,,50,.T.,,"LEFT") //"Tipo de Institucion"

oSection3:= TRSection():New(oReport,oemtoansi(STR0023),,aOrd,,) //"Conceptos"
oSection3:SetTotalInLine(.f.)
oSection3:SetHeaderSection(.f.)
oSection3:SetHeaderPage(.f.)
oSection3:SetLineStyle(.T.)
oSection3:SetCharSeparator("")
oSection3:SetHeaderBreak(.T.)

oSection4:= TRSection():New(oReport,oemtoansi(STR0027),,aOrd,,) //"Institucion"
oSection4:SetTotalInLine(.f.)
oSection4:SetHeaderSection(.f.)
oSection4:SetHeaderPage(.f.)
oSection4:SetLineStyle(.T.)
oSection4:SetCharSeparator("")
oSection4:SetHeaderBreak(.T.)

TRCell():New(oSection4,"INSTITU",,"",,nTamEnt,.T.,,"LEFT")

oSection5:= TRSection():New(oReport,oemtoansi(STR0024),,aOrd,,) //"Detalle"
oSection5:SetTotalInLine(.f.)
oSection5:SetHeaderSection(.f.)
oSection5:SetHeaderPage(.f.)
oSection5:SetLineStyle(.T.)
oSection5:SetCharSeparator("")
oSection5:SetHeaderBreak(.T.)

OSECTION1:NLINESBEFORE:=0
OSECTION2:NLINESBEFORE:=0
OSECTION3:NLINESBEFORE:=0
OSECTION4:NLINESBEFORE:=0
OSECTION5:NLINESBEFORE:=0

Return(oReport)

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PrintReport³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene las percepciones/deducciones del mes y año          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PrintReport(oExp1)                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ oExp1: Objeto oReport                                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReportDef                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PrintReport(oReport)
Private oRpt := oReport
Private oSection1  := oReport:Section(1)
Private oSection2  := oReport:Section(2)
Private oSection3  := oReport:Section(3)
Private oSection4  := oReport:Section(4)
Private oSection5  := oReport:Section(5)
Private cInst      := ""
//convierte parametros tipo Range a expresion sql
//si separador por "-" agrega un BETWEEN,  si separado por ";" agrega un IN
    MakeSqlExpr(cPerg)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Preguntas selecionadas - GPER044CHI                                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Variable utilizadas para parametros                                    ³
//³ mv_par01     // ¿Rango de Procesos?                                    ³
//³ mv_par02     // Procedimiento Calc?                                    ³
//³ mv_par03     // ¿Año?                                                  ³
//³ mv_par04     // ¿Mes?                                                  ³
//³ mv_par05     // ¿Tipo de Informe?                                      ³
//³ mv_par06     // ¿Tipo de Institucion?                                  ³
//³ mv_par07     // ¿Todas las Instituciones?                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ  
    cProc := MV_PAR01
    cTipnom:= MV_PAR02
    nAnio := MV_PAR03
    nMes := MV_PAR04
    nTipInf := MV_PAR05
    nTipIns := MV_PAR06
    nAllIns := MV_PAR07 

If nTipInf == 3
    cTitulo := STR0001 //'DETALLE POR INSTITUCIÓN EMPLEADO Y CONCEPTO'
    
    If nAllIns == 2    // Imprimir Todas las inst.
      Aviso(STR0033,STR0034, {STR0035})// "Aviso" "Por el momento esta opción se encuentra deshabilitada." "Aceptar"
   Else    
        If nTipIns == 1 // AFP
           RepIECp1()
           RepIECp2()
        Else
           ReporteIEC()
        EndIf
    EndIf
ElseIf nTipInf == 2
    cTitulo := STR0002 // 'DETALLE POR INSTITUCIÓN'
     If nAllIns == 2  // Imprimir Todas las inst.
       RepInstAll()
    Else
       ReporteInst()
    EndIf   
Else
    cTitulo := STR0003 // 'TOTAL GENERAL INSTITUCIÓN'
    If nAllIns == 2   // Imprimir Todas las inst.
       RepGralAll()
    Else
       ReporteGeneral()
    EndIf
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³GetRptTitle³ Autor ³ JR. Briseno           ³ Data ³03/10/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene el nombre de la institucion                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ GetRptTitle(nTipIns)                                        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ nExp2: numero de la institucion                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ListaConceptos                                              ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function GetRptTitle(nTipIns)
Local cTitle := ""

Do Case
    Case nTipIns == 1
        cTitle := OemToAnsi(STR0007) //"AFP"
    Case nTipIns == 2
        cTitle := OemToAnsi(STR0008) //"ISAPRE"
    Case nTipIns == 3
        cTitle := OemToAnsi(STR0009) //"IPS"
    Case nTipIns == 4
        cTitle := OemToAnsi(STR0010) //"MUTUAL"
    Case nTipIns == 5
        cTitle := OemToAnsi(STR0011) //"CCAF"     
EndCase

Return cTitle

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³ListaConcep³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene los conceptos a ser mostrados en el informe         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ ListaConceptos()                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ aExp1: arreglo que contiene los datos a mostrar en el inform³±±
±±³          ³ nExp2: posicion del arreglo que tiene los conceptos         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReportDef                                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function ListaConceptos()
Local nX := 0

aTotal := {}
aTotales := {}

cInst := GetRptTitle(nTipIns)

If nTipInf == 3
    TRCell():New(oSection3,"MATRICU",,"",,6,.T.,,"LEFT")
    oSection3:Cell("MATRICU"):SetValue(STR0004) //MAT
    TRCell():New(oSection5,"MATRICU",,"",,6,.T.,,"LEFT")
EndIf
TRCell():New(oSection3,"RUT",,"",,10,.T.,,"LEFT")
TRCell():New(oSection3,"NOMBRE",,"",,30,.T.,,"LEFT")
TRCell():New(oSection5,"RUT",,"",,10,.T.,,"LEFT")
TRCell():New(oSection5,"NOMBRE",,"",,30,.T.,,"LEFT")
If nTipInf != 1
    For nX := 1 to nMaxCol
       If nX <= len(aConceptos)
        TRCell():New(oSection3,"CONCEP"+Alltrim(Str(nX)),,"",,nTam,.T.,,"RIGHT")
        oSection3:Cell("CONCEP"+Alltrim(Str(nX))):SetValue(aConceptos[nX])
        TRCell():New(oSection5,"CONCEP"+Alltrim(Str(nX)),,"",,nTam,.T.,,"RIGHT")
        aAdd(aTotal, {substr(aConceptos[nX],1,3), 0})
        aAdd(aTotales, {substr(aConceptos[nX],1,3), 0})
        Else
        TRCell():New(oSection3,"CONCEP"+Alltrim(Str(nX)),,"",,nTam,.T.,,"RIGHT")
        oSection3:Cell("CONCEP"+Alltrim(Str(nX))):SetValue("")
        TRCell():New(oSection5,"CONCEP"+Alltrim(Str(nX)),,"",,nTam,.T.,,"RIGHT")
        EndIf
    Next nX
    TRCell():New(oSection3,"TOTAL",,"",,nTam,.T.,,"RIGHT")
    TRCell():New(oSection5,"TOTAL",,"",,nTam,.T.,,"RIGHT")
    oSection3:Cell("TOTAL"):SetValue(STR0006) //TOTAL
Else
    TRCell():New(oSection3,"IMPOR",,"",,nTam,.T.,,"RIGHT")
    oSection3:Cell("IMPOR"):SetValue(STR0005) //IMPORTE
    TRCell():New(oSection5,"IMPOR",,"",,nTam,.T.,,"RIGHT")
EndIf

oRpt:SetTitle(cTitulo + cInst)
oSection1:Init()
oSection1:Cell("PROCESOS"):SetValue(cProcesos)
dbSelectArea("SRY")
SRY->(dbSetOrder(1))
If SRY->(dbSeek(xFilial("SRY")+cTipnom))
    oSection1:Cell("TPNOMINA"):SetValue(cTipnom+" "+Alltrim(SRY->RY_DESC))
EndIf
oSection1:Cell("ANIO"):SetValue(Alltrim(Str(nAnio))+"/"+Padl(nMes,2,'0'))
oSection1:printline()
oRpt:Fatline()
oSection1:Finish()

oSection2:Init()
oSection2:Cell("INSTITUCION"):SetValue('')
oSection2:printline()
oSection2:Finish()

oSection3:Init()
oSection3:Cell("RUT"):SetValue(STR0025) //RUT
If nTipInf == 3
    oSection3:Cell("NOMBRE"):SetValue(STR0012) //NOMBRE
Else
    oSection3:Cell("NOMBRE"):SetValue(STR0013) //NOMBRE DE LA INSTITUCION
EndIf
oSection3:printline()
oRpt:Fatline()
oSection3:Finish()
Return aConceptos

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³GetRut     ³ Autor ³ JR. Briseno           ³ Data ³31/07/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene el nombre de la RUT                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ GetRut(nTipIns, cEntid)                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ nExp2: tipo de la institucion                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteIEC()                                                ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function GetRut(nTipIns, cEntid)
Local cRut := ""
Default nTipIns := 0
Default cEntid := ""

    If Empty(cEntid)
        cRut := STR0032  + cEntid //"Ent: "
    Else
        DbSelectArea("RCO")
        DbSetOrder(4) // RCO_FILIAL+RCO_ATIVID+RCO_CODIGO
        If DbSeek(xFilial("RCO") + IIF(nTipIns==3,'2',Alltrim(STR(nTipIns))) + cEntid)
            cRut := RCO->RCO_NREPAT
        Else
            cRut := STR0032 + cEntid //"Ent: "
        EndIf
    EndIf
Return cRut

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³GetDescri  ³ Autor ³ JR. Briseno           ³ Data ³31/07/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene el nombre de la descripcion de la RUT               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ GetDescri(nTipIns, cEntid)                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ nExp2: tipo de la institucion                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteIEC()                                                ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function GetDescri(nTipIns, cEntid)
Local cDescri := ""
Default nTipIns := 0
Default cEntid := ""

    If Empty(cEntid)
        cDescri := STR0031 //"Institución Inexistente"
    Else
        DbSelectArea("RCO")
        DbSetOrder(4) // RCO_FILIAL+RCO_ATIVID+RCO_CODIGO
        If DbSeek(xFilial("RCO") + IIF(nTipIns==3,'2',Alltrim(STR(nTipIns))) + cEntid)
            cDescri := RCO->RCO_NOME
        Else
            cDescri := STR0031 //"Institución Inexistente"
        EndIf
    EndIf        
Return cDescri

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³ReporteIEC ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el detalle por institucion, empleado y concepto     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ ReporteIEC()                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±³          ³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function ReporteIEC()
Local cMat   := ''
Local cEntid := ''
Local nX     := 1
Local nY     := 1
Local nZ     := 1
Local cRut := ""
Local cDescri := ""
Local nTotal := 0
Local nTotalt := 0
Local nTotales:= 0


MakeSqlExpr(cPerg)
Periodos()
aIEC := {}
If len(cPeriodosc) > 2
    PCIEC()
EndIf
If len(cPeriodosa) > 2
    PAIEC()
EndIf
If len(aIEC) < 1
    MsgAlert(STR0014) //No existe información con los parametros proporcionados
    oRpt:CancelPrint()
Else
    oSection5:Init()
    aConceptos := ListaConceptos()
    oRpt:SetMeter(len(aIEC))
    While nX <= len(aIEC)
        cEntid := aIEC[nX,8]
        cRut := GetRut(nTipIns, cEntid)
        cDescri := GetDescri(nTipIns, cEntid)
        nTotal := 0
        nTotalt := 0
        oSection4:Init()
        oSection4:Cell("INSTITU"):SetValue(cRut+" "+cDescri)
        oSection4:PrintLine()
        aTotal := {}
        For nY := 1 to len(aConceptos)
            aAdd(aTotal, {substr(aConceptos[nY],1,3), 0})
        Next nY
        While (aIEC[nX,8] == cEntid) .and. nX <= len(aIEC)
            cMat := aIEC[nX,1]
            For nY := 1 to len(aConceptos)
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
            Next nY
            oSection5:Cell("TOTAL"):SetValue("")
            nTotal := 0
            While (aIEC[nX,1] == cMat) .and. nX <= len(aIEC)
                oSection5:Cell("MATRICU"):SetValue(cMat)
                oSection5:Cell("RUT"):SetValue(aIEC[nX,2])
                oSection5:Cell("NOMBRE"):SetValue(aIEC[nX,3])
                For nY := 1 to len(aConceptos)
                    If substr(aConceptos[nY],1,3) == aIEC[nX,4]
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aIEC[nX,6],cPict))
                        If aIEC[nX,7] == '+'
                            nTotal += aIEC[nX,6]
                        ElseIf aIEC[nX,7] == '-'
                            nTotal -= aIEC[nX,6]
                        EndIf
                Else
                    If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                    EndIf
                    EndIf
                    If aTotal[nY,1] == aIEC[nX,4]
                        aTotal[nY,2] += aIEC[nX,6]
                    EndIf
                Next nY
                nX++
                oRpt:IncMeter()
                If nX > len(aIEC)
                    exit
                EndIf
            EndDo
            nTotalt += nTotal
            nTotales+= nTotal
            oSection5:Cell("TOTAL"):SetValue(Transform(nTotal, cPict))
            oSection5:PrintLine()
            If nX > len(aIEC)
                exit
            EndIf
        EndDo
        oSection5:Cell("MATRICU"):SetValue("")
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue(STR0015) //T O T A L  INSTITUCION
        oSection5:Cell("TOTAL"):SetValue("")
        For nY := 1 to len(aConceptos)
            For nZ := 1 to len(aTotal)
                If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotal[nZ,2],cPict))
                    aTotales[nZ,2] += aTotal[nZ,2]
                EndIf
            Next nZ
        Next nY
        oSection5:Cell("TOTAL"):SetValue(Transform(nTotalt, cPict))
        oSection5:Printline()
        oSection5:Cell("MATRICU"):SetValue("")
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue("")
        oSection5:Cell("TOTAL"):SetValue("")
        For nY := 1 to len(aConceptos)
            oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
        Next nY
        oSection5:Cell("TOTAL"):SetValue("")
        oSection5:Printline()
    EndDo
    oSection5:Cell("MATRICU"):SetValue("")
    oSection5:Cell("RUT"):SetValue("")
    oSection5:Cell("NOMBRE"):SetValue(STR0016 + cInst) //T O T A L  
    oSection5:Cell("TOTAL"):SetValue("")
    For nY := 1 to len(aConceptos)
        For nZ := 1 to len(aTotales)
            If substr(aConceptos[nY],1,3) == aTotales[nZ,1]
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotales[nZ,2],cPict))
            EndIf
        Next nZ
    Next nY
    oSection5:Cell("TOTAL"):SetValue(Transform(nTotales, cPict))
    oSection5:PrintLine()
    oSection4:Finish()
    oSection5:Finish()
EndIf
Return



/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³RepIECp1   ³ Autor ³ JR Briseno            ³ Data ³10/07/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el detalle por institucion, empleado y concepto     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ RepIECp1()                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function RepIECp1()
Local cMat   := ''
Local cEntid := ''
Local nX     := 1
Local nY     := 1
Local nZ     := 1
Local cRut := ""
Local cDescri := ""
Local nTotal := 0
Local nTotalt := 0
Local nTotales:= 0


MakeSqlExpr(cPerg)
Periodos()
aIEC := {}
If len(cPeriodosc) > 2
    PCIEC(1)
EndIf
If len(cPeriodosa) > 2
    PAIEC(1)
EndIf
If len(aIEC) < 1
    Return // Sale porque no encontro informacion
Else
    oSection5:Init()
    aConceptos := ListaConceptos() //(aIEC, 4)
    oRpt:SetMeter(len(aIEC))
    While nX <= len(aIEC)
        cEntid := aIEC[nX,8]
        cRut := GetRut(nTipIns, cEntid)
        cDescri := GetDescri(nTipIns, cEntid)
        nTotal := 0
        nTotalt := 0
        oSection4:Init()
        oSection4:Cell("INSTITU"):SetValue(cRut+" "+cDescri)
        oSection4:PrintLine()
        aTotal := {}
        For nY := 1 to len(aConceptos)
            aAdd(aTotal, {substr(aConceptos[nY],1,3), 0})
        Next nY
        While (aIEC[nX,8] == cEntid) .and. nX <= len(aIEC)
            cMat := aIEC[nX,1]
            For nY := 1 to len(aConceptos)
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
            Next nY
            oSection5:Cell("TOTAL"):SetValue("")
            nTotal := 0
            While (aIEC[nX,1] == cMat) .and. nX <= len(aIEC)
                oSection5:Cell("MATRICU"):SetValue(cMat)
                oSection5:Cell("RUT"):SetValue(aIEC[nX,2])
                oSection5:Cell("NOMBRE"):SetValue(aIEC[nX,3])
                For nY := 1 to len(aConceptos)
                    If substr(aConceptos[nY],1,3) == aIEC[nX,4]
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aIEC[nX,6],cPict))
                        If aIEC[nX,7] == '+'
                            nTotal += aIEC[nX,6]
                        ElseIf aIEC[nX,7] == '-'
                            nTotal -= aIEC[nX,6]
                        EndIf
                    Else
                        If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""   
                            oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                        EndIf
                    EndIf
                    If aTotal[nY,1] == aIEC[nX,4]
                        aTotal[nY,2] += aIEC[nX,6]
                    EndIf
                Next nY
                nX++
                oRpt:IncMeter()
                If nX > len(aIEC)
                    exit
                EndIf
            EndDo
            nTotalt += nTotal
            nTotales+= nTotal
            oSection5:Cell("TOTAL"):SetValue(Transform(nTotal, cPict))
            oSection5:PrintLine()
            If nX > len(aIEC)
                exit
            EndIf
        EndDo
        oSection5:Cell("MATRICU"):SetValue("")
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue(STR0015) //T O T A L  INSTITUCION
        oSection5:Cell("TOTAL"):SetValue("")
        For nY := 1 to len(aConceptos)
            For nZ := 1 to len(aTotal)
                If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotal[nZ,2],cPict))
                    aTotales[nZ,2] += aTotal[nZ,2]
                EndIf
            Next nZ
        Next nY
        oSection5:Cell("TOTAL"):SetValue(Transform(nTotalt, cPict))
        oSection5:Printline()
    EndDo
    oSection5:Cell("MATRICU"):SetValue("")
    oSection5:Cell("RUT"):SetValue("")
    oSection5:Cell("NOMBRE"):SetValue(STR0016 + cInst) //T O T A L  
    oSection5:Cell("TOTAL"):SetValue("")
    For nY := 1 to len(aConceptos)
        For nZ := 1 to len(aTotales)
            If substr(aConceptos[nY],1,3) == aTotales[nZ,1]
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotales[nZ,2],cPict))
            EndIf
        Next nZ
    Next nY
    oSection5:Cell("TOTAL"):SetValue(Transform(nTotales, cPict))
    oSection5:PrintLine()
    oSection4:Finish()
    oSection5:Finish()
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³RepIECp2   ³ Autor ³ JR Briseno            ³ Data ³10/07/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el detalle por institucion, empleado y concepto     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ RepIECp2()                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function RepIECp2()
Local cMat   := ''
Local cEntid := ''
Local nX     := 1
Local nY     := 1
Local nZ     := 1
Local cRut := ""
Local cDescri := ""
Local nTotal := 0
Local nTotalt := 0
Local nTotales:= 0

MakeSqlExpr(cPerg)
Periodos()
aIEC := {}
If len(cPeriodosc) > 2
    PCIEC(2)
EndIf
If len(cPeriodosa) > 2
    PAIEC(2)
EndIf
If len(aIEC) < 1
    Return // No se encontro informacion 
Else
    oSection5:Init()
    oRpt:SetMeter(len(aIEC))
    // reiniciar totales
    For nZ := 1 to len(aConceptos)
    	 If  nZ <= len(aTotales)
         	 aTotales[nZ,2] := 0
         Endif
    Next nZ
    While nX <= len(aIEC)
        cEntid := aIEC[nX,8]
        cRut := GetRut(nTipIns, cEntid)
        cDescri := GetDescri(nTipIns, cEntid)
        nTotal := 0
        nTotalt := 0
        oSection4:Init()
        oSection4:Cell("INSTITU"):SetValue(cRut+" "+cDescri)
        oSection4:PrintLine()
        aTotal := {}
        For nY := 1 to len(aConceptos)
            aAdd(aTotal, {substr(aConceptos[nY],1,3), 0})
        Next nY
        While (aIEC[nX,8] == cEntid) .and. nX <= len(aIEC)
            cMat := aIEC[nX,1]
            For nY := 1 to len(aConceptos)
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
            Next nY
            oSection5:Cell("TOTAL"):SetValue("")
            nTotal := 0
            While (aIEC[nX,1] == cMat) .and. nX <= len(aIEC)
                oSection5:Cell("MATRICU"):SetValue(cMat)
                oSection5:Cell("RUT"):SetValue(aIEC[nX,2])
                oSection5:Cell("NOMBRE"):SetValue(aIEC[nX,3])
                For nY := 1 to len(aConceptos)
                    If substr(aConceptos[nY],1,3) == aIEC[nX,4]
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aIEC[nX,6],cPict))
                        If aIEC[nX,7] == '+'
                            nTotal += aIEC[nX,6]
                        ElseIf aIEC[nX,7] == '-'
                            nTotal -= aIEC[nX,6]
                        EndIf
                    Else
                        If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""   
                            oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                        EndIf
                    EndIf
                    If aTotal[nY,1] == aIEC[nX,4]
                        aTotal[nY,2] += aIEC[nX,6]
                    EndIf
                Next nY
                nX++
                oRpt:IncMeter()
                If nX > len(aIEC)
                    exit
                EndIf
            EndDo
            nTotalt += nTotal
            nTotales+= nTotal
            oSection5:Cell("TOTAL"):SetValue(Transform(nTotal, cPict))
            oSection5:PrintLine()
            If nX > len(aIEC)
                exit
            EndIf
        EndDo
        For nY := 1 to len(aConceptos)
            For nZ := 1 to len(aTotal)
                If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                	If  nZ <= len(aTotales)
                    	aTotales[nZ,2] += aTotal[nZ,2]
                    Endif
                EndIf
            Next nZ
        Next nY
    EndDo
    oSection5:Cell("MATRICU"):SetValue("")
    oSection5:Cell("RUT"):SetValue("")
    oSection5:Cell("NOMBRE"):SetValue(STR0016 + STR0029) //T O T A L  OTRAS CIAS APV
    oSection5:Cell("TOTAL"):SetValue("")
    For nY := 1 to len(aConceptos)
        For nZ := 1 to len(aTotales)
            If substr(aConceptos[nY],1,3) == aTotales[nZ,1]
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotales[nZ,2],cPict))
            Else
                If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                EndIf
            EndIf
        Next nZ
    Next nY
    oSection5:Cell("TOTAL"):SetValue(Transform(nTotales, cPict))
    oSection5:PrintLine()
    oSection4:Finish()
    oSection5:Finish()
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³ReporteInst³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el detalle por institucion                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ ReporteInst()                                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function ReporteInst()
Local cEntid := ''
Local nX     := 1
Local nY     := 1
Local nZ     := 1
Local nTotal := 0
Local nTotalt := 0
Local nTamArr := 0
Local nTamCon := 0
Local cRut    := ""
Local cDescri := ""
MakeSqlExpr(cPerg)
Periodos()
aInst := {}
If len(cPeriodosc) > 2
    PCInstitu()
EndIf
If len(cPeriodosa) > 2
    PAInstitu()
EndIf
If len(aInst) < 1
    MsgAlert(STR0014) //"No existe información con los parametros proporcionados"
    oRpt:CancelPrint()
Else
    oSection5:Init()
    aConceptos := ListaConceptos()
    nTamCon := len(aConceptos)
    nTamArr := len(aInst)
    oRpt:SetMeter(nTamArr)
    While nX <= nTamArr
        cEntid := aInst[nX,5]
        For nY := 1 to nTamCon
            oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
        Next nY
        oSection5:Cell("TOTAL"):SetValue("")
        cRut := GetRut(nTipIns, cEntid)
        cDescri := GetDescri(nTipIns, cEntid)
        nTotal := 0
        oSection5:Cell("RUT"):SetValue(cRut)
        oSection5:Cell("NOMBRE"):SetValue(cDescri)
        While (aInst[nX,5] == cEntid) .and. nX <= nTamArr
            For nY := 1 to nTamCon
                If substr(aConceptos[nY],1,3) == aInst[nX,1]
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aInst[nX,3],cPict))
                    If aInst[nX,4] == '+'
                        nTotal += aInst[nX,3]
                    ElseIf aInst[nX,4] == '-'
                        nTotal -= aInst[nX,3]
                    EndIf
                Else
                    If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                    EndIf 
                EndIf
                If aTotal[nY,1] == aInst[nX,1]
                    aTotal[nY,2] += aInst[nX,3]
                EndIf
            Next nY
            nX++
            oRpt:IncMeter()
            If nX > len(aInst)
                exit
            EndIf
        EndDo
        nTotalt += nTotal
        oSection5:Cell("TOTAL"):SetValue(Transform(nTotal, cPict))
        oSection5:PrintLine()
    EndDo
    oSection5:Cell("RUT"):SetValue("")
    oSection5:Cell("NOMBRE"):SetValue(STR0016 + cInst) //"T O T A L  "
    oSection5:Cell("TOTAL"):SetValue("")
    For nY := 1 to nTamCon
        For nZ := 1 to len(aTotal)
            If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotal[nZ,2],cPict))
            EndIf
        Next nZ
    Next nY
    oSection5:Cell("TOTAL"):SetValue(Transform(nTotalt, cPict))
    oSection5:PrintLine()
    oSection4:Finish()
    oSection5:Finish()
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³RepInstAll ³ Autor ³ JR. Briseno           ³ Data ³15/07/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el detalle por institucion de todas las institucione³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ RepInstAll()                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function RepInstAll()
Local cEntid := ''
Local nX     := 1
Local nY     := 1
Local nZ     := 1
Local nTotal  := 0
Local nTotalt := 0
Local nCont   := 0
Local nTamArr := 0
Local cRut    := ""
Local cDescri := ""
MakeSqlExpr(cPerg)
Periodos()

For nCont := 1 to 5  // Todas las instituciones: 1-AFP,2-ISAPRE,3-INP,4-MUTUAL,5-CCAF
    nTipIns := nCont
    nX     := 1
    nTotal  := 0
    nTotalt := 0
    aInst := {}
    aConceptos := {}
    
    If len(cPeriodosc) > 2
        PCInstitu()
    EndIf
    If len(cPeriodosa) > 2
        PAInstitu()
    EndIf
    nTamArr := len(aInst) 
    If nTamArr < 1
        cInst := GetRptTitle(nTipIns)
        MsgAlert(STR0014 + STR0036 + cInst) //"No existe información con los parametros proporcionados" ", para el Reporte: "
    Else
        oSection1:Init()
        oSection5:Init()
        aConceptos := ListaConceptos()
        oRpt:SetMeter(nTamArr)
        While nX <= nTamArr
            cEntid := aInst[nX,5]
            For nY := 1 to len(aConceptos)
                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
            Next nY
            oSection5:Cell("TOTAL"):SetValue("")
            cRut := GetRut(nTipIns, cEntid)
            cDescri := GetDescri(nTipIns, cEntid)
            nTotal := 0
            oSection5:Cell("RUT"):SetValue(cRut)
            oSection5:Cell("NOMBRE"):SetValue(cDescri)
            While (aInst[nX,5] == cEntid) .and. nX <= nTamArr
                For nY := 1 to len(aConceptos)
                    If substr(aConceptos[nY],1,3) == aInst[nX,1]
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aInst[nX,3],cPict))
                        If aInst[nX,4] == '+'
                            nTotal += aInst[nX,3]
                        ElseIf aInst[nX,4] == '-'
                            nTotal -= aInst[nX,3]
                        EndIf
                    Else
                        If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""
                            oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                        EndIf 
                    EndIf
                    If aTotal[nY,1] == aInst[nX,1]
                        aTotal[nY,2] += aInst[nX,3]
                    EndIf
                Next nY
                nX++
                oRpt:IncMeter()
                If nX > len(aInst)
                    exit
                EndIf
            EndDo
            nTotalt += nTotal
            oSection5:Cell("TOTAL"):SetValue(Transform(nTotal, cPict))
            oSection5:PrintLine()
        EndDo
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue(STR0016 + cInst) //"T O T A L  "
        oSection5:Cell("TOTAL"):SetValue("")
        For nY := 1 to len(aConceptos)
            For nZ := 1 to len(aTotal)
                If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotal[nZ,2],cPict))
                EndIf
            Next nZ
        Next nY
        oSection5:Cell("TOTAL"):SetValue(Transform(nTotalt, cPict))
        oSection5:PrintLine()
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue("")
        oSection5:Cell("TOTAL"):SetValue("")
        For nY := 1 to len(aConceptos)
            For nZ := 1 to len(aTotal)
                If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
                EndIf
            Next nZ
        Next nY
        oSection5:Cell("TOTAL"):SetValue("")
        oSection5:PrintLine()
        oSection4:Finish()
        oSection5:Finish()
    EndIf
    If nTipIns == 1 // Segunda parte AFP
        nTipIns := 6 // valor virtual para obtener 2da parte de AFP
        nX     := 1
        nTotal  := 0
        nTotalt := 0
        aInst := {}
        aConceptos := {}
        
        If len(cPeriodosc) > 2
            PCInstitu()
        EndIf
        If len(cPeriodosa) > 2
            PAInstitu()
        EndIf
        nTipIns := 1
        nTamArr := len(aInst)
        If len(aInst) > 0
            oSection1:Init()
            oSection5:Init()
            aConceptos := ListaConceptos()
            oRpt:SetMeter(nTamArr)
            While nX <= nTamArr
                cEntid := aInst[nX,5]
                For nY := 1 to len(aConceptos)
                    oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
                Next nY
                oSection5:Cell("TOTAL"):SetValue("")                
                cRut := GetRut(nTipIns, cEntid)
                cDescri := GetDescri(nTipIns, cEntid)                
                nTotal := 0
                oSection5:Cell("RUT"):SetValue(cRut)
                oSection5:Cell("NOMBRE"):SetValue(cDescri)
                While (aInst[nX,5] == cEntid) .and. nX <= nTamArr
                    For nY := 1 to len(aConceptos)
                        If substr(aConceptos[nY],1,3) == aInst[nX,1]
                            oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aInst[nX,3],cPict))
                            If aInst[nX,4] == '+'
                                nTotal += aInst[nX,3]
                            ElseIf aInst[nX,4] == '-'
                                nTotal -= aInst[nX,3]
                            EndIf
                        Else
                            If oSection5:Cell("CONCEP"+Alltrim(Str(nY))):GetValue() == ""
                                oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(0, cPict))
                            EndIf 
                        EndIf
                        If aTotal[nY,1] == aInst[nX,1]
                            aTotal[nY,2] += aInst[nX,3]
                        EndIf
                    Next nY
                    nX++
                    oRpt:IncMeter()
                    If nX > len(aInst)
                        exit
                    EndIf
                EndDo
                nTotalt += nTotal
                oSection5:Cell("TOTAL"):SetValue(Transform(nTotal, cPict))
                oSection5:PrintLine()
            EndDo
            oSection5:Cell("RUT"):SetValue("")
            oSection5:Cell("NOMBRE"):SetValue(STR0016 + STR0029) //"T O T A L  Otras Cias APV"
            oSection5:Cell("TOTAL"):SetValue("")
            For nY := 1 to len(aConceptos)
                For nZ := 1 to len(aTotal)
                    If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue(Transform(aTotal[nZ,2],cPict))
                    EndIf
                Next nZ
            Next nY
            oSection5:Cell("TOTAL"):SetValue(Transform(nTotalt, cPict))
            oSection5:PrintLine()
            oSection5:Cell("RUT"):SetValue("")
            oSection5:Cell("NOMBRE"):SetValue("")
            oSection5:Cell("TOTAL"):SetValue("")
            For nY := 1 to len(aConceptos)
                For nZ := 1 to len(aTotal)
                    If substr(aConceptos[nY],1,3) == aTotal[nZ,1]
                        oSection5:Cell("CONCEP"+Alltrim(Str(nY))):SetValue("")
                    EndIf
                Next nZ
            Next nY
            oSection5:Cell("TOTAL"):SetValue("")
            oSection5:PrintLine()
            oSection4:Finish()
            oSection5:Finish()
        EndIf
    EndIf
Next nCont
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³RepGralAll ³ Autor ³ JR. Briseno           ³ Data ³14/07/2015³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el Total General de todas las Instituciones         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ RepGralAll()                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ RepGralAll()                                                ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function RepGralAll()
Local nX     := 1
Local nTotal := 0
Local nCont := 0
Local nSubTotal := 0
Local nTamArr := 0
Local cRut := ""
Local cDescri := ""
Local cEntid := ""

MakeSqlExpr(cPerg)
Periodos()
    
For nCont := 1 to 5 // Todas las instituciones: 1-AFP,2-ISAPRE,3-INP,4-MUTUAL,5-CCAF
    nTipIns := nCont
    nX := 1
    nTotal := 0
    nSubTotal := 0
    aGral := {}

    If len(cPeriodosc) > 2
        PCGeneral()
    EndIf
    If len(cPeriodosa) > 2
        PAGeneral()
    EndIf
    nTamArr := len(aGral)
    If nTamArr < 1
        cInst := GetRptTitle(nTipIns)
        MsgAlert(STR0014 + STR0036 + cInst) //"No existe información con los parametros proporcionados" ", para el Reporte: "
    Else
      oSection1:Init()
      oSection5:Init()      
        ListaConceptos()
        oSection5:PrintLine()        
        nTamArr := len(aGral)
        oRpt:SetMeter(nTamArr)
        While nX <= nTamArr
            cEntid := Alltrim(aGral[nX,3])
            cRut := GetRut(nTipIns, cEntid)
            cDescri := GetDescri(nTipIns, cEntid)
            If aGral[nX,2] == '+'
                nTotal += aGral[nX,1]
                nSubTotal += aGral[nX,1]
            ElseIf aGral[nX,2] == '-'
                nTotal -= aGral[nX,1]
                nSubTotal -= aGral[nX,1]
            ElseIf (nTipInf == 1 .And. aGral[nX,2] == ' ')
            	  nTotal += aGral[nX,1]
                nSubTotal += aGral[nX,1]
            EndIf   
            If ((nX + 1) <= nTamArr) .And. (aGral[nX, 3] != aGral[nX + 1, 3]) // compara entidad actual con la siguiente
                oSection5:Cell("RUT"):SetValue(cRut)
                oSection5:Cell("NOMBRE"):SetValue(cDescri)
                oSection5:Cell("IMPOR"):SetValue(Transform(nSubTotal, cPict))
                oSection5:PrintLine()
                nSubTotal = 0
            EndIf
            nX++
            oRpt:IncMeter()
        EndDo
    
        If nSubTotal > 0   // aGral[nTamArr, 3] != aGral[nTamArr - 1, 3] // compara entidad actual con la anterior
            oSection5:Cell("RUT"):SetValue(cRut)
            oSection5:Cell("NOMBRE"):SetValue(cDescri)
            oSection5:Cell("IMPOR"):SetValue(Transform(nSubTotal, cPict))    
            oSection5:PrintLine()
        EndIf
    
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue(STR0016 + cInst) //"T O T A L "
        oSection5:Cell("IMPOR"):SetValue(Transform(nTotal, cPict))
        oSection5:PrintLine()
        oSection5:Cell("RUT"):SetValue("")
        oSection5:Cell("NOMBRE"):SetValue("")
        oSection5:Cell("IMPOR"):SetValue("")
        oSection5:PrintLine()
        oSection4:Finish()      
        oSection5:Finish()      

        If nTipIns == 1 // segunda parte AFP
            nTipIns := 6 // tipo de institucion virtual para procesar la segunda parte de este informe AFP
            nX := 1
            nTotal := 0
            aGral := {}
        
            If len(cPeriodosc) > 2
                PCGeneral()
            EndIf
            If len(cPeriodosa) > 2
                PAGeneral()
            EndIf
            nTipIns := 1
            nTamArr := len(aGral) 
            If nTamArr > 0
                oSection1:Init()
                oSection5:Init()      
                ListaConceptos()
                oSection5:PrintLine()
                oRpt:SetMeter(nTamArr)
                While nX <= nTamArr                    
                    cEntid := Alltrim(aGral[nX,3])
                    cRut := GetRut(nTipIns, cEntid)
                    cDescri := GetDescri(nTipIns, cEntid)
                    
                    If aGral[nX,2] == '+'
                        nTotal += aGral[nX,1]
                        nSubTotal += aGral[nX,1]
                    ElseIf aGral[nX,2] == '-'
                        nTotal -= aGral[nX,1]
                        nSubTotal -= aGral[nX,1]
                    EndIf    
        
                    If ((nX + 1) <= nTamArr) .And. (aGral[nX, 3] != aGral[nX + 1, 3]) // compara entidad actual con la siguiente
                        oSection5:Cell("RUT"):SetValue(cRut)
                        oSection5:Cell("NOMBRE"):SetValue(cDescri)
                        oSection5:Cell("IMPOR"):SetValue(Transform(nSubTotal, cPict))
                        oSection5:PrintLine()
                        nSubTotal = 0
                    EndIf
                    nX++
                    oRpt:IncMeter()
                EndDo
        
                If nSubTotal > 0    // compara entidad actual con la anterior
                    oSection5:Cell("RUT"):SetValue(cRut)
                    oSection5:Cell("NOMBRE"):SetValue(cDescri)
                    oSection5:Cell("IMPOR"):SetValue(Transform(nSubTotal, cPict))    
                    oSection5:PrintLine()
                EndIf
        
                oSection5:Cell("RUT"):SetValue("")
                oSection5:Cell("NOMBRE"):SetValue(STR0016 + STR0029) //"T O T A L Otras Cias APV"
                oSection5:Cell("IMPOR"):SetValue(Transform(nTotal, cPict))
                oSection5:PrintLine()
                oSection5:Cell("RUT"):SetValue("")
                oSection5:Cell("NOMBRE"):SetValue("")
                oSection5:Cell("IMPOR"):SetValue("")
                oSection5:PrintLine()
                oSection4:Finish()      
                oSection5:Finish()
            EndIf    
        EndIf
    EndIf
Next nCont
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³ReporteGene³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Imprime el Total General por Institucion                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ ReporteGeneral()                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±³          ³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function ReporteGeneral()
Local nX     := 1
Local nSubTotal := 0
Local nTotal := 0
Local nTamArr := 0
Local cRut := ""
Local cDescri := ""
Local cEntid := ""

MakeSqlExpr(cPerg)
Periodos()
aGral := {}
If len(cPeriodosc) > 2
    PCGeneral()
EndIf
If len(cPeriodosa) > 2
    PAGeneral()
EndIf
If len(aGral) < 1
    MsgAlert(STR0014) //"No existe información con los parametros proporcionados"
    oRpt:CancelPrint()
Else
    oSection5:Init()
    ListaConceptos()
    oSection5:PrintLine()
    nTamArr := len(aGral)
    oRpt:SetMeter(nTamArr)
    
    While nX <= nTamArr
        cEntid := Alltrim(aGral[nX,3])
        cRut := GetRut(nTipIns, cEntid)
        cDescri := GetDescri(nTipIns, cEntid)
        
        If aGral[nX,2] == '+'
            nTotal += aGral[nX,1]
            nSubTotal += aGral[nX,1]
        ElseIf aGral[nX,2] == '-'
            nTotal -= aGral[nX,1]
            nSubTotal -= aGral[nX,1]
        EndIf    
        
        If ((nX + 1) <= nTamArr) .And. (aGral[nX, 3] != aGral[nX + 1, 3]) // compara entidad actual con la siguiente
            oSection5:Cell("RUT"):SetValue(cRut)
            oSection5:Cell("NOMBRE"):SetValue(cDescri)
            oSection5:Cell("IMPOR"):SetValue(Transform(nSubTotal, cPict))
            oSection5:PrintLine()
            nSubTotal = 0
        EndIf
        nX++
        oRpt:IncMeter()
    EndDo
    If nSubTotal > 0    // compara entidad actual con la anterior
        oSection5:Cell("RUT"):SetValue(cRut)
        oSection5:Cell("NOMBRE"):SetValue(cDescri)
        oSection5:Cell("IMPOR"):SetValue(Transform(nSubTotal, cPict))    
        oSection5:PrintLine()
    EndIf
    oSection5:Cell("RUT"):SetValue("")
    oSection5:Cell("NOMBRE"):SetValue(STR0016 + cInst) //"T O T A L "
    oSection5:Cell("IMPOR"):SetValue(Transform(nTotal, cPict))
    oSection5:PrintLine()
    oSection4:Finish()
    oSection5:Finish()
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³Periodos   ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene los periodos a partir del rango de procesos         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ Periodos()                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ PrintReport()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function Periodos()
Local aPeriodos := {}
Local nX := 0
Local cCond := ''
Local cQuery := ''
Local cTempF := CriaTrab(Nil, .F.)
cCond := STRTRAN(cProc,'RD_PROCES','RCH_PROCES')
cQuery := "SELECT RCH_PER, RCH_NUMPAG, RCH_DTFECH, RCH_PROCES "
cQuery += "FROM "+RetSqlName("RCH")+" RCH "
cQuery += "WHERE RCH_FILIAL = '" + xFilial("RCH") +"' "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RCH_ROTEIR = '" + cTipnom + "' "
cQuery += "AND RCH_ANO = " + Alltrim(Str(nAnio)) + " "
cQuery += "AND RCH_MES = " + Padl(nMes,2,'0') + " "
cQuery += "AND D_E_L_E_T_ = '' "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aPeriodos, {(cTempF)->RCH_PER, (cTempF)->RCH_NUMPAG, (cTempF)->RCH_DTFECH, (cTempF)->RCH_PROCES})
    (cTempF)->(dbSkip())
EndDo
(cTempF)->(dbCloseArea())
If len(aPeriodos) > 0
    cPeriodosa := '('
    cPagosa := '('
    cPeriodosc := '('
    cPagosc := '('
    cProcesos := ''
    For nX := 1 to len(aPeriodos)
        If nX != len(aPeriodos)
            IF Empty(aPeriodos[nX,3])
            	IF len(cPeriodosa) == 1
            		cPeriodosa +=  "'" + aPeriodos[nX,1] + "'"
            		cPagosa    +=  "'" + aPeriodos[nX,2] + "'"
            	ELSE
               	cPeriodosa += ",'" + aPeriodos[nX,1] + "'"
                	cPagosa    += ",'" + aPeriodos[nX,2] + "'"
              ENDIF
            Else
            	IF 	len(cPeriodosc) == 1
            		cPeriodosc += "'" + aPeriodos[nX,1] + "'"
                	cPagosc    += "'" + aPeriodos[nX,2] + "'"
            	Else
                 cPeriodosc += ",'" + aPeriodos[nX,1] + "'"
                 cPagosc    += ",'" + aPeriodos[nX,2] + "'"
              EndIf
            EndIf
            cProcesos += Alltrim(aPeriodos[nX,4])+","
        Else
            If Empty(aPeriodos[nX,3])
              IF len(cPeriodosa) == 1
            		cPeriodosa +=  "'" + aPeriodos[nX,1] + "'"
            		cPagosa    +=  "'" + aPeriodos[nX,2] + "'"
            	ELSE
               	cPeriodosa += ",'" + aPeriodos[nX,1] + "'"
                	cPagosa    += ",'" + aPeriodos[nX,2] + "'"
              ENDIF
            Else
              IF 	len(cPeriodosc) == 1
            		cPeriodosc += "'" + aPeriodos[nX,1] + "'"
                	cPagosc    += "'" + aPeriodos[nX,2] + "'"
            	Else
                 cPeriodosc += ",'" + aPeriodos[nX,1] + "'"
                 cPagosc    += ",'" + aPeriodos[nX,2] + "'"
              EndIf
            EndIf
            cProcesos += Alltrim(aPeriodos[nX,4])
        EndIf
    Next nX
    cPeriodosa += ')'
    cPagosa += ')'
    cPeriodosc += ')'
    cPagosc += ')'
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PAIEC      ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene la informacion de la tabla SRC para los procesos    ³±±
±±³          ³ abiertos para el informe por institucion, empleado y concept³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PAIEC(nExp1)                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ nParte valor 1 y 2                                          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteIEC()                                                ³±±
±±ÚÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ TSKUE0   ³JR. BRiseno | Se agrega un parametro para controlar la parte ³±±
±±³          ³            | 1 y 2 de AFP                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PAIEC(nParte)
Local cTempF := CriaTrab(Nil, .F.)
Local cQuery := ''
Local cCond := ''
Local nScan := 0
Default nParte := 0

cCond := STRTRAN(cProc,'RD_PROCES','RC_PROCES')
cQuery := "SELECT RC_MAT, RA_CIC, RA_NOME, RC_PD, RV_DESC, SUM(RC_VALOR) SUMRC, RV_OPEINS, RC_ENTIDAD "
cQuery += "FROM "+RetSqlName("SRA")+" SRA, "
cQuery += RetSqlName("SRC")+" SRC, "
cQuery += RetSqlName("SRV")+" SRV "
cQuery += "WHERE RA_FILIAL = '"+xFilial("SRA")+"' "
cQuery += "AND RV_FILIAL = '"+xFilial("SRV", xFilial("SRA"))+"' "
cQuery += "AND RC_FILIAL = '"+xFilial("SRC", xFilial("SRA"))+"' "
cQuery += "AND RC_PD = RV_COD "
cQuery += "AND RA_MAT = RC_MAT "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RC_ROTEIR = '"+cTipnom+"' "
cQuery += "AND RC_PERIODO IN "+cPeriodosa+" "
cQuery += "AND RC_SEMANA IN "+cPagosa+" "
cQuery += "AND RV_TPOINS = '"+Alltrim(Str(nTipIns))+"' "
If (nTipIns == 1 .And. nParte == 1)
    cQuery += "AND (RC_ENTIDAD = RA_AFP " 
    cQuery += " OR SUBSTRING(RC_NUMID, 1, 3) != 'RG1') " 
ElseIf (nTipIns == 1 .And. nParte == 2)
    cQuery += "AND (RC_ENTIDAD != RA_AFP " 
    cQuery += "AND SUBSTRING(RC_NUMID, 1, 3) = 'RG1') "
EndIf
cQuery += "AND SRA.D_E_L_E_T_ = '' "
cQuery += "AND SRC.D_E_L_E_T_ = '' "
cQuery += "AND SRV.D_E_L_E_T_ = '' "
cQuery += "GROUP BY RC_ENTIDAD, RC_MAT, RA_CIC, RA_NOME, RC_PD, RV_DESC, RV_OPEINS "
cQuery += "ORDER BY RC_ENTIDAD, RC_MAT, RA_CIC, RA_NOME, RC_PD, RV_DESC, RV_OPEINS "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aIEC, {(cTempF)->RC_MAT, (cTempF)->RA_CIC, (cTempF)->RA_NOME, (cTempF)->RC_PD, (cTempF)->RV_DESC, (cTempF)->SUMRC, (cTempF)->RV_OPEINS, (cTempF)->RC_ENTIDAD})
    nScan := aScan(aConceptos, {|x|substr(x,1,3) == (cTempF)->RC_PD})
    If nScan == 0
        aAdd(aConceptos, (cTempF)->RC_PD + "-" + (cTempF)->RV_DESC)
    EndIf        
    (cTempF)->(dbSkip())
EndDo
aSort(aConceptos) //* ordenar lista de conceptos
(cTempF)->(dbCloseArea())
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PCIEC      ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene la informacion de la tabla SRD para los procesos    ³±±
±±³          ³ cerrados para el informe por institucion, empleado y concept³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PCIEC(nExp1)                                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteIEC()                                                ³±±
±±ÚÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ TSKUE0   ³JR. BRiseno | Se agrega un parametro para controlar la parte ³±±
±±³          ³            | 1 y 2 de AFP                                   ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PCIEC(nParte)
Local cTempF := CriaTrab(Nil, .F.)
Local cQuery := ''
Local cCond := ''
Local nScan := 0
Default nParte := 0

cCond := cProc
cQuery := "SELECT RD_MAT, RA_CIC, RA_NOME, RD_PD, RV_DESC, SUM(RD_VALOR) SUMRD, RV_OPEINS, RD_ENTIDAD "
cQuery += "FROM "+RetSqlName("SRA")+" SRA, "
cQuery += RetSqlName("SRD")+" SRD, "
cQuery += RetSqlName("SRV")+" SRV "
cQuery += "WHERE RA_FILIAL = '"+xFilial("SRA")+"' "
cQuery += "AND RV_FILIAL = '"+xFilial("SRV", xFilial("SRA"))+"' "
cQuery += "AND RD_FILIAL = '"+xFilial("SRD", xFilial("SRA"))+"' "
cQuery += "AND RD_PD = RV_COD "
cQuery += "AND RA_MAT = RD_MAT "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RD_ROTEIR = '"+cTipnom+"' "
cQuery += "AND RD_PERIODO IN "+cPeriodosc+" "
cQuery += "AND RD_SEMANA IN "+cPagosc+" "
cQuery += "AND RV_TPOINS = '"+Alltrim(Str(nTipIns))+"' "
If (nTipIns == 1 .And. nParte == 1)
    cQuery += "AND (RD_ENTIDAD = RA_AFP " 
    cQuery += " OR SUBSTRING(RD_NUMID, 1, 3) != 'RG1') "
ElseIf (nTipIns == 1 .And. nParte == 2)
    cQuery += "AND (RD_ENTIDAD != RA_AFP " 
    cQuery += "AND SUBSTRING(RD_NUMID, 1, 3) = 'RG1') "
EndIf
cQuery += "AND SRA.D_E_L_E_T_ = '' "
cQuery += "AND SRD.D_E_L_E_T_ = '' "
cQuery += "AND SRV.D_E_L_E_T_ = '' "
cQuery += "GROUP BY RD_ENTIDAD, RD_MAT, RA_CIC, RA_NOME, RD_PD, RV_DESC, RV_OPEINS "
cQuery += "ORDER BY RD_ENTIDAD, RD_MAT, RA_CIC, RA_NOME, RD_PD, RV_DESC, RV_OPEINS "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aIEC, {(cTempF)->RD_MAT, (cTempF)->RA_CIC, (cTempF)->RA_NOME, (cTempF)->RD_PD, (cTempF)->RV_DESC, (cTempF)->SUMRD, (cTempF)->RV_OPEINS, (cTempF)->RD_ENTIDAD})
    nScan := aScan(aConceptos, {|x|substr(x,1,3) == (cTempF)->RD_PD})
    If nScan == 0
        aAdd(aConceptos, (cTempF)->RD_PD + "-" + (cTempF)->RV_DESC)
    EndIf
    (cTempF)->(dbSkip())
EndDo
aSort(aConceptos) //* ordenar lista de conceptos
(cTempF)->(dbCloseArea())
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PCInstitu  ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene la informacion de la tabla SRD para los procesos    ³±±
±±³          ³ cerrados para el informe por institucion                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PCInstitu()                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteInst()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PCInstitu()
Local cTempF := CriaTrab(Nil, .F.)
Local cQuery := ''
Local cCond := ''
Local nScan := 0

cCond := cProc
cQuery := "SELECT RD_PD, RV_DESC, SUM(RD_VALOR) SUMRD, RV_OPEINS, RD_ENTIDAD "
cQuery += "FROM "+RetSqlName("SRA")+" SRA, "
cQuery += RetSqlName("SRD")+" SRD, "
cQuery += RetSqlName("SRV")+" SRV "
cQuery += "WHERE RA_FILIAL = '"+xFilial("SRA")+"' "
cQuery += "AND RV_FILIAL = '"+xFilial("SRV", xFilial("SRA"))+"' "
cQuery += "AND RD_FILIAL = '"+xFilial("SRD", xFilial("SRA"))+"' "
cQuery += "AND RD_PD = RV_COD "
cQuery += "AND RA_MAT = RD_MAT "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RD_ROTEIR = '"+cTipnom+"' "
cQuery += "AND RD_PERIODO IN "+cPeriodosc+" "
cQuery += "AND RD_SEMANA IN "+cPagosc+" "
cQuery += "AND RV_TPOINS = '"+Alltrim(Str(nTipIns))+"' "
If nTipIns == 1
    cQuery += "AND (RD_ENTIDAD = RA_AFP " 
    cQuery += " OR SUBSTRING(RD_NUMID, 1, 3) != 'RG1') "
ElseIf nTipIns == 6
    cQuery := REPLACE(cQuery, "AND RV_TPOINS = '6' ", "AND RV_TPOINS = '1' ") 
    cQuery += "AND (RD_ENTIDAD != RA_AFP " 
    cQuery += " AND SUBSTRING(RD_NUMID, 1, 3) = 'RG1') "  
EndIf
cQuery += "AND SRA.D_E_L_E_T_ = '' "
cQuery += "AND SRD.D_E_L_E_T_ = '' "
cQuery += "AND SRV.D_E_L_E_T_ = '' "
cQuery += "GROUP BY RD_ENTIDAD, RD_PD, RV_DESC, RV_OPEINS "
cQuery += "ORDER BY RD_ENTIDAD, RD_PD, RV_DESC, RV_OPEINS "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aInst, {(cTempF)->RD_PD, (cTempF)->RV_DESC, (cTempF)->SUMRD, (cTempF)->RV_OPEINS, (cTempF)->RD_ENTIDAD})
    nScan := aScan(aConceptos, {|x|substr(x,1,3) == (cTempF)->RD_PD})
    If nScan == 0
        aAdd(aConceptos, (cTempF)->RD_PD + "-" + (cTempF)->RV_DESC)
    EndIf
    (cTempF)->(dbSkip())
EndDo
aSort(aConceptos) //* ordenar lista de conceptos
(cTempF)->(dbCloseArea())
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PAInstitu  ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene la informacion de la tabla SRC para los procesos    ³±±
±±³          ³ abiertos para el informe por institucion                    ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PAInstitu()                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteInst()                                               ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PAInstitu()
Local cTempF := CriaTrab(Nil, .F.)
Local cQuery := ''
Local cCond := ''
Local nScan := 0

cCond := STRTRAN(cProc,'RD_PROCES','RC_PROCES')
cQuery := "SELECT RC_PD, RV_DESC, SUM(RC_VALOR) SUMRC, RV_OPEINS, RC_ENTIDAD "
cQuery += "FROM "+RetSqlName("SRA")+" SRA, "
cQuery += RetSqlName("SRC")+" SRC, "
cQuery += RetSqlName("SRV")+" SRV "
cQuery += "WHERE RA_FILIAL = '"+xFilial("SRA")+"' "
cQuery += "AND RV_FILIAL = '"+xFilial("SRV", xFilial("SRA"))+"' "
cQuery += "AND RC_FILIAL = '"+xFilial("SRC", xFilial("SRA"))+"' "
cQuery += "AND RC_PD = RV_COD "
cQuery += "AND RA_MAT = RC_MAT "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RC_ROTEIR = '"+cTipnom+"' "
cQuery += "AND RC_PERIODO IN "+cPeriodosa+" "
cQuery += "AND RC_SEMANA IN "+cPagosa+" "
cQuery += "AND RV_TPOINS = '"+Alltrim(Str(nTipIns))+"' "
If nTipIns == 1
    cQuery += "AND (RC_ENTIDAD = RA_AFP " 
    cQuery += " OR SUBSTRING(RC_NUMID, 1, 3) != 'RG1') "
ElseIf nTipIns == 6
    cQuery := REPLACE(cQuery, "AND RV_TPOINS = '6' ", "AND RV_TPOINS = '1' ") 
    cQuery += "AND (RC_ENTIDAD != RA_AFP " 
    cQuery += " AND SUBSTRING(RC_NUMID, 1, 3) = 'RG1') "  
EndIf
cQuery += "AND SRA.D_E_L_E_T_ = '' "
cQuery += "AND SRC.D_E_L_E_T_ = '' "
cQuery += "AND SRV.D_E_L_E_T_ = '' "
cQuery += "GROUP BY RC_ENTIDAD, RC_PD, RV_DESC, RV_OPEINS "
cQuery += "ORDER BY RC_ENTIDAD, RC_PD, RV_DESC, RV_OPEINS "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aInst, {(cTempF)->RC_PD, (cTempF)->RV_DESC, (cTempF)->SUMRC, (cTempF)->RV_OPEINS, (cTempF)->RC_ENTIDAD})
    nScan := aScan(aConceptos, {|x|substr(x,1,3) == (cTempF)->RC_PD})
    If nScan == 0
        aAdd(aConceptos, (cTempF)->RC_PD + "-" + (cTempF)->RV_DESC)
    EndIf  
    (cTempF)->(dbSkip())
EndDo
aSort(aConceptos) //* ordenar lista de conceptos
(cTempF)->(dbCloseArea())
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PCGeneral  ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene la informacion de la tabla SRD para los procesos    ³±±
±±³          ³ cerrados para el informe general por institucion            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PCGeneral()                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteGeneral()                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PCGeneral()
Local cTempF := CriaTrab(Nil, .F.)
Local cQuery := ''
Local cCond := ''

cCond := cProc
cQuery := "SELECT SUM(RD_VALOR) SUMRD, RD_ENTIDAD, RV_OPEINS "
cQuery += "FROM "+RetSqlName("SRA")+" SRA, "
cQuery += RetSqlName("SRD")+" SRD, "
cQuery += RetSqlName("SRV")+" SRV "
cQuery += "WHERE RA_FILIAL = '"+xFilial("SRA")+"' "
cQuery += "AND RV_FILIAL = '"+xFilial("SRV", xFilial("SRA"))+"' "
cQuery += "AND RD_FILIAL = '"+xFilial("SRD", xFilial("SRA"))+"' "
cQuery += "AND RD_PD = RV_COD "
cQuery += "AND RA_MAT = RD_MAT "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RD_ROTEIR = '"+cTipnom+"' "
cQuery += "AND RD_PERIODO IN "+cPeriodosc+" "
cQuery += "AND RD_SEMANA IN "+cPagosc+" "
cQuery += "AND RV_TPOINS = '"+Alltrim(Str(nTipIns))+"' "
If nTipIns == 1
    cQuery += "AND (RD_ENTIDAD = RA_AFP " 
    cQuery += " OR SUBSTRING(RD_NUMID, 1, 3) != 'RG1') "
ElseIf nTipIns == 6
    cQuery := REPLACE(cQuery, "AND RV_TPOINS = '6' ", "AND RV_TPOINS = '1' ")
    cQuery += "AND (RD_ENTIDAD != RA_AFP " 
    cQuery += " AND SUBSTRING(RD_NUMID, 1, 3) = 'RG1') "
EndIf
cQuery += "AND SRA.D_E_L_E_T_ = '' "
cQuery += "AND SRD.D_E_L_E_T_ = '' "
cQuery += "AND SRV.D_E_L_E_T_ = '' "
cQuery += "GROUP BY RD_ENTIDAD, RD_PD, RV_OPEINS "
cQuery += "ORDER BY RD_ENTIDAD, RD_PD, RV_OPEINS "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aGral, {(cTempF)->SUMRD, (cTempF)->RV_OPEINS, (cTempF)->RD_ENTIDAD})
    (cTempF)->(dbSkip())
EndDo
(cTempF)->(dbCloseArea())
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³PAGeneral  ³ Autor ³ Jesus Peñaloza        ³ Data ³03/10/2014³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Obtiene la informacion de la tabla SRC para los procesos    ³±±
±±³          ³ abiertos para el informe general por institucion            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ PAGeneral()                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³                                                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ ReporteGeneral()                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Static Function PAGeneral()
Local cTempF := CriaTrab(Nil, .F.)
Local cQuery := ''
Local cCond := ''

cCond := STRTRAN(cProc,'RD_PROCES','RC_PROCES')
cQuery := "SELECT SUM(RC_VALOR) SUMRC, RC_ENTIDAD, RV_OPEINS "
cQuery += "FROM "+RetSqlName("SRA")+" SRA, "
cQuery += RetSqlName("SRC")+" SRC, "
cQuery += RetSqlName("SRV")+" SRV "
cQuery += "WHERE RA_FILIAL = '"+xFilial("SRA")+"' "
cQuery += "AND RV_FILIAL = '"+xFilial("SRV", xFilial("SRA"))+"' "
cQuery += "AND RC_FILIAL = '"+xFilial("SRC", xFilial("SRA"))+"' "
cQuery += "AND RC_PD = RV_COD "
cQuery += "AND RA_MAT = RC_MAT "
IF LEN(ALLTRIM(cCond)) > 0
	cQuery += "AND "+cCond+" "
ENDIF
cQuery += "AND RC_ROTEIR = '"+cTipnom+"' "
cQuery += "AND RC_PERIODO IN "+cPeriodosa+" "
cQuery += "AND RC_SEMANA IN "+cPagosa+" "
cQuery += "AND RV_TPOINS = '"+Alltrim(Str(nTipIns))+"' "
If nTipIns == 1
    cQuery += "AND (RC_ENTIDAD = RA_AFP " 
    cQuery += " OR SUBSTRING(RC_NUMID, 1, 3) != 'RG1') "
ElseIf nTipIns == 6
    cQuery := REPLACE(cQuery, "AND RV_TPOINS = '6' ", "AND RV_TPOINS = '1' ")
    cQuery += "AND (RC_ENTIDAD != RA_AFP " 
    cQuery += " AND SUBSTRING(RC_NUMID, 1, 3) = 'RG1') "
EndIf
cQuery += "AND SRA.D_E_L_E_T_ = '' "
cQuery += "AND SRC.D_E_L_E_T_ = '' "
cQuery += "AND SRV.D_E_L_E_T_ = '' "
cQuery += "GROUP BY RC_ENTIDAD, RC_PD, RV_OPEINS  "
cQuery += "ORDER BY RC_ENTIDAD, RC_PD, RV_OPEINS  "
cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cTempF,.T.,.T.)
(cTempF)->(dbGoTop())
While (!(cTempF)->(EOF()))
    aAdd(aGral, {(cTempF)->SUMRC, (cTempF)->RV_OPEINS, (cTempF)->RC_ENTIDAD})
    (cTempF)->(dbSkip())
EndDo
(cTempF)->(dbCloseArea())
Return

#INCLUDE "PROTHEUS.CH"

/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡„o    ³GPEXSRC   ³ Autor ³ Marinaldo de Jesus    ³ Data ³06/12/2004³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡„o ³Biblioteca de Funcoes Genericas para uso em Formulas no SRC ³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³ Uso      ³ Generico                                                   ³
ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³         ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL.             ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Programador ³ Data     ³ BOPS  ³Motivo da Alteracao                    ³
ÃÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Mauricio T. ³29/08/06  ³-------³Alterar o Default da Data e Processo,  ³
³            ³          ³       ³pois em recalculo de periodos para proc³
³            ³          ³       ³essos diferente nao trocam esses campos³
³Mauricio T. ³05/10/06  ³-------³Tratamento para AS/400.                ³
³Mauricio T. ³18/01/2007³109389-³Reutilizacao do Objeto SRC.            ³
³Kelly       ³04/05/2007³-------³Novas funcoes GetSrc13, WhereSrc13 e   ³
³            ³          ³       ³GetRot131 para carga da antecipacao do ³
³            ³          ³       ³13 salario no SRC.                     ³
³Kelly       ³20/06/2007³-------³Ajuste na funcao GetSrc13 para guardar ³
³            ³          ³       ³o alias atual.                         ³
³Kelly       ³23/10/2007³-------³Ajuste no filtro de roteiros da funcao ³
³            ³          ³       ³GetRot131 para DBF.					³
³Kelly       ³31/10/2007³-------³Ajuste na funcao GetSrc para deletar   ³
³            ³          ³       ³verbas de adiantamento; Ajuste na    	³
³            ³          ³       ³funcao GetSrc13; Exclusao da WhereSrc13³
³            ³          ³       ³e da GetRot131; Novas funcoes GetSrcAdi³
³            ³          ³       ³e GetSrcIR.							³
|Gisele V.   |25/02/2008|-------|Incluida funcão GetSrcIS para buscar no|
|            |          |       |SRC verba de insuficiência de saldo do |
|            |          |       |roteiro 132.							|
³Silvia Tag. ³29/02/2008³138113 ³Localizacao Bolivia - Ajuste na chmada ³
|            |          |       |do Periodo para Adiantamento           ³ 
³Erika K.    ³29/08/2008³152930 ³Ajuste nos nomes dos roteiros (Chamada ³ 
|            |          |       |da funcao fGetCalcRot() ).             ³  
³Kelly       ³01/12/2008³5530-  ³Excluir lancamentos informados (I) p/  ³ 
|            |          |2008   |paises que possuem armazenamento de    ³  
|            |          |2008   |lancamentos do usuario no RGB.         ³  
³Kelly       ³07/08/2009³-------³Alteracao da GetSrcAdi() pra tratamento³ 
³            ³          ³       ³especifico da Argentina.             	³
³Claudinei S.³03/12/2012³ TGEBDG³Ajuste na funcao GetSrc para deletar as³ 
³            ³          ³       ³verbas informadas tambem no PER.       ³
³R.Berti     ³29/01/2013³ TGFIJ5³Incluido ROTEIRO como param.opcional em³ 
³            ³          ³       ³GetSRCAdi() p/permitir (em formulas de ³
³            ³          ³       ³rescisao, por ex.) acum.verbas ja'pagas³
³            ³          ³       ³em FOL - vide ex.em S_CALBFRON(BOLIVIA)³
³WinstonCosta³04/01/2019³-------³Retirada Tratamento para AS/400.       ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³GetSrc		    ³Autor³Marinaldo de Jesus ³ Data ³06/12/2004³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Obtem as Informacoes do SRC									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Generica      										    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function GetSrc( cQueryWhere , lSqlWhere , lTopFilter )

Local cKey
Local cRetOrder
Local lGetSrc
Local nSrcOrder

IF Empty( cQueryWhere )
	cQueryWhere := WhereSrc()
	#IFDEF TOP
		cQueryWhere := "RC_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RC_MAT='" + SRA->RA_MAT + "' AND " + cQueryWhere
		IF !Empty( cQueryWhere )
			lSqlWhere	:= .T.
		EndIF
	#ENDIF
EndIF

cRetOrder := "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD"
nSrcOrder := RetOrder( "SRC" , cRetOrder , .T. )
IF ( nSrcOrder == 0 )
	cRetOrder	:= "RC_FILIAL+RC_MAT"
	nSrcOrder	:= RetOrder( "SRC" , cRetOrder , .F. )
EndIF

IF ( cRetOrder == "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD" )
	cKey	:= ( SRA->( RA_FILIAL + RA_MAT ) + RcPeriodoInit() + RcRoteirInit() + RcNumPgInit())
Else
	cKey	:= SRA->( RA_FILIAL + RA_MAT )
EndIF

//Eh necessario ter o Mnemonico oSrc ( Tipo Private para reinicializar a cada registro )
IF (( ValType( oSrc ) == "O" ) .and.;
	( Len(oSrc:aHeader) > 0 ))
	oSrc:GetCols( nSrcOrder , cKey , cQueryWhere , lSqlWhere )
Else
	oSrc	:= GetDetFormula():New( "SRC" , nSrcOrder , cKey , cQueryWhere , @lSqlWhere , @lTopFilter )
EndIf

lGetSrc	:= oSrc:GetOk()
IF ( lGetSrc )                                             

	//Limpar o campo valor dos registros calculados, pois podera ser reaproveitado este registro
	oSrc:Default( { "RC_HORAS" , "RC_VALOR" , "RC_DATA", "RC_VNAOAPL", "RC_DATA", "RC_PROCES" }, { "RC_TIPO2" }, { "C" } )
	oSrc:Default( { "RC_HORAS" , "RC_VALOR" , "RC_DATA", "RC_VNAOAPL", "RC_DATA", "RC_PROCES" }, { "RC_TIPO2" }, { "K" } )
	oSrc:Default( { "RC_HORAS" , "RC_VALOR" , "RC_DATA", "RC_VNAOAPL", "RC_DATA", "RC_PROCES" }, { "RC_TIPO2" }, { "P" } )
	oSrc:Default( { "RC_HORAS" , "RC_VALOR" , "RC_DATA", "RC_VNAOAPL", "RC_DATA", "RC_PROCES" }, { "RC_TIPO2" }, { "S" } )
	oSrc:Default( { "RC_HORAS" , "RC_VALOR" , "RC_DATA", "RC_VNAOAPL", "RC_DATA", "RC_PROCES", "RC_VALINFO" , "RC_HORINFO" }, { "RC_TIPO2" }, { "I" } )
	
	oSrc:Del( { "RC_VALINFO" , "RC_HORINFO" , "RC_TIPO2" } , { 0 , 0 , "C" } )	//Calculado
	oSrc:Del( { "RC_VALINFO" , "RC_HORINFO" , "RC_TIPO2" } , { 0 , 0 , "K" } )	//Ferias
	oSrc:Del( { "RC_VALINFO" , "RC_HORINFO" , "RC_TIPO2" } , { 0 , 0 , "P" } )	//Primeira Parcela 13o.
	oSrc:Del( { "RC_VALINFO" , "RC_HORINFO" , "RC_TIPO2" } , { 0 , 0 , "S" } )	//Segunda Parcela 13o.
	oSrc:Del( { "RC_VALINFO" , "RC_HORINFO" , "RC_TIPO2" } , { 0 , 0 , "A" } )	//Adiantamento
	If cPaisLoc $ "ARG|COL|PTG|VEN|ANG|PER|BOL"
		oSrc:Del( { "RC_VALINFO" , "RC_HORINFO" , "RC_TIPO2" } , { 0 , 0 , "I" } )	//Informado - carregado do RGB
	Endif	
EndIF

Return( lGetSrc )

/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³PutSrc			³Autor³Marinaldo de Jesus ³ Data ³06/12/2004³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Grava as Informacoes do SRC									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Generica      										    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function PutSrc(oObj)

Local aFieldsDel	:= Array( 5 )
Local aCntsDel		:= Array( 5 )
DEFAULT oObj := oSrc

aFieldsDel[1] := "RC_VALINFO"	; aCntsDel[1] := 0
aFieldsDel[2] := "RC_HORINFO"	; aCntsDel[2] := 0
aFieldsDel[3] := "RC_VALOR"		; aCntsDel[3] := 0
aFieldsDel[4] := "RC_HORAS"		; aCntsDel[4] := 0
aFieldsDel[5] := "RC_VNAOAPL"	; aCntsDel[5] := 0
                         
/*/
ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³ Se algum movimento estiver com a data em branco, preencer com³
³ a data default do SX3                                        ³
ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
If oObj == oSrc
	oObj:Default( { "RC_DATA" }, { "RC_DATA" }, { CTOD("//") },, .T. )
EndIf

Return( oObj:Put( aFieldsDel , aCntsDel ) )


/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³WhereSrc		³Autor³Marinaldo de Jesus ³ Data ³23/12/2004³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Retorna a Clausula Where para o SRC							³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Where para o SRC									    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function WhereSrc()

Local cQueryWhere

#IFDEF TOP
	cQueryWhere := " RC_PERIODO='" + RcPeriodoInit() + "'"
	cQueryWhere += " AND "
	cQueryWhere += "RC_SEMANA='" + RcNumPgInit() + "'"
	cQueryWhere += " AND "
	cQueryWhere += "RC_ROTEIR='" + RcRoteirInit() + "'"
	cQueryWhere += " AND "
	cQueryWhere += "D_E_L_E_T_<>'*' "
#ELSE
	cQueryWhere := " RC_PERIODO=='" + RcPeriodoInit() + "'"
	cQueryWhere += " .AND. "
	cQueryWhere += "RC_SEMANA=='" + RcNumPgInit() + "'"
	cQueryWhere += " .AND. "
	cQueryWhere += "RC_ROTEIR=='" + RcRoteirInit() + "'"
#ENDIF

Return( cQueryWhere )


/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³ClonaSRC		³Autor³Kelly Soares       ³ Data ³21/08/2006³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Clona o objeto SRC                     						³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Calculo de rescisao - GPEM040						    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function ClonaSRC()

oSRCClone:aCols := aClone(oSRC:aCols)
           
Return ( nil )

/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³GetSrc13	    ³Autor³Kelly Soares       ³ Data ³31/10/2007³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Obtem as Informacoes do SRC referentes a antecipacao de 13o.³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Generica      										    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function GetSrc13( cQueryWhere , lSqlWhere , lTopFilter )

Local aArea := GetArea()

Local cKey
Local cRetOrder
Local lGetSrc
Local nSrcOrder 
Local cRotCalc := ""
                  
IF Empty( cQueryWhere )
                                            
cRotCalc := fGetCalcRot("5") //"131"

	#IFDEF TOP                              
		cQueryWhere := " RC_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RC_MAT='" + SRA->RA_MAT + "' AND "
		cQueryWhere += " RC_PERIODO='" + cPeriodo + "' AND RC_SEMANA='  ' AND "
		cQueryWhere += " RC_ROTEIR='" + cRotCalc + "' AND D_E_L_E_T_<>'*' "
		lSqlWhere	:= .T.
	#ELSE
		cQueryWhere := " RC_PERIODO=='" + cPeriodo + "' .AND. RC_SEMANA=='  ' .AND. "
		cQueryWhere += " RC_ROTEIR='" + cRotCalc + "'"
	#ENDIF

EndIF

cRetOrder := "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD"
nSrcOrder := RetOrder( "SRC" , cRetOrder , .T. )
IF ( nSrcOrder == 0 )
	cRetOrder	:= "RC_FILIAL+RC_MAT"
	nSrcOrder	:= RetOrder( "SRC" , cRetOrder , .F. )
EndIF

IF ( cRetOrder == "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD" )
	cKey	:= ( SRA->( RA_FILIAL + RA_MAT ) + cPeriodo + cRotCalc + cNumPag )
Else
	cKey	:= SRA->( RA_FILIAL + RA_MAT )
EndIF

IF (( ValType( oSrc ) == "O" ) .and.;
	( Len(oSrc:aHeader) > 0 ))
	oSrc:GetCols( nSrcOrder , cKey , cQueryWhere , lSqlWhere )
Else
	oSrc	:= GetDetFormula():New( "SRC" , nSrcOrder , cKey , cQueryWhere , @lSqlWhere , @lTopFilter )
EndIf

lGetSrc	:= oSrc:GetOk()

RestArea(aArea)

Return ( lGetSrc )

/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³GetSrcAdi	    ³Autor³Kelly Soares       ³ Data ³31/10/2007³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Obtem as Informacoes do SRC referentes ao adiantamento.		³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Generica      										    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function GetSrcAdi( cQueryWhere , lSqlWhere , lTopFilter, cRotCalc )

Local aArea := GetArea()

Local cKey
Local cRetOrder
Local lGetSrc
Local nSrcOrder
Local cNumPCalc := If(cPaisLoc == "BRA", '  ', cNumPag)

DEFAULT cRotCalc := If(cPaisLoc $ "BRA|PTG|ANG", 'ADI', 'ANT')

                  
IF Empty( cQueryWhere )

	If cPaisLoc == "ARG"
	
		#IFDEF TOP
			cQueryWhere := " RC_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RC_MAT='" + SRA->RA_MAT + "' AND "
			cQueryWhere += " RC_PERIODO='" + cPeriodo + "' AND "
			cQueryWhere += " RC_ROTEIR= '" + cRotCalc + "' AND D_E_L_E_T_<>'*' "
	
			lSqlWhere	:= .T.
		#ELSE
			cQueryWhere := " RC_PERIODO=='" + cPeriodo + "' .AND. "
			cQueryWhere += " RC_ROTEIR= '" + cRotCalc + "'
		#ENDIF

    Else  // Demais paises

		#IFDEF TOP
			cQueryWhere := " RC_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RC_MAT='" + SRA->RA_MAT + "' AND "
			cQueryWhere += " RC_PERIODO='" + cPeriodo + "' AND RC_SEMANA='" +cNumPCalc+ "' AND "
			cQueryWhere += " RC_ROTEIR= '" + cRotCalc + "' AND D_E_L_E_T_<>'*' "

			lSqlWhere	:= .T.
		#ELSE
			cQueryWhere := " RC_PERIODO=='" + cPeriodo + "' .AND. RC_SEMANA=='" +cNumPCalc+ "' .AND. "
			cQueryWhere += " RC_ROTEIR= '" + cRotCalc + "'
		#ENDIF

    Endif

EndIF

cRetOrder := "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD"
nSrcOrder := RetOrder( "SRC" , cRetOrder , .T. )
IF ( nSrcOrder == 0 )
	cRetOrder	:= "RC_FILIAL+RC_MAT"
	nSrcOrder	:= RetOrder( "SRC" , cRetOrder , .F. )
EndIF

IF ( cRetOrder == "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD" )
	If cPaisLoc == "ARG"
		cKey	:= ( SRA->( RA_FILIAL + RA_MAT ) + cPeriodo + cRotCalc )
	Else
		cKey	:= ( SRA->( RA_FILIAL + RA_MAT ) + cPeriodo + cRotCalc + cNumPag )
	Endif
Else
	cKey	:= SRA->( RA_FILIAL + RA_MAT )
EndIF

IF (( ValType( oSrc ) == "O" ) .and.;
	( Len(oSrc:aHeader) > 0 ))
	oSrc:GetCols( nSrcOrder , cKey , cQueryWhere , lSqlWhere )
Else
	oSrc	:= GetDetFormula():New( "SRC" , nSrcOrder , cKey , cQueryWhere , @lSqlWhere , @lTopFilter )
EndIf

lGetSrc	:= oSrc:GetOk()

RestArea(aArea)

Return ( lGetSrc )

/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³GetSrcIR 	    ³Autor³Kelly Soares       ³ Data ³31/10/2007³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Obtem as Informacoes do SRC referentes ao IR na folha.      ³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Generica      										    	³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function GetSrcIR( cQueryWhere , lSqlWhere , lTopFilter )

Local aArea := GetArea()

Local cKey
Local cRetOrder
Local lGetSrc
Local nSrcOrder  
Local cRotCalc := ""

cRotCalc := fGetCalcRot("1") //"FOL"
                  
IF Empty( cQueryWhere )

	#IFDEF TOP
		cQueryWhere := " RC_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RC_MAT='" + SRA->RA_MAT + "' AND "
		cQueryWhere += " RC_PERIODO='" + cPeriodo + "' AND RC_SEMANA='  ' AND RC_ROTEIR='" + cRotCalc + "' AND "
		cQueryWhere += " ( RC_PD='" + FGETCODFOL("0106") + "' OR RC_PD='" + FGETCODFOL("0107") + "' ) AND "
		cQueryWhere += " D_E_L_E_T_<>'*' "

		lSqlWhere	:= .T.
	#ELSE
		cQueryWhere := " RC_PERIODO=='" + cPeriodo + "' .AND. RC_SEMANA=='  ' .AND. RC_ROTEIR='"+ cRotCalc + "' .AND. "
		cQueryWhere += " ( RC_PD='" + FGETCODFOL("0106") + "' .OR. RC_PD='" + FGETCODFOL("0107") + "' ) "
	#ENDIF

EndIF

cRetOrder := "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD"
nSrcOrder := RetOrder( "SRC" , cRetOrder , .T. )
IF ( nSrcOrder == 0 )
	cRetOrder	:= "RC_FILIAL+RC_MAT"
	nSrcOrder	:= RetOrder( "SRC" , cRetOrder , .F. )
EndIF

IF ( cRetOrder == "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD" )
	cKey	:= ( SRA->( RA_FILIAL + RA_MAT ) + cPeriodo + cRotCalc + cNumPag )
Else
	cKey	:= SRA->( RA_FILIAL + RA_MAT )
EndIF

IF (( ValType( oSrc ) == "O" ) .and.;
	( Len(oSrc:aHeader) > 0 ))
	oSrc:GetCols( nSrcOrder , cKey , cQueryWhere , lSqlWhere )
Else
	oSrc	:= GetDetFormula():New( "SRC" , nSrcOrder , cKey , cQueryWhere , @lSqlWhere , @lTopFilter )
EndIf

lGetSrc	:= oSrc:GetOk()

RestArea(aArea)

Return ( lGetSrc )
/*/
ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
³Fun‡…o	   ³GetSrcIS	    ³Autor³Gisele Varandas    ³ Data ³   22/02/2008  ³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Descri‡…o ³Obtem as Informacoes do SRC refe. a insulficiencia  de saldo 13o.³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Sintaxe   ³<Vide Parametros Formais>							      	     ³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Parametros³<Vide Parametros Formais>									     ³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Retorno   ³NIL                      									     ³
ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´
³Uso	   ³Generica      										    	     ³
ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ/*/
Function GetSrcIS( cQueryWhere , lSqlWhere , lTopFilter )

Local aArea := GetArea()

Local cKey
Local cRetOrder
Local lGetSrc
Local nSrcOrder                     
Local cRotCalc := ""

cRotCalc := fGetCalcRot("6") //"132"
                  
IF Empty( cQueryWhere )

	#IFDEF TOP
		cQueryWhere := " RC_FILIAL='" + SRA->RA_FILIAL + "' AND " + "RC_MAT='" + SRA->RA_MAT + "' AND "
		cQueryWhere += " RC_PERIODO='" + cPeriodo + "' AND RC_SEMANA='  ' AND "
		cQueryWhere += " RC_ROTEIR='" + cRotCalc + "' AND ( RC_PD='" + FGETCODFOL("0030") + "' ) AND D_E_L_E_T_<>'*' "

		lSqlWhere	:= .T.
	#ELSE
		cQueryWhere := " RC_PERIODO=='" + cPeriodo + "' .AND. RC_SEMANA=='  ' .AND. "
		cQueryWhere += " RC_ROTEIR='" + cRotCalc + "' AND ( RC_PD='" + FGETCODFOL("0030") + "' )"
	#ENDIF

EndIF

cRetOrder := "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD"
nSrcOrder := RetOrder( "SRC" , cRetOrder , .T. )
IF ( nSrcOrder == 0 )
	cRetOrder	:= "RC_FILIAL+RC_MAT"
	nSrcOrder	:= RetOrder( "SRC" , cRetOrder , .F. )
EndIF

IF ( cRetOrder == "RC_FILIAL+RC_MAT+RC_PERIODO+RC_ROTEIR+RC_SEMANA+RC_PD" )
	cKey	:= ( SRA->( RA_FILIAL + RA_MAT ) + cPeriodo + cRotCalc + cNumPag )
Else
	cKey	:= SRA->( RA_FILIAL + RA_MAT )
EndIF

IF (( ValType( oSrc ) == "O" ) .and.;
	( Len(oSrc:aHeader) > 0 ))
	oSrc:GetCols( nSrcOrder , cKey , cQueryWhere , lSqlWhere )
Else
	oSrc	:= GetDetFormula():New( "SRC" , nSrcOrder , cKey , cQueryWhere , @lSqlWhere , @lTopFilter )
EndIf

lGetSrc	:= oSrc:GetOk()

RestArea(aArea)

Return ( lGetSrc )

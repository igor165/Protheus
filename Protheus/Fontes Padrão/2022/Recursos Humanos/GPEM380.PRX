#include "PROTHEUS.CH"
#INCLUDE "GPEM380.CH"
/*/
эээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээээ
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
╠╠зддддддддддбддддддддддбдддддддбдддддддддддддддддддддддбддддддбдддддддддд©╠╠
╠╠ЁFun┤┘o    Ё GPEM380  Ё Autor Ё Marcos Stiefano       Ё Data Ё 26/06/95 Ё╠╠
╠╠цддддддддддеддддддддддадддддддадддддддддддддддддддддддаддддддадддддддддд╢╠╠
╠╠ЁDescri┤┘o Ё Limpeza Saldos FGTS                                        Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁSintaxe   Ё GPEM380(void)                                              Ё╠╠
╠╠цддддддддддедддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё Uso      Ё Limpar Lancamentos SRS                                     Ё╠╠
╠╠цддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠Ё         ATUALIZACOES SOFRIDAS DESDE A CONSTRU─AO INICIAL.             Ё╠╠
╠╠цддддддддддддбддддддддбддддддбдддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁProgramador Ё Data   Ё BOPS Ё  Motivo da Alteracao                     Ё╠╠
╠╠цддддддддддддеддддддддеддддддедддддддддддддддддддддддддддддддддддддддддд╢╠╠
╠╠ЁCecilia Car.Ё15/05/14ЁTPPCSBЁIncluido o fonte da 11 para a 12 e efetua-Ё╠╠
╠╠Ё            Ё        Ё      Ёda a limpeza.                             Ё╠╠
╠╠юддддддддддддаддддддддаддддддадддддддддддддддддддддддддддддддддддддддддды╠╠
╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠╠
ъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъъ*/
Function GPEM380()
Local aSays:={ }, aButtons:= { } //<== arrays locais de preferencia
Private cCadastro := OemToAnsi(STR0001) //"Limpeza Saldos F.G.T.S."

	nOpca := 0
	Pergunte("GPM380",.F.)

	AADD(aSays,OemToAnsi(STR0002) )  //" Este programa fara a limpeza do arquivo de saldos FGTS (SRS), limpando"
	AADD(aSays,OemToAnsi(STR0003) )  //" o arquivo ate a data de referencia escolhida."

	AADD(aButtons, { 5,.T.,{|| Pergunte("GPM380",.T. ) } } )
	AADD(aButtons, { 1,.T.,{|o| nOpca := 1,IF(gpconfOK(),FechaBatch(),nOpca:=0) }} )
	AADD(aButtons, { 2,.T.,{|o| FechaBatch() }} )

	FormBatch( cCadastro, aSays, aButtons )

	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Variaveis utilizadas para parametros                         Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	If nOpca == 1
		Processa({|lEnd| GPM380Processa(),STR0004}) //"Limpeza Saldos F.G.T.S "
	Endif
Return

*-------------------------------*
Static FUNCTION Gpm380Processa()
*-------------------------------*
Local nDel := 0

/*
здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
Ё Variaveis de Acesso do Usuario                               Ё
юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды*/
Local cAcessaSRA	:= &( " { || " + IF( Empty( cAcessaSRA := ChkRH( "GPEM380" , "SRA" , "2" ) ) , ".T." , cAcessaSRA ) + " } " )

nDel := 0
dbSelectArea( "SRA" )
dbGotop()

//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
//Ё Carrega Regua Processamento                                  Ё
//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
ProcRegua(SRA->(RecCount() ))

While !Eof()

	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Move Regua Processamento                                     Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	IncProc(STR0012) //"Limpeza saldos F.G.T.S."


	IF  !Eval( cAcessaSRA )
		dbSelectArea("SRA")
		dbSkip()
		Loop
	EndIF
	//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
	//Ё Leitura do Arquivo de Saldos FGTS                            Ё
	//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
	dbSelectArea( "SRS" )
	If dbSeek( SRA->RA_FILIAL + SRA->RA_MAT )
		While !Eof() .And. ( SRS->RS_FILIAL + SRS->RS_MAT == SRA->RA_FILIAL + SRA->RA_MAT )
			//здддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддд©
			//Ё Limpa o Aquivo Saldos FGTS (SRS)                             Ё
			//юдддддддддддддддддддддддддддддддддддддддддддддддддддддддддддддды
			fDeleFgts( mv_par01 , mv_par02,  @nDel )
			dbSkip()
		Enddo
	Endif
	dbSelectArea( "SRA" )
	dbSkip()
EndDo

WriteSX2("SRS",nDel)
dbSelectArea( "SX2" )
MsUnlock()
Chk_Pack("SRS",10)

dbSelectArea( "SRA" )
dbSetOrder(1)
Return

*------------------------------------*
Static Function fDeleFgts(cDataDe,cDataAte,nDel)
*------------------------------------*
Local cAlias := Alias()

If (SRS->RS_ANO+SRS->RS_MES) >= (SubStr(cDataDe,3,4)  + SubStr(cDataDe,1,2)) .And.;
   (SRS->RS_ANO+SRS->RS_MES) <= (SubStr(cDataAte,3,4) + SubStr(cDataAte,1,2))
	RecLock("SRS",.F.,)
	dbDelete()
	nDel ++
	MsUnlock()
Endif

dbSelectArea( cAlias )

Return( .T. )
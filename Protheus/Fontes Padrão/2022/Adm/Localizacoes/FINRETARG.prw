#include "protheus.CH"
#include "FINRETARG.CH"

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³FINRETARG º Autor ³  Bruno Schmidt     º Data ³  14/08/14   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Calculo Retencoes                        				  º±±
±±ºÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍº±±
±±º ArgRetIVA   - Calculo de Ret de IVA para NF               			  º±±
±±º ARGRetIV2   - Calculo de Ret de IVA para NCP               		      º±±
±±º ARGRetIB    - Calculo de Ret de IIB para NF                		      º±±
±±º ARGRetIB2   - Calculo de Ret de IIB para NCP               		      º±±
±±º ARGRetSUSS  - Calculo de Ret de SUSS para NF               		      º±±
±±º ARGRetSU2   - Calculo de Ret de SUSS para NCP              		      º±±
±±º ARGRetSLI   - Calculo de Ret de SLI para NF                		      º±±
±±º ARGRetSL2   - Calculo de Ret de SLI para NCP               		      º±±
±±º ARGRetGN    - Calculo de Ret de Ganancias                  		      º±±
±±º ARGRetGNMnt - Calculo de Ganancia para Monotributista      		      º±±
±±º ARGCpr      - Calculo de Ret de CPR para NF                		      º±±
±±º ARGCpr2     - Calculo de Ret de CPR para NCP               		      º±±
±±º ARGRetCmr   - Calculo de Ret de CMR para NF                		      º±±
±±º ARGRetCmr2  - Calculo de Ret de CMR para NCP               		      º±±
±±º ARGSegF1    - Calculo de Ret de Seguridad e Hig para NF    		      º±±
±±º ARGSegF2    - Calculo de Ret de Seguridad e Hig para NCP   		      º±±
±±º ARGRetIM    - Calculo de Ret de Iva Monotributista para NCP  		  º±±
±±º ARGRetIM2   - Calculo de Ret de Iva Monotributista para NCP   		  º±±
±±ÌÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÌ±±
±±ºPROGRAMADOR ³ DATA   ³ BOPS   ³  MOTIVO DA ALTERACAO                   º±±
±±ÌÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÌ±±
±±ºLaura Medina³15/02/17³MMI-121 ³Se realiza la replica del llamado TUCD44º±±
±±º            ³        ³        ³para considerar en la generacion de la  º±±
±±º            ³        ³        ³OP el pago a través de CBU.             º±±
±±ºLaura Medina³27/02/17³MMI-4160³Adecuacion para que haga retencion IVA  º±±
±±º            ³        ³        ³a NF/NCrédito de diferentes sucursales. º±±
±±º            ³        ³        ³Se incluyo la solucion de issue MMI-4147º±±
±±º            ³        ³        ³para la validacion del BCO que impacta  º±±
±±º            ³        ³        ³en la generacion de la OP.              º±±
±±ºRaul Ortiz  ³28/02/17³MMI-4162³Adecuacion para que haga retencion IVA  º±±
±±º            ³        ³        ³Sobre el valor del documento para       º±±
±±º            ³        ³        ³empresas de Limpieza                    º±±
±±ºLaura Medina³01/03/17³MMI-4184³Realizar correctamente el calculo IIBB  º±±
±±º            ³        ³        ³cuando existe mas de un registro en la  º±±
±±º            ³        ³        ³SFF para mismo CFO y diferente tipo de  º±±
±±º            ³        ³        ³Contribuyente.                          º±±
±±ºLaura Medina³03/03/17³MMI-4166³En la funcion de Ret. de IVA, se cambia º±±
±±º            ³        ³        ³la validacion cAcmIVA <> "" por         º±±
±±º            ³        ³        ³!Empty(cAcmIVA).                        º±±
±±ºRaul Ortiz  ³03/03/17³MMI-4148³Se incorpora funcionalidad para la RG   º±±
±±º            ³        ³        ³2854-11                                 º±±
±±ºLaura Medina³06/03/17³MMI-4168³Adecuacion para que haga retencion IIBB º±±
±±º            ³        ³        ³a NF/NCrédito de diferentes sucursales. º±±
±±ºRaul Ortiz  ³09/03/17³MMI-238 ³Se guardar correctamente el importe     º±±
±±º            ³        ³        ³de deducción para condominios ganancias º±±
±±ºRaul Ortiz  ³15/03/17³MMI-4182³Adecuación para calcular correctamente  º±±
±±º            ³        ³        ³SUSS al ser el calculo por cuotas       º±±
±±ºLaura Medina³30/03/17³MMI-4533³Adecuaciones para las réplicas de los   ³±±
±±º            ³        ³        ³llamados: TTXJZP,TUVZY4,TUSJW3 y TUXRWJ.³±±
±±ºRaul Ortiz  ³23/03/17³MMI-4417³Adecuación para calcular correctamente  º±±
±±º            ³        ³        ³IIBB a no Inscriptos                    º±±
±±ºRaul Ortiz  ³28/03/17|MMI-4546³Se considera el calculo de mínimos IIBB º±±
±±º            ³        ³        ³por Ordend de Pago y no por comprobante º±±
±±ºRaul Ortiz  ³30/03/17|MMI-4938³Se consideran las retenciones generadas º±±
±±º            ³        ³        ³por las ordenes de Pago Previas         º±±
±±ºLaura Medina³19/05/17³MMI-5084³RG 032/2016 para SF, Tipo de Mi. (CCO_  º±±
±±º            ³        ³        ³TPMINR)3-Base Imponible Mínima+Impuesto,º±±
±±º            ³        ³        ³se modifica la regla para tomar los mí- º±±
±±º            ³        ³        ³nimos con la nueva opción (3)...        º±±
±±ºRoberto Glez³19/05/17³MMI-5717³Corrección en calculo de retención de   º±±
±±º            ³        ³        ³ganancias en un PA.                     º±±
±±ºRoberto Glez³02/06/17³MMI-5806³Modificación de validación para prov si º±±
±±º            ³        ³        ³es agente de retención de IVA y evitar  º±±
±±º            ³        ³        ³la exlusión del calculo de otro proceso.º±±
±±ºLaura Medina³29/05/17³MMI-5197³Se da el tratamiento  si es un PA, obte-º±±
±±º            ³        ³        ³niendo de manera correcta la Retencion yº±±
±±º            ³        ³        ³calculando la Ret. Ganancias para alma- º±±
±±º            ³        ³        ³cenar en los arreglos.                  º±±
±±ºRoberto Glez³08/06/17³MMI-5901³Cuando una NCP cuenta con más de un ítemº±±
±±º            ³        ³        ³con la misma TES, considerar la alícuotaº±±
±±º            ³        ³        ³correcta para el cálculo.               º±±
±±ºRaul Ortiz  ³08/06/17³MMI-5667³ Modificaciones para mostrar las Ret.   º±±
±±º            ³        ³        ³en pantalla de las Ordenes de Pago      º±±
±±ºLaura Medina³15/06/17³MMI-5343³Adecuacion para que haga retencion IVA  º±±
±±º            ³        ³        ³correctamente y para que en Ret. de NCP º±±
±±º            ³        ³        ³considere la configuracion del parámetroº±±
±±º            ³        ³        ³MV_AGENTE.                              º±±
±±ºRoberto Glez³06/10/17³DMICNS  ³Considerar el codigo de impuesto en el  º±±
±±º            ³        ³-292    ³calculo de retencion de ganancias.      º±±
±±ºJose Glez   ³13/10/17³TSSERMI01³Se agrega la variable aImpInf a la     º±±
±±º            ³        ³-189     ³funcion ARGRetSLI                      º±±
±±ºRoberto Glz ³24/07/17³DMICNS- ³Para calculo de SUSS para NF y NCP,     º±±
±±º            ³        ³108     ³considerar las especificaciones de la RGº±±
±±º            ³        ³        ³3983 para tomar el valor de F1/F2_VALSUSº±±
±±º            ³        ³        ³en la orden de pago del documento.      º±±
±±ºRaul Ortiz M³20/12/17³DMICNS- ³Cambios en calculo de retenciones de IB º±±
±±º            ³        ³673     ³en las 2 funciones para tomar en cuenta º±±
±±º            ³        ³        ³los limites de calculo por orden de pagoº±±
±±º            ³        ³        ³Argentina                               º±±
±±ºRaul Ortiz  ³12/03/18³DMICNS- ³Cambios para ganancias en condominios   º±±
±±º            ³        ³1060    ³conceptos diferentes a 04- Argentina    º±±
±±ºMarcos A    ³27/03/18³DMICNS- ³Se toma en cuenta tipo de mínimo para   º±±
±±º            ³        ³ 1062   ³retenciones de IIBB en base a la opcion º±±
±±º            ³        ³        ³3-Base Imponible+Impuestos (CCO_TPMINR).º±±
±±º            ³        ³        ³Pais: Argentina (BA y CO).              º±±
±±ºMarco A. Glz³03/12/18³DMICNS- ³Replica de issue DMICNS-4532 (11.8), queº±±
±±º            ³        ³ 4603   ³soluciona el calculo correcto de reten- º±±
±±º            ³        ³        ³ciones, cuando se ha superado el monto  º±±
±±º            ³        ³        ³minimo definido en el pago.             º±±
±±ºGSantacruz  ³15/01/19³DMINA-  ³ARGSegF2() - Ret Seguridad e Higiene NCPº±±
±±º            ³        ³    5674³Proceso correcto de aSFF, aCF y signo   º±±
±±º            ³        ³        ³de % FE_PORCRET.                        º±±
±±ºGSA/ARL     ³07/03/19³DMINA-  ³ARGRetIB()/ARGRetIB2() - Retenciones IB º±±
±±º            ³        ³    5667³Procesar si hay mas de un item y es     º±±
±±º            ³        ³        ³proveedor no inscripto.                 º±±
±±ºAlf. Medrano³28/03/19³DMINA-  ³se modifica fun ARGRetGN() se utiliza laº±±
±±º            ³        ³    5675³variable lRegOP que indica si restará   º±±
±±º            ³        ³        ³valor del importe para obtener el impuesº±±
±±º            ³        ³        ³to de retención                         º±±
±±ºOscar G.    ³04/04/19³DMINA-  ³Se modifica fun ARGRetIB() inicia var.  º±±
±±º            ³        ³    5708³nPercTot, se validan vigencias de regi- º±±
±±º            ³        ³        ³tros en SFH.                            º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±

±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ArgRetIVA º Autor ³   Bruno Schmidt    º Data ³  14/08/14   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ArgRetIVA   - Calculo de Ret de IVA para NF                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ArgRetIVA(cAgente,nSigno,nSaldo,lPa,cCF,nValor,nProp,cSerieNF,nA,aPagAux,naPagar,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aArea:=GetArea()
Local aSFEIVA:={}
DEFAULT lPa		 :=	.F.
DEFAULT cCF 	 := ""
DEFAULT nValor 	 := 0
DEFAULT nSigno	 := 1
DEFAULT naPagar	 := 0
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F. 

If  FindFunction("RetIVADeb")
	aSFEIVA:= RetIVADeb(cAgente,nSigno,nSaldo,lPa,cCF,nValor,nProp,cSerieNF,nA,aPagAux,naPagar,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0005 + STR0007 +STR0004) //"Rutina de cálculo de Retención IVA (débito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0005 +STR0007 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención IVA (débito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEIVA

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetIV2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ArgRetIVA   - Calculo de Ret de IVA para NCP               º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetIV2(cAgente,nSigno,nSaldo,nProp,nA,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aArea:=GetArea()
Local aSFEIVA	:= {}
DEFAULT nSigno	:= -1
DEFAULT nProp 	:= 1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetIVACre")
	aSFEIVA:= RetIVACre(cAgente,nSigno,nSaldo,nProp,nA,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0005 + STR0008 +STR0004) //"Rutina de cálculo de Retención de IVA (crédito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0005 + STR0008 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de IVA desactualizada (crédito), solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEIVA

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ARGRetIB º Autor ³	Bruno Schmidt     º Data ³  14/08/14   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetIB    - Calculo de Ret de IIB para NF                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/

Function ARGRetIB(cAgente,nSigno,nSaldo,cCF,cProv,lPA,nPropImp,aConfProv,lSUSSPrim,lIIBBTotal,aImpCalc,aSUSS,nLinha,lLimNRet,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aArea:=GetArea()
Local aSFEIB	:= {}
DEFAULT nSigno		:= 1
DEFAULT nPropImp	:= 1
DEFAULT aConfProv	:= {}
DEFAULT lSUSSPrim	:= .T.
DEFAULT lIIBBTotal:= .F.
DEFAULT aImpCalc	:= {}
DEFAULT aSUSS		:= {}
DEFAULT nLinha	:= 1
DEFAULT lLimNRet := .F.
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetIBBDeb")
	aSFEIB:= RetIBBDeb(cAgente,nSigno,nSaldo,cCF,cProv,lPA,nPropImp,aConfProv,lSUSSPrim,@lIIBBTotal,aImpCalc,aSUSS,nLinha,lLimNRet,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
	If  Valtype(lVldMsgIBB) != "L"
 		lVldMsgIBB := .T.
 	Endif
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
 		If  lVldMsgIBB 
 			cTxtRotAut += OemToAnsi(STR0003 + STR0009 + STR0007 +STR0004) //"Rutina de cálculo de Retención IIBB (débito) desactualizada, solicite paquete con actualizaciones."
 			lVldMsgIBB := .F. 
 		Endif
 		lMsErroAuto := .T.
 	Else
 		If  lVldMsgIBB
	 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0009 +STR0007 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención IIBB (débito) desactualizada, solicite paquete con actualizaciones."
	 		lVldMsgIBB := .F. 
 		Endif 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEIB

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetIB2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetIB2    - Calculo de Ret de IIB para NF               º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetIB2(cAgente,nSigno,nSaldo,nPropImp,aConfProv,lSUSSPrim,lIIBBTotal,aImpCalc,aSUSS,nLinha,lLimNRet,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aArea			:=GetArea()
Local aSFEIB    	:= {}
DEFAULT nSigno		:= -1
DEFAULT nPropImp	:= 1
DEFAULT aConfProv	:= {}
DEFAULT lSUSSPrim	:= .T.
DEFAULT lIIBBTotal 	:= .F.
DEFAULT aImpCalc 	:= {}
DEFAULT aSUSS 		:= {}
DEFAULT nLinha		:= 0
DEFAULT lLimNRet 	:= .F.     
DEFAULT cChavePOP	:= ""
DEFAULT cNFPOP	 	:= ""
DEFAULT cSeriePOP	:= ""
DEFAULT dEmissao 	:= CTOD("//")
DEFAULT lOPRotAut	:= .F.

If  FindFunction("RetIBBCre")
	aSFEIB:= RetIBBCre(cAgente,nSigno,nSaldo,nPropImp,aConfProv,lSUSSPrim,@lIIBBTotal,aImpCalc,aSUSS,nLinha,lLimNRet,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
	If  Valtype(lVldMsgIBB) != "L"
 		lVldMsgIBB := .T.
 	Endif
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
 		If  lVldMsgIBB
 			cTxtRotAut += OemToAnsi(STR0003 + STR0009 + STR0008 +STR0004) //"Rutina de cálculo de Retención IIBB (crédito) desactualizada, solicite paquete con actualizaciones."
 			lVldMsgIBB := .F.
 		Endif
 		lMsErroAuto := .T.
 	Else
 		If  lVldMsgIBB
	 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0009 +STR0008 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención IIBB (crédito) desactualizada, solicite paquete con actualizaciones."
	 		lVldMsgIBB := .F. 
	 	Endif
 	EndIf
EndIf

RestArea(aArea)
Return aSFEIB


/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetSUSSº Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetSUSS  - Calculo de Ret de SUSS para NF               º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetSUSS(cAgente,nSigno,nSaldo,lRetPa,nProp,aSUSS,aImpCalc,nLinha,nControl,aSE2,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aSFESUSS  := {}
Local aArea     := GetArea()
DEFAULT nProp	:= 1
DEFAULT nSigno	:=	1
DEFAULT lRetPa 	:= .F.
DEFAULT aSUSS  	:= {}
DEFAULT aImpCalc:= {}
DEFAULT nLinha	:= 0 
DEFAULT nControl:= 0
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetSUSDeb")
	aSFESUSS:= RetSUSDeb(cAgente,nSigno,nSaldo,lRetPa,nProp,aSUSS,aImpCalc,nLinha,nControl,aSE2,cChavePOP,cNFPOP,cSeriePOP,dEmissao)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0006 + STR0007 +STR0004) //"Rutina de cálculo de Retención de SUSS (débito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0006 + STR0007 +STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de SUSS (débito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFESUSS



/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetSU2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetSU2   - Calculo de Ret de SUSS para NCP              º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetSU2(cAgente,nSigno,nSaldo,nProp,aSUSS,aImpCalc,nLinha,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aArea		:= GetArea()
Local aSFESUSS  := {}
DEFAULT nSigno	:=	-1
DEFAULT aSUSS  	:= {}
DEFAULT aImpCalc	:= {}
DEFAULT nLinha	:= 0
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetSUSCre")
	aSFESUSS:= RetSUSCre(cAgente,nSigno,nSaldo,nProp,aSUSS,aImpCalc,nLinha,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0006 + STR0008 +STR0004) //"Rutina de cálculo de Retención de SUSS (crédito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0006 + STR0008 +STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de SUSS (crédito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFESUSS 

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetSLI º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetSLI   - Calculo de Ret de SLI para NF                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetSLI(cAgente,nSigno,nSaldo,nA,cChavePOP,cNFPOP,cSeriePOP,lOPRotAut)
Local aSFESLI	:= {}
Local aArea		:= GetArea()
DEFAULT nSigno	:=	1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetSLIDeb")
	aSFESLI:= RetSLIDeb(cAgente,nSigno,nSaldo,nA,cChavePOP,cNFPOP,cSeriePOP)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0012 + STR0007 +STR0004) //"Rutina de cálculo de Retención de SLI (débito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0012 + STR0007 +STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de SLI (débito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFESLI

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetSL2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetSL2   - Calculo de Ret de SLI para NF                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetSL2(cAgente,nSigno,nSaldo,nA,cChavePOP,cNFPOP,cSeriePOP,lOPRotAut)
Local aSFESLI 	:= {}
Local aArea		:= GetArea()
DEFAULT nSigno	:= -1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetSLICre")
	aSFESLI:= RetSLICre(cAgente,nSigno,nSaldo,nA,cChavePOP,cNFPOP,cSeriePOP)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0012 + STR0008 +STR0004) //"Rutina de cálculo de Retención de SLI (crédito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0012 + STR0008 +STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de SLI (crédito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFESLI



/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ARGRetGN º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetGN    - Calculo de Ret de Ganancias                  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetGN(cAgente,nSigno,aConGan,cFornece,cLoja,cChavePOP,lOPRotAut,lPa, nValBase)
Local aSFEGn	:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno	:= 1
DEFAULT cChavePOP	:= ""
DEFAULT lOPRotAut:= .F.
DEFAULT lPa      := .F.
DEFAULT nValBase := 0

If  FindFunction("RetGanDeb")
	aSFEGn:= RetGanDeb(cAgente,nSigno,aConGan,cFornece,cLoja,cChavePOP,lOPRotAut,lPa, nValBase)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0010 + STR0004) //"Rutina de cálculo de Retención Ganancias desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0010 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención Ganancias desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEGN


/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetGNMnt º Autor ³  Bruno Schmidt   º Data ³  14/08/14   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Calculo de IVA para monotributista                         º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetGNMnt(cAgente,nSigno,aConGan,cFornece,cLoja,cDoc,cSerie,lPa,nTTit,cChavePOP,lOPRotAut)
Local aSFEGn   	:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno	:=	1
DEFAULT lPa 	:= .F.
DEFAULT cChavePOP	:= ""
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetGanMnt")
	aSFEGn:= RetGanMnt(cAgente,nSigno,aConGan,cFornece,cLoja,cDoc,cSerie,lPa,nTTit,cChavePOP,lOPRotAut)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0010 + STR0011 + STR0004) //"Rutina de cálculo de Retención Ganancias para Monotributista desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0010 + STR0011 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención Ganancias para Monotributista desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEGN

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³  ARGCpr  º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGCpr      - Calculo de Ret de CPR para NF                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGCpr(cAgente,nSigno,nSaldo,lOPRotAut)
Local aConCprRat:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno	:= 1
DEFAULT lOPRotAut:= .F.

If  !FindFunction("RetCprDeb")
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0014 + STR0007 + STR0004) //"Rutina de cálculo de Retención CPR (débito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0014 + STR0007 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención CPR (débito)  desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

If Empty(aConCprRat)
	AAdd(aConCprRat, {,0,0,0,0,0,0,0,0,0,0})
EndIf

RestArea(aArea)
Return aConCprRat


/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³  ARGCpr2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGCpr      - Calculo de Ret de CPR para NCP               º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGCpr2(cAgente,nSigno,nSaldo,lOPRotAut)
Local aConCprRat	:= {}
Local aArea			:=	GetArea()
DEFAULT nSigno		:=	1
DEFAULT lOPRotAut	:= .F.

If  !FindFunction("RetCprCre")
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0014 + STR0008 + STR0004) //"Rutina de cálculo de Retención de CPR (crédito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0014 + STR0008 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de CPR (crédito)  desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

If Empty(aConCprRat)
	AAdd(aConCprRat, {,0,0,0,0,0,0,0,0,0,0})
EndIf

RestArea(aArea)
Return aConCprRat


/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetCmr º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetCmr   - Calculo de Ret de CMR para NF 		     	  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetCmr(cAgente,nSigno,nSaldo,lOPRotAut)
Local aConCmrRat:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno	:=	1
DEFAULT lOPRotAut:= .F.

If  !FindFunction("RetCMrDeb")
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0015 + STR0007 + STR0004) //"Rutina de cálculo de Retención de CMR (débito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0015 + STR0007 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de CMR (débito)  desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

If Empty(aConCmrRat)
	AAdd(aConCmrRat, {,0,0,0,0,0,0,0,0,0,0})
Endif

RestArea(aArea)
Return aConCmrRat

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ARGRetCmr2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetCmr2   - Calculo de Ret de CMR para NCP			  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetCmr2(cAgente,nSigno,nSaldo,lOPRotAut)
Local aConCmrRat:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno	:=	1
DEFAULT lOPRotAut:= .F.

If  !FindFunction("RetCmrCre")
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0015 + STR0008 + STR0004) //"Rutina de cálculo de Retención de CMR (crédito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0015 + STR0008 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de CMR (crédito)  desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

If Empty(aConCmrRat)
	AAdd(aConCmrRat, {,0,0,0,0,0,0,0,0,0,0})
Endif

RestArea(aArea)
Return aConCmrRat



/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ARGSegF1 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGSegF1    - Calculo de Ret de Seguridad e Hig para NF    º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGSegF1(cAgente,nSigno,nSaldo,cChavePOP,cNFPOP,cSeriePOP,aSLIMIN,lOPRotAut)
Local aSFEISI  	:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno	:=	1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT aSLIMIN := {}
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetMunDeb")
	aSFEISI:= RetMunDeb(cAgente,nSigno,nSaldo,cChavePOP,cNFPOP,cSeriePOP,@aSLIMIN)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0013 + STR0007 + STR0004) //"Rutina de cálculo de Retención de Seguridad e Hig (débito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0013 + STR0007 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de Seguridad e Hig (débito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEISI

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ARGSegF2 º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGSegF2    - Calculo de Ret de Seguridad e Hig para NCP   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGSegF2(cAgente,nSigno,nSaldo,cChavePOP,cNFPOP,cSeriePOP,aSLIMIN,lOPRotAut)
Local aSFEISI  	:= {}
Local aArea		:=	GetArea()
DEFAULT nSigno:= -1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT aSLIMIN := {}
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetMunCre")
	aSFEISI:= RetMunCre(cAgente,nSigno,nSaldo,cChavePOP,cNFPOP,cSeriePOP,@aSLIMIN)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0013 + STR0008 + STR0004) //"Rutina de cálculo de Retención de Seguridad e Hig (crédito) desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0013 + STR0008 + STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención de Seguridad e Hig (crédito) desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEISI

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ARGRetIM º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ ARGRetIM    - Calculo de Ret de Iva Monotributista para NCPº±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetIM(cAgente,nSigno,nSaldo,lPa,cCF,nValor,nProp,lNNF,cSerieNF,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aSFEIVA  	:= {}
Local aArea		:=	GetArea()
DEFAULT lNNF 	:= .F.
DEFAULT lPa		:= .F.
DEFAULT cCF 	:= ""
DEFAULT nValor 	:= 0
DEFAULT nSigno	:= 1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetIVAMDb")
	aSFEIVA:= RetIVAMDb(cAgente,nSigno,nSaldo,lPa,cCF,nValor,nProp,lNNF,cSerieNF,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0005 + STR0007 + STR0011 +STR0004) //"Rutina de cálculo de Retención IVA (débito) para monotributista desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0005 + STR0007 + STR0011 +STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención IVA (débito) para monotributista desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEIVA

/*ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ARGRetIM2º Autor ³	Bruno Schmidt     º Data ³  14/08/14  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ARGRetIM2 - Calculo de Ret de Iva Monotributista para NCP   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ FINRETARG                                                  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß*/
Function ARGRetIM2(cAgente,nSigno,nSaldo,nProp,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Local aSFEIVA	:= {} 
Local aArea		:=	GetArea()
DEFAULT nSigno	:= -1
DEFAULT nProp 	:= 1
DEFAULT cChavePOP:= ""
DEFAULT cNFPOP	 := ""
DEFAULT cSeriePOP:= ""
DEFAULT dEmissao := CTOD("//")
DEFAULT lOPRotAut:= .F.

If  FindFunction("RetIVAMCr")
	aSFEIVA:= RetIVAMCr(cAgente,nSigno,nSaldo,nProp,cChavePOP,cNFPOP,cSeriePOP,dEmissao,lOPRotAut)
Else
 	If  lOPRotAut
 		If  Valtype(cTxtRotAut) != "C"
 			cTxtRotAut := ""
 		Endif
		cTxtRotAut += OemToAnsi(STR0003 + STR0005 + STR0008 + STR0011 +STR0004) //"Rutina de cálculo de Retención IVA (crédito) para monotributista desactualizada, solicite paquete con actualizaciones."
 		lMsErroAuto := .T.
 	Else
 		Aviso(OemToAnsi(STR0001),OemToAnsi(STR0003 + STR0005 + STR0008 + STR0011 +STR0004),{OemToAnsi(STR0002)}) //"Rutina de cálculo de Retención IVA (crédito) para monotributista desactualizada, solicite paquete con actualizaciones." 
 	EndIf
EndIf

RestArea(aArea)
Return aSFEIVA



/*
ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»
ºPrograma  ³ObtReten   ºAutor  ³Raul Ortiz Medina   º Data ³  19/09/19   º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
ºDesc.     ³ Realiza el acumulado de los valores de Retenciones de una   º
º          ³ Orden de Pago Previa                                        º
ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹
ºUso       ³ FINA850                                                     º
ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼
*/

Function ObtReten(cChave, cNF, cSerie, cTipo, nSaldo, dEmissao, aConfProv, lReSaSus)
//Se cambia a Function y solo es usada en: FINRETIBB, FINRETIVA, FINRETMUN, FINRETGAN, FINRETSLI y FINRETSUSS
Local aReten := {}
Local cFil	 := xFilial("FVC")
DEFAULT cChave 		:= ""
DEFAULT cNF 		:= ""
DEFAULT cSerie		:= ""
DEFAULT cTipo 		:= ""
DEFAULT nSaldo 		:= 0
DEFAULT dEmissao 	:= CTOD("//")
DEFAULT aConfProv 	:= {}
DEFAULT	lReSaSus	:= .F.
 
	DBSELECTAREA("FVC")
	FVC->(DBSETORDER(2)) //FVC_FILIAL+FVC_PREOP+FVC_FORNEC+FVC_LOJA
	If FVC->(MsSeek(cFil + cChave))
		While FVC->(!Eof()) .and. FVC->(FVC_FILIAL+FVC_PREOP+FVC_FORNEC+FVC_LOJA) == cFil + cChave
			If cTipo == "G" .and. AllTrim(FVC->FVC_TIPO) == "G"
				aAdd(aReten,{"",FVC_VALBAS,FVC_ALIQ,FVC_RETENC,FVC_RETENC,FVC_DEDUC,FVC_CONCEP,FVC_PORCR,"",FVC_FORCON,FVC_LOJCON})
			Else
				If FVC->FVC_NFISC == cNF .and. FVC->FVC_SERIE == cSerie
					If AllTrim(FVC->FVC_TIPO) == "I" .and. cTipo == "I" //.and. cTipo == "I" //nf +serie
						aAdd(aReten,{FVC->FVC_NFISC,FVC->FVC_SERIE,FVC->FVC_VALBAS,FVC->FVC_RETENC,FVC->FVC_PORCR,FVC->FVC_RETENC,nSaldo,dEmissao,FVC->FVC_CFO,FVC->FVC_ALIQ,FVC->FVC_CFO,0})
					ElseIf AllTrim(FVC->FVC_TIPO) == "B" .and. cTipo == "B" .and. AllTrim(FVC->FVC_EST) == aConfProv[1]
						aAdd(aReten,{FVC->FVC_NFISC,FVC->FVC_SERIE,FVC->FVC_VALBAS,FVC->FVC_ALIQ,FVC->FVC_RETENC,FVC->FVC_RETENC,nSaldo,dEmissao,FVC->FVC_EST,SE2->E2_MOEDA,FVC->FVC_CFO,;
						FVC->FVC_CFO,SE2->E2_TIPO,FVC->FVC_CONCEP,FVC_DEDUC,FVC_PORCR,.F.,"",FVC->FVC_ALIQ,0,0,0,;
						0,0,"",0,0,0,aConfProv[6],.F.,0,0,0})				
					ElseIf cTipo == "S" .and. (AllTrim(FVC->FVC_TIPO) == "U" .or. AllTrim(FVC->FVC_TIPO) == "S")
						aAdd(aReten,{FVC->FVC_NFISC,FVC->FVC_SERIE,FVC->FVC_VALBAS,FVC->FVC_RETENC,FVC->FVC_PORCR,FVC->FVC_RETENC,FVC->FVC_ALIQ,FVC->FVC_CONCEP,FVC->FVC_EST,"",FVC_FORCON,FVC_LOJCON,Iif(lReSaSus,FVC_RETENC,0)})
					ElseIf cTipo == "L" .and. AllTrim(FVC->FVC_TIPO) == "L" 
						aAdd(aReten,{FVC->FVC_NFISC,FVC->FVC_SERIE,FVC->FVC_VALBAS,FVC->FVC_VALBAS,FVC_PORCR,FVC->FVC_RETENC})					
					ElseIf cTipo == "M" .and. AllTrim(FVC->FVC_TIPO) == "M" 
						aAdd(aReten,{FVC->FVC_NFISC,FVC->FVC_SERIE,FVC->FVC_VALBAS,FVC->FVC_RETENC,Round((FVC->FVC_RETENC*100)/nSaldo,2),FVC->FVC_RETENC,FVC->FVC_DEDUC,{{FVC->FVC_ALIQ,"",FVC->FVC_RETENC,""}},FVC->FVC_EST,FVC->FVC_RET_MN})
					EndIf
				EndIF
			EndIf
			FVC->(DbSkip())
		Enddo
	EndIF

Return aReten


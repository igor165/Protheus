#Include "MATA630.CH"
#Include "FWMVCDEF.CH"
#Include "PROTHEUS.CH"

Static __lAutomacao := IsInCallStack("MAT630_001")
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Descri‡…o ³ PLANO DE MELHORIA CONTINUA        ³Programa    MATA630.PRX ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÁÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ITEM PMC  ³ Responsavel              ³ Data         |BOPS              ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³      01  ³                          ³              |                  ³±±
±±³      02  ³Erike Yuri da Silva       ³15/12/2005    |                  ³±±
±±³      03  ³Erike Yuri da Silva       ³10/04/2006    |00000095864       ³±±
±±³      04  ³                          ³              |                  ³±±
±±³      05  ³Erike Yuri da Silva       ³09/02/2006    |00000093021       ³±±
±±³      06  ³Flavio Luiz Vicco         ³28/03/2006    |00000095613       ³±±
±±³      07  ³Erike Yuri da Silva       ³15/12/2005    |                  ³±±
±±³      08  ³Erike Yuri da Silva       ³09/02/2006    |00000093021       ³±±
±±³      09  ³Erike Yuri da Silva       ³10/04/2006    |00000095864       ³±±
±±³      10  ³Flavio Luiz Vicco         ³28/03/2006    |00000095613       ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³ Fun‡„o	 ³ MATA630	³ Autor ³ Rodrigo de A. Sartorio³ Data ³28/09/95  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Descri‡„o³ Cadastramento de Opera‡”es 								  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Sintaxe  ³ Void MATA630(void)										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Gen‚rico 												  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ ATUALIZACOES SOFRIDAS DESDE A CONSTRUCAO INICIAL. 			  	      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ PROGRAMADOR  ³ DATA   ³ BOPS ³	MOTIVO DA ALTERACAO					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Rodrigo Sart.³18/06/98³15706A³Acerto na alteracao dos recursos alterna³±±
±±³				 ³		  ³		³tivos atrav‚s da tecla F4 (MontaF4)	  ³±±
±±³ Rodrigo Sart.³18/06/98³09653A³Acerto nas chamadas da funcao CONPAD	  ³±±
±±³ Rodrigo Sart.³04/02/99³19694A³Acerto no posicionamento do SG2         ³±±
±±³ Marcelo Pim. ³04/03/99³META  ³Integracao com m¢dulo Sigaqip-Processos.³±±
±±³ Aline C. Vale³19/04/99³PROTHE³Ajuste para compilacao Protheus         ³±±
±±³ Fernando Joly³19/05/99³21584A³Inclus„o dos Pontos de Entrada MA630INC,³±±
±±³              ³        ³      ³MA630ALT e MA630DEL (com ret. l¢gico).  ³±±
±±³ Cesar Valadao³18/06/99³PROTHE³Ajuste no Lock Para Registros Deletados.³±±
±±³ Rodrigo Sart.³12/07/99³VIC   ³Acerto delecao linhas                   ³±±
±±³ Rodrigo Sart.³30/07/99³MELHOR³Melhoria na funcao A630Tempo()          ³±±
±±³ Marcelo Pim. ³05/03/01³JNJ   ³Inclusao do Ponto de Entrada QP010J11   ³±±
±±³              ³        ³      ³Utilizado no modulo Insp. de Processos  ³±±
±±³ Marcelo Iuspa³11/07/01³META  ³Edicao campos p/ integracao PREACTOR    ³±±
±±³ Paulo Emidio ³30/01/04³META  ³Retirada a utilizacao do roteiro de ope-³±±
±±³ 			 ³		  ³----  ³racoes pelo modulo QIP. 				  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function MATA630()
Local aMemUser   := {}
Local lMTA630Fil := ExistBlock("MTA630FIL")
Local aIndexSG2  := {}
Local cFiltraSG2 := ""
Local bFiltraBrw := {||}

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Define Array contendo as Rotinas a executar do programa 	 ³
//³ ----------- Elementos contidos por dimensao ------------	 ³
//³ 1. Nome a aparecer no cabecalho 							 ³
//³ 2. Nome da Rotina associada									 ³
//³ 3. Usado pela rotina										 ³
//³ 4. Tipo de Transa‡„o a ser efetuada							 ³
//³	 1 - Pesquisa e Posiciona em um Banco de Dados				 ³
//³	 2 - Simplesmente Mostra os Campos							 ³
//³	 3 - Incluir registros no Bancos de Dados 					 ³
//³	 4 - Altera o registro corrente								 ³
//³	 5 - Remove o registro corrente do Banco de Dados			 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE aRotina := MenuDef()
Private aSize   :={}
Private aInfo   :={}
Private aMemos  :={}
Private aObjects:={}
Private aPosObj :={}

Private aItensChk :=  {}

AADD(aObjects,{100,If(SuperGetMV("MV_UNILIN",.F.,.F.),040,020),.T.,.F.,.F.})
AADD(aObjects,{100,100,.T.,.T.,.F.}) 
aSize:=MsAdvSize()
aInfo:={aSize[1],aSize[2],aSize[3],aSize[4],3,3}
aPosObj:=MsObjSize(aInfo,aObjects)

//Seleciona tabela utilizada na validação da integração com Inspeção de Processo.
dbSelectArea("QP6")

If TipoAps()
	Aadd(aRotina, {STR0028, "A630RecOpe", 0, 4}) //"TempoxRecurso"
	Aadd(aRotina, {STR0029, "A630FerOpe", 0, 4}) //"Ferram.xOper."
Endif

cCadastro := OemToAnsi(STR0006)	//"Roteiro de Opera‡”es"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de entrada para adicao de campos memo do usuario   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock( "MA630MEM" )
	If Valtype(	aMemUser := ExecBlock( "MA630MEM", .F., .F. ) ) == "A"
		aEval( aMemUser, { |x| aAdd( aMemos, x ) } )
	EndIf
EndIf 

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de Entrada para filtrar tabela SG2                 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lMTA630Fil
	cFiltraSG2 := ExecBlock("MTA630FIL",.F.,.F.)
	If ValType(cFiltraSG2) == "C" .And. !Empty(cFiltraSG2)
		bFiltraBrw := {|| FilBrowse("SG2",@aIndexSG2,@cFiltraSG2)}
		Eval(bFiltraBrw)
	Else
		lMTA630Fil := .F.
	Endif
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Endereca a funcao de BROWSE							     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SG2")
dbGoTop()

If !__lAutomacao
mBrowse( 6, 1,22,75,"SG2" )
EndIf
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Desfaz o filtro tabela SG2                               ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lMTA630Fil
	EndFilBrw("SG2",aIndexSG2)
Endif

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630Visual³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de visualizacao de operacoes					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ Void A630Visual(ExpC1,ExpN1,ExpN2)						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo									  ³±±
±±³			 ³ ExpN1 = Numero do registro 								  ³±±
±±³			 ³ ExpN2 = Numero da opcao selecionada 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Visual(cAlias,nReg,nOpcx)
Local bCampo,nSavRec,nCnt:=0
Local cVarTemp
Local oDlg,nOpca,oGet
Local cDescProd	:= ""
Local cQuery	:= ""
Local aButtons	:= {}
Local bWhileSG2 := {}
Local nIndexOrd := 1
Local oComboLin := NIL
Local aComboLin := {}
Local nComboLin := 0                
Local lCheckList:= SuperGetMV("MV_CHKOPER",.F.,.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Walk-Thru						                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aNoFields	 := { "G2_PRODUTO","G2_CODIGO","G2_REFGRD" }
Local bSeekWhile := {} // Condicao While para montar o aCols
Local cSeek		 := ""

Private c630Prod	:= Space(TamSX3("B1_COD")[1])
Private c630Cod		:= Space(2)
Private c630RefGrd	:= Space(14)
Private c630Linhapr := Space(TamSX3("G2_LINHAPR")[1])
Private c630TipLin  := Space(TamSX3("G2_TPLINHA")[1])
                       
aItensChk :=  LoadSGR(SG2->G2_PRODUTO,SG2->G2_CODIGO)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe algum dado no arquivo 					 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
c630Cod		:= SG2->G2_CODIGO
c630Prod	:= SG2->G2_PRODUTO
c630RefGrd	:= SG2->G2_REFGRD
c630Linhapr := SG2->G2_LINHAPR
c630TipLin  := SG2->G2_TPLINHA

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Posiciona corretamente os registros para montagem do acols   ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
a630SeekSG2(1,c630Prod,xFilial("SG2")+If(Empty(c630RefGrd),c630Prod,c630RefGrd)+c630Cod)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para exportar dados para EXCEL                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If RemoteType() == 1
	aAdd(aButtons   , {PmsBExcel()[1],{|| DlgToExcel({ {"CABECALHO",cCadastro,{OemToAnsi(STR0007),OemToAnsi(STR0008)},{c630Cod,c630Prod}},{"GETDADOS",OemToAnsi(STR0036),aHeader,aCols}})},PmsBExcel()[2],PmsBExcel()[3]})
EndIf
                     
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para selecao de checklist                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lCheckList 
	aAdd(aButtons,{"MA631CHK", {|| If(!Empty(aCols[n,1]),A630ExecCh(nOpcx),MsgInfo(STR0053,STR0050))} ,STR0052,STR0054})	//CheckList 	
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de Entrada criado para mudar os botoes da enchoicebar                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("MA630BUT")
	aButtons := ExecBlock( "MA630BUT",.F.,.F.,{nOpcx,aButtons})
	If ValType(aButtons)# "A"
		aButtons := {}
	EndIf
EndIf
nSavRec := Recno()

cQuery += "Select Count(*) CNT From " + RetSQLName("SG2")
cQuery += " WHERE G2_FILIAL  = '" + xFilial("SG2")  + "' AND "
cQuery += " G2_PRODUTO  = '" + c630Prod  + "' AND "
cQuery += " G2_CODIGO	= '" + c630Cod  + "' AND "
If !Empty(c630RefGrd)
	cQuery += " G2_REFGRD	= '" + c630RefGrd  + "' AND "
EndIf
cQuery += " D_E_L_E_T_ = ' '"
cQuery := ChangeQuery( cQuery )
dbUseArea( .t., "TopConn", TCGenQry(,,cQuery),"QRYTRB", .F., .F. )
TCSetField( "QRYTRB", "CNT", "N", 10, 0 )
nCnt := QRYTRB->CNT
QRYTRB->(DbCloseArea())
DbSelectArea(cAlias)

If nCnt == 0
	dbGoTo(nReg)
	Return .T.
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se esta' na filial correta                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If xFilial("SG2") != G2_FILIAL
	dbGoTo(nReg)
	Help(" ",1,"A000FI")
	Return
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo						     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE aTELA[0][0],aGETS[0],aHeader[0],Continua,aCols:={}
bCampo := {|nCPO| Field(nCPO) }

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aHeader e aCols utilizando a funcao FillGetDados   	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//-- Verifica se utilizar codigo referencia de grade (familia) ou codigo completo
If Empty(c630RefGrd)
	cSeek		:= xFilial("SG2")+c630Prod+c630Cod
	bSeekWhile	:= { || SG2->( G2_FILIAL+G2_PRODUTO+G2_CODIGO ) }
	nIndexOrd	:= 1

	//-- Definido a descricao
	SB1->(dbSetOrder(1))
	If SB1->(dbSeek(xFilial("SB1")+c630Prod))
		cDescProd := SB1->B1_DESC
	EndIf
Else
	cSeek		:= xFilial("SG2")+c630RefGrd+c630Cod
	bSeekWhile	:= { || SG2->( G2_FILIAL+G2_REFGRD+G2_CODIGO ) }	
	nIndexOrd	:= 7

	//-- Definido a descricao
	If !MatGrdPrrf(SG2->G2_REFGRD)
		MatOrigGrd("SBQ")
	EndIf
	cDescProd	:= MaGetDescGrd(SG2->G2_REFGRD)

	//-- Muda visualizao de campo
	c630Prod := c630RefGrd
EndIf

DbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Sintaxe da FillGetDados( nOpcx, cAlias, nOrder, cSeekKey, bSeekWhile, uSeekFor, aNoFields, aYesFields, lOnlyYes, cQuery, bMontCols, lEmpty, aHeaderAux, aColsAux, bAfterCols, bBeforeCols, bAfterHeader, cAliasQry ) |
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
FillGetDados(nOpcX,cAlias,nIndexOrd,cSeek,bSeekWhile,{||.T.},aNoFields)

nOpca := 0                             

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Calcula dimensões ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oSize := FwDefSize():New( .F. )

oSize:AddObject( "CIMA" , 100, 20, .T., .F., .T. ) // Nao dimensiona Y 
oSize:AddObject( "BAIXO", 100, 100, .T., .T., .T. ) // Totalmente dimensionavel

oSize:lProp := .T. // Proporcional 
oSize:aMargins := { 3, 3, 3, 3 } // Espaco ao lado dos objetos 0, entre eles 3 

oSize:Process() // Dispara os calculos 
If !__lAutomacao
DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0006) From aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd	PIXEL //"Roteiro de Opera‡”es"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Adiciona Panel ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

oPanel1:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[1,3])
oPanel2:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[2,3])

oPanel1:Align := CONTROL_ALIGN_TOP
oPanel2:Align := CONTROL_ALIGN_ALLCLIENT

@ oSize:aPosObj[1,1],oSize:aPosObj[1,2] To oSize:aPosObj[1,3],oSize:aPosObj[1,4] PIXEL
@ oSize:aPosObj[1,1]+2,003 SAY OemToAnsi(STR0007) SIZE 18,7 OF oPanel1 PIXEL	//"&C¢digo"
@ oSize:aPosObj[1,1],022 MSGET c630Cod Picture "@!" WHEN .F. SIZE 9,10 OF oPanel1 PIXEL
@ oSize:aPosObj[1,1]+2,040 SAY OemToAnsi(STR0008) SIZE 25,7 OF oPanel1 PIXEL	//"&Produto"
@ oSize:aPosObj[1,1],060 MSGET c630Prod Picture "@!" WHEN .F. SIZE 100,10 OF oPanel1 PIXEL
@ oSize:aPosObj[1,1],165 MSGET cDescProd PICTURE "@!" WHEN .F. SIZE 100,10 OF oPanel1 PIXEL

If SuperGetMV("MV_UNILIN",.F.,.F.) 
	aComboLin := A630CombLi()
	nComboLin := aScan(aComboLin[1],{|x| AllTrim(x) == AllTrim(c630TipLin)})
	
	@ 37,007 SAY RetTitle("G2_LINHAPR") SIZE 18,7 OF oDlg PIXEL
	@ 35,028 MSGET c630Linhapr PICTURE "@!" WHEN .F. SIZE 9,10 OF oDlg PIXEL 
	@ 35,077 MSGET Posicione("SHL",1,xFilial("SHL")+c630Linhapr,"HL_DESC") PICTURE "@!" WHEN .F. SIZE 100,10 OF oDlg PIXEL   
	@ 37,300 SAY RetTitle("G2_TPLINHA") SIZE 30,7 OF oDlg PIXEL
	oComboLin := tComboBox():New(35,335,{|u|if(PCount()>0,c630TipLin:=u,c630TipLin)},aComboLin[2],50,20,oDlg,,nil,,,,.T.,,,,{||.f.},,,,,'c630TipLin')
	oComboLin:Select(nComboLin)		                          
EndIf

oGet := MSGetDados():New(aPosObj[2,1],aPosObj[2,2],aPosObj[2,3],aPosObj[2,4],nOpcx,"a630LinOk","a630TudOk","",,,,,700)

ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{||nopca:=1,oDlg:End()},{||oDlg:End()},,aButtons)
EndIf

dbSelectArea(cAlias)
dbGoTo(nReg)
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630Inclui³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de inclusao de operacoes						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ Void A630Inclui(ExpC1,ExpN1,ExpN2)						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo									  ³±±
±±³			 ³ ExpN1 = Numero do registro 								  ³±±
±±³			 ³ ExpN2 = Opcao s,elecionada 								  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Inclui(cAlias,nReg,nOpcx)
Local nOpcA:=0,nCnt:=0, lOk := .T., nRegSX3 := 0,bCampo
Local i, cOldAlias,oDlg                  
Local oSize
Local lMA630FIN	:= ExistBlock('MA630FIN')
Local lMA630Inc	:= ExistBlock('MA630INC')
Local lConfInc	:= .T.
Local lQP010J11	:= ExistBlock('QP010J11')
Local cDescProd	:=""
Local lWhnSim	:= .t.
Local aButtons	:= {}
Local nVar		:= 1
Local lRefGrd	:= .F.
Local oComboLin := NIL
Local aComboLin := {}
Local nComboLin := 0
Local lCheckList:= SuperGetMV("MV_CHKOPER",.F.,.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo						     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE aTela[0][0],aGets[0],aHeader[0],Continua,nUsado:=0,oGet
PRIVATE aHeadRec	:= {},aColsRec:={},nMaxArray
PRIVATE aHeadFer	:= {},aColsFer:={}
PRIVATE aHeadRecCT	:= {},aColsRecCT := {}
PRIVATE c630Prod 	:= Space(TamSX3("B1_COD")[1])
PRIVATE c630ProdAu	:= Space(TamSX3("B1_COD")[1])
PRIVATE c630Cod  	:= "01"
PRIVATE c630CodAux  := Space(02)
PRIVATE c630RefGrd	:= Space(14)
PRIVATE c630Linhapr := Space(TamSX3("G2_LINHAPR")[1])        
PRIVATE c630TipLin  := Space(TamSX3("G2_TPLINHA")[1])
PRIVATE lPrim		:= .T.,cRoteiro
PRIVATE lPadrao		:= .F.
PRIVATE nPosOPer
PRIVATE cCodAnt		:= ""

bCampo:= {|nCPO| Field(nCPO) }                      

aItensChk :=  LoadSGR(SG2->G2_PRODUTO,SG2->G2_CODIGO)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para exportar dados para EXCEL                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If RemoteType() == 1
	aAdd(aButtons   , {PmsBExcel()[1],{|| DlgToExcel({ {"CABECALHO",cCadastro,{OemToAnsi(STR0007),OemToAnsi(STR0008)},{c630Cod,c630Prod}},{"GETDADOS",OemToAnsi(STR0036),aHeader,aCols}})},PmsBExcel()[2],PmsBExcel()[3]})
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para selecao de checklist                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lCheckList
	aAdd(aButtons,{"MA631CHK", {|| If(!Empty(aCols[n,1]),A630ExecCh(nOpcx),MsgInfo(STR0053,STR0050))} ,STR0052,STR0054})	//CheckList 	
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de Entrada criado para mudar os botoes da enchoicebar                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("MA630BUT")
	aButtons := ExecBlock( "MA630BUT",.F.,.F.,{nOpcx,aButtons})
	If ValType(aButtons)# "A"
		aButtons := {}
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Salva a integridade dos campos de Bancos de Dados 		     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea("SX2")
dbSeek(cAlias)
dbSelectArea("SX3")
dbSeek(cAlias)

While !Eof() .And. (x3_arquivo == cAlias)
	If X3USO(x3_usado) .AND. cNivel >= x3_nivel .And.;
		Trim(x3_campo) != "G2_PRODUTO" .And. Trim(x3_campo) != "G2_CODIGO" .And. ;
		Trim(x3_campo) != "G2_REFGRD" .And. (!(Trim(x3_campo) $ "G2_LINHAPR/G2_TPLINHA") .Or. !SuperGetMV("MV_UNILIN",.F.,.F.))
		nUsado++
		If AllTrim(X3_CAMPO) == "G2_OPERAC"
			nPosOper:=nUsado
		EndIf
		Aadd(aHeader,{ TRIM(X3Titulo()), x3_campo, x3_picture,;
				x3_tamanho, x3_decimal, x3_valid,;
				x3_usado, x3_tipo, x3_arquivo, x3_context } )
	EndIf
	dbSkip()
End
ADHeadRec(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta Entrada de dados sem Roteiro Similar.          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE aCOLS := {}
AADD(aCols,{})
dbSelectArea("SX3")
dbSeek(cAlias)
nUsado:=0
While !Eof() .And. (x3_arquivo == cAlias)
	 If X3USO(x3_usado) .AND. cNivel >= x3_nivel .And. ;
		 Trim(x3_campo) != "G2_PRODUTO" .And. Trim(x3_campo) != "G2_CODIGO" .And. ;
		 Trim(x3_campo) != "G2_REFGRD"	.And. (!(Trim(x3_campo) $ "G2_LINHAPR/G2_TPLINHA") .Or. !SuperGetMV("MV_UNILIN",.F.,.F.))
		nUsado++
		AADD(aCols[1],{})
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Monta Array de 1 elemento ³
		//³ vazio. Se inclus†o.       ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		IF x3_tipo == "C"
			If Trim(X3_CAMPO) == "G2_OPERAC"
				aCOLS[1][nUsado] := "01"
			Else
				aCOLS[1][nUsado] := SPACE(x3_tamanho)
			EndIF
		ELSEIF x3_tipo == "N"
			aCOLS[1][nUsado] := 0
		ELSEIF x3_tipo == "D"
			aCOLS[1][nUsado] := dDataBase
		ELSEIF x3_tipo == "M"
			aCOLS[1][nUsado] := ""
		ELSE
			aCOLS[1][nUsado] := .F.
		ENDIF
		If x3_context == "V"
			aCOLS[1][nUsado] := CriaVar(Alltrim(x3_campo))
		Endif
	ENDIF
	dbSkip()
End
nUsado++
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Walk-Thru						                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
AADD(aCols[1],{})
aCols[1][nUsado] := cAlias
nUsado++
AADD(aCols[1],{})
aCols[1][nUsado] := 0

AADD(aCols[1],{})
aCOLS[1][nUsado+1] := .F.

SetKey (VK_F4,{ || A630F4(nOpcx) })
nOpca:= 0                               

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Calcula dimensões ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oSize := FwDefSize():New( .F. )

oSize:AddObject( "CIMA" , 100, 20, .T., .F., .T. )		// Nao dimensiona Y 
oSize:AddObject( "BAIXO", 100, 100, .T., .T., .T. )	// Totalmente dimensionavel

oSize:lProp := .T.					// Proporcional 
oSize:aMargins := { 3, 3, 3, 3 }	// Espaco ao lado dos objetos 0, entre eles 3 

oSize:Process() // Dispara os calculos 
If !__lAutomacao                                              
DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0006); 	//"Roteiro de Opera‡”es"
 					 FROM oSize:aWindSize[1],oSize:aWindSize[2] TO oSize:aWindSize[3],oSize:aWindSize[4] OF oMainWnd PIXEL

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Adiciona Panel												 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oPanel1:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[1,3])
oPanel2:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[2,3])

oPanel1:Align := CONTROL_ALIGN_TOP
oPanel2:Align := CONTROL_ALIGN_ALLCLIENT

@ oSize:aPosObj[1,1]+2,003 SAY OemToAnsi(STR0007) of oPanel1 PIXEL //"&C¢digo"
@ oSize:aPosObj[1,1],022 MSGET c630Cod Picture "@!" Valid A630Cod() SIZE 02,10 of oPanel1 PIXEL
@ oSize:aPosObj[1,1]+2,040 SAY STR0008 SIZE 25,7 SIZE 100,10 of oPanel1	PIXEL //"&Produto"
@ oSize:aPosObj[1,1],070 MSGET c630Prod F3 "SB1" Picture "@!" Valid A630Prod(@cDescProd,@c630RefGrd) .and. VldUser("G2_PRODUTO") SIZE 104,10 of oPanel1 PIXEL
@ oSize:aPosObj[1,1],180 MSGET cDescProd PICTURE "@!" WHEN .F. SIZE 120,10 of oPanel1 PIXEL

@ oSize:aPosObj[1,1]+2,330 SAY OemToAnsi(STR0009) of oPanel1 PIXEL	//"&Roteiro Similar"
@ oSize:aPosObj[1,1],390 MSGET c630CodAux	F3 "SG2" Picture "@!" Valid A630CodAux() .And. A630aCols(c630CodAux,c630ProdAu,lOK,cAlias,oGet,lRefGrd) When lWhnSim SIZE 02,10 of oPanel1 PIXEL
@ oSize:aPosObj[1,1],425 MSGET c630ProdAu F3 "SB1" Picture "@!" Valid A630ProdAux(@lRefGrd) .And. A630aCols(c630CodAux,c630ProdAu,lOK,cAlias,oGet,lRefGrd) When lWhnSim SIZE 104,10 of oPanel1 PIXEL

cRoteiro:=c630CodAux
If SuperGetMV("MV_UNILIN",.F.,.F.)
	aComboLin := A630CombLi()
	nComboLin := aScan(aComboLin[1],{|x| AllTrim(x) == AllTrim(c630TipLin)})
	
	@ 37,007 SAY RetTitle("G2_LINHAPR") SIZE 18,7 OF oDlg PIXEL
	@ 35,028 MSGET c630Linhapr F3 "SHL" PICTURE "@!" Valid (!Empty(c630Linhapr),ExistCpo("SHL",c630Linhapr,1),.T.) SIZE 9,10 OF oDLG PIXEL
	@ 35,077 MSGET Posicione("SHL",1,xFilial("SHL")+c630Linhapr,"HL_DESC") PICTURE "@!" WHEN .F. SIZE 100,10 OF oDLG PIXEL
	@ 37,300 SAY RetTitle("G2_TPLINHA") SIZE 30,7 OF oDlg PIXEL
	oComboLin := tComboBox():New(35,335,{|u|if(PCount()>0,c630TipLin:=u,c630TipLin)},aComboLin[2],50,20,oDlg,,nil,,,,.T.,,,,,,,,,'c630TipLin')
	oComboLin:Select(nComboLin)
EndIf
oGet := MSGetDados():New(aPosObj[2,1],aPosObj[2,2],aPosObj[2,3],aPosObj[2,4],nOpcx,"a630LinOk","a630TudOk","",(nOpcx <> 2),,,,700,"A630VldCpo()")

ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{||nOpca:=1,if(oGet:TudoOk(),oDlg:End(),nOpca := 0)},{||oDlg:End()},,aButtons)
EndIf
Set Key VK_F4 To
If nOpcA == 1
	Begin Transaction

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Executa o Ponto de Entrada MA630INC                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		lConfInc := .T.
		If lMA630Inc
			lConfInc := ExecBlock('MA630INC',.F.,.F.)
			If ValType(lConfInc) # 'L'
				lConfInc := A630Ret("MA630INC")
			EndIf
		EndIf

		If lConfInc
			A630Grava(cAlias)
		EndIf

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Executa o Ponto de Entrada QP010J11 - Utilizado no Modulo de Insp. de Processos ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If lQP010J11
			ExecBlock('QP010J11',.F.,.F.)
		EndIf

		//Processa Gatilhos
		EvalTrigger()
	End Transaction
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Executa o Ponto de Entrada MA630FIN                               ³
//³ Apos Confirmacao (nOpcA=1) ou Cancelamento (nOpcA<>1) da Inclusao ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lMA630FIN
	ExecBlock( "MA630FIN", .F., .F., {nOpcA} )
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura a integridade da janela						     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
dbSetOrder(1)
dbGoto(nReg)
Return .T.

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³A630Altera³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Programa de alteracao de operacoes						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ Void A630Altera(ExpC1,ExpN1,ExpN2)						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo									  ³±±
±±³			 ³ ExpN1 = Numero do registro 								  ³±±
±±³			 ³ ExpN2 = Opcao selecionada no menu						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630Altera(cAlias,nReg,nOpcx)
LOCAL bCampo,nOpcA:=0, nCnt:=0, lOk := .T.
Local cVarTemp
Local lMA630Alt := ExistBlock('MA630ALT')
Local lConfAlt  := .T.
LOCAL oDlg,oGet
Local lQP010J11 := ExistBlock('QP010J11')
Local cDescProd :=""
Local i
Local aButtons  := {}
Local nIndexOrd
Local cSeekWhile := "G2_FILIAL+G2_PRODUTO+G2_CODIGO"
Local oComboLin  := NIL
Local aComboLin  := {}
Local nComboLin  := 0                                       
Local lCheckList 	:= SuperGetMV("MV_CHKOPER",.F.,.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Walk-Thru						                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aNoFields	 := { "G2_PRODUTO","G2_CODIGO","G2_REFGRD" }
Local bSeekWhile := {} // Condicao While para montar o aCols
Local cSeek		 := ""
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo						     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE c630Cod
PRIVATE c630Prod
PRIVATE c630RefGrd
PRIVATE c630Linhapr := Space(TamSX3("G2_LINHAPR")[1])
PRIVATE c630TipLin  := Space(TamSX3("G2_TPLINHA")[1]) 
PRIVATE c630Rev
PRIVATE cReviBack	:= ''
PRIVATE cReviAtu	:= ''
PRIVATE aTela[0][0],aGets[0],aHeader[0],Continua,nUsado:=0,aCols:={}
PRIVATE aHeadRec:={},aColsRec:={},nMaxArray,lPrim:=.T.
PRIVATE aHeadFer:={},aColsFer:={},cRoteiro,lPadrao:=.F.
PRIVATE aHeadRecCT:={},aColsRecCT := {}
PRIVATE nPosOper
PRIVATE cCodAnt := ""
PRIVATE aRecBkp := {}
        
//-- Integracao APS e SFC: bloqueia alteracao se em uso
If !A630BlqSHY()
	Return
EndIf

//Realiza load do checklist das operacoes
aItensChk :=  LoadSGR(SG2->G2_PRODUTO,SG2->G2_CODIGO)

If SuperGetMV("MV_UNILIN",.F.,.F.)
	aAdd(aNoFields,"G2_LINHAPR")
	aAdd(aNoFields,"G2_TPLINHA")
EndIf

dbSelectArea("SG2")
c630Cod		:= G2_CODIGO
c630Prod	:= G2_PRODUTO
c630RefGrd	:= G2_REFGRD
c630Linhapr := G2_LINHAPR
c630TipLin  := G2_TPLINHA
cRoteiro	:= c630Cod

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para exportar dados para EXCEL                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If RemoteType() == 1
	aAdd(aButtons   , {PmsBExcel()[1],{|| DlgToExcel({ {"CABECALHO",cCadastro,{OemToAnsi(STR0007),OemToAnsi(STR0008)},{c630Cod,c630Prod}},{"GETDADOS",OemToAnsi(STR0036),aHeader,aCols}})},PmsBExcel()[2],PmsBExcel()[3]})
EndIf
              
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para selecao de checklist                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lCheckList
	aAdd(aButtons,{"MA631CHK", {|| If(!Empty(aCols[n,1]),A630ExecCh(nOpcx),MsgInfo(STR0053,STR0050))} ,STR0052,STR0054})	//CheckList 	
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de Entrada criado para mudar os botoes da enchoicebar                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("MA630BUT")
	aButtons := ExecBlock( "MA630BUT",.F.,.F.,{nOpcx,aButtons})
	If ValType(aButtons)# "A"
		aButtons := {}
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe algum dado no arquivo 				     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
nSavRec 	:= Recno()
aSavLock	:= {}
If a630SeekSG2(1,c630Prod,xFilial("SG2")+If(Empty(c630RefGrd),c630Prod,c630RefGrd)+c630Cod,@cSeekWhile) 
	While !Eof() .And. Eval(&cSeekWhile)
		AADD(aSavLock,Recno())
		SoftLock(cAlias)
		nCnt++
		dbSkip()
	EndDo
EndIf

dbGoTo(nSavRec)
If nCnt == 0
	dbGoTo(nReg)
	Return .T.
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se esta' na filial correta                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If xFilial("SG2") # G2_FILIAL
	Help(" ",1,"A000FI")
	For i:=1 to Len(aSavLock)
		dbGoto(aSavLock[i])
		MsUnLock()
	Next
	dbGoTo(nReg)
	Return
EndIf

bCampo := {|nCPO| Field(nCPO) }

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aHeader e aCols utilizando a funcao FillGetDados   	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//-- Verifica se utilizar codigo referencia de grade (familia) ou codigo completo
If Empty(c630RefGrd)
	cSeek		:= xFilial("SG2")+c630Prod+c630Cod
	bSeekWhile	:= { || SG2->( G2_FILIAL+G2_PRODUTO+G2_CODIGO ) }
	nIndexOrd	:= 1

	//-- Definido a descricao
	SB1->(dbSetOrder(1))
	If SB1->(dbSeek(xFilial("SB1")+c630Prod))
		cDescProd := SB1->B1_DESC
	EndIf
Else
	cSeek		:= xFilial("SG2")+c630RefGrd+c630Cod
	bSeekWhile	:= { || SG2->(G2_FILIAL+G2_REFGRD+G2_CODIGO) }
	nIndexOrd	:= 7

	//-- Definido a descricao
	If !MatGrdPrrf(SG2->G2_REFGRD)
		MatOrigGrd("SBQ")
	EndIf
	cDescProd	:= MaGetDescGrd(SG2->G2_REFGRD)  

	//-- Muda visualizao de campo
	c630Prod := c630RefGrd
EndIf

DbSelectArea(cAlias)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Sintaxe da FillGetDados( nOpcx, cAlias, nOrder, cSeekKey, bSeekWhile, uSeekFor, aNoFields, aYesFields, lOnlyYes, cQuery, bMontCols, lEmpty, aHeaderAux, aColsAux, bAfterCols, bBeforeCols, bAfterHeader, cAliasQry ) |
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
FillGetDados(nOpcX,cAlias,nIndexOrd,cSeek,bSeekWhile,{||.T.},aNoFields)
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Alimenta variavel Private, utilizada no Init. Pad. do campo ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nPosOper := GDFieldPos("G2_OPERAC")

nUsado := Len(aHeader)
dbSelectArea(cAlias)
dbGoTo(nSavRec)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aHeadRec e aHeadFer.								  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Len(aHeadRec) == 0
	dbSelectArea("SX3")
	dbSetOrder(1)
	If dbSeek("SH3")
		While !Eof() .And. (x3_arquivo == "SH3")
			If X3USO(x3_usado) .And. cNivel >= x3_nivel	.And. ;
				( Trim(x3_campo) == "H3_RECALTE" .Or. Trim(x3_campo) == "H3_DESC" .Or. ;
				Trim(x3_campo) == "H3_TIPO" .Or. Trim(x3_campo) == "H3_EFICIEN" )
				Aadd(aHeadRec,{ Trim(X3Titulo()), x3_campo, x3_picture,;
				x3_tamanho, x3_decimal, x3_valid,;
				x3_usado, x3_tipo, x3_arquivo, x3_context } )
			ElseIf X3USO(x3_usado) .And. cNivel >= x3_nivel  .And. ;
				( Trim(x3_campo) == "H3_FERRAM" .Or. Trim(x3_campo) == "H3_DESCFER" )
				Aadd(aHeadFer,{ Trim(X3Titulo()), x3_campo, x3_picture,;
				x3_tamanho, x3_decimal, x3_valid,;
				x3_usado, x3_tipo, x3_arquivo, x3_context } )
			EndIf
			dbSkip()
		EndDo
		ADHeadRec("SH3",aHeadRec)	// Walk-Thru
		ADHeadRec("SH3",aHeadFer)
	EndIf
	dbSelectArea(cAlias)
	dbSetOrder(1)
Endif

If Len(aHeadRecCT) == 0
	dbSelectArea("SX3")
	dbSetOrder(1)
	If dbSeek("SHJ")
		While !Eof() .And. (x3_arquivo == "SHJ")
			If X3USO(x3_usado) .And. cNivel >= x3_nivel	
				Aadd(aHeadRecCT,{ Trim(X3Titulo()), x3_campo, x3_picture,;
				x3_tamanho, x3_decimal, x3_valid,;
				x3_usado, x3_tipo, x3_arquivo, x3_context } )
			EndIf
			dbSkip()
		EndDo
		ADHeadRec("SHJ",aHeadRecCT)
	EndIf
	dbSelectArea(cAlias)
	dbSetOrder(1)
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aColsRec / aColsFer /  aColsRecCT 				  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
A630NewaCols()
aRecBkp := aClone(aColsRecCt)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ativa tecla F4 para geracao de maquinas alternativas ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
SetKey (VK_F4,{ || A630F4(nOpcx) })
nOpca:= 0

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Calcula dimensoes											 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oSize := FwDefSize():New( .F. )

oSize:AddObject( "CIMA" , 100, 020, .T., .F., .T. )	// Nao dimensiona Y 
oSize:AddObject( "BAIXO", 100, 100, .T., .T., .T. )	// Totalmente dimensionavel

oSize:lProp := .T.					// Proporcional 
oSize:aMargins := { 3, 3, 3, 3 }	// Espaco ao lado dos objetos 0, entre eles 3 

oSize:Process() // Dispara os calculos 
If !__lAutomacao
DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0006) PIXEL From aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd	//"Roteiro de Opera‡”es"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Adiciona Panel												 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oPanel1:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[1,3])
oPanel2:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[2,3])

oPanel1:Align := CONTROL_ALIGN_TOP
oPanel2:Align := CONTROL_ALIGN_ALLCLIENT

@ oSize:aPosObj[1,1],aPosObj[1,2] To oSize:aPosObj[1,3],oSize:aPosObj[1,4] PIXEL
@ oSize:aPosObj[1,1]+2,007 SAY OemToAnsi(STR0007) SIZE 18,7 OF oPanel1 PIXEL	//"&C¢digo"
@ oSize:aPosObj[1,1],028 MSGET c630Cod Picture "@!" WHEN .F. SIZE 13,10 OF oPanel1 PIXEL
@ oSize:aPosObj[1,1]+2,055 SAY OemToAnsi(STR0008) SIZE 25,7 OF oPanel1 PIXEL	//"&Produto"
@ oSize:aPosObj[1,1],077 MSGET c630Prod Picture "@!" WHEN .F. SIZE 100,10 OF oPanel1 PIXEL
@ oSize:aPosObj[1,1],183 MSGET cDescProd PICTURE "@!" WHEN .F. SIZE 100,10 OF oPanel1 PIXEL

If SuperGetMV("MV_UNILIN",.F.,.F.)
	aComboLin := A630CombLi()
	nComboLin := aScan(aComboLin[1], {|x| AllTrim(x) == AllTrim(c630TipLin)})
	
	@ 37,007 SAY RetTitle("G2_LINHAPR") SIZE 18,7 OF oDlg PIXEL
	@ 35,028 MSGET c630Linhapr F3 "SHL" PICTURE "@!" Valid (!Empty(c630Linhapr),ExistCpo("SHL",c630Linhapr,1),.T.) SIZE 9,10 OF oDLG PIXEL
	@ 35,077 MSGET Posicione("SHL",1,xFilial("SHL")+c630Linhapr,"HL_DESC") PICTURE "@!" WHEN .F. SIZE 100,10 OF oDlg PIXEL
	@ 37,300 SAY RetTitle("G2_TPLINHA") SIZE 30,7 OF oDlg PIXEL
	oComboLin := tComboBox():New(35,335,{|u|if(PCount()>0,c630TipLin:=u,c630TipLin)},aComboLin[2],50,20,oDlg,,nil,/**/,,,.T.,,,,,,,,,'c630TipLin')
	oComboLin:Select(nComboLin)
EndIf
oGet := MSGetDados():New(aPosObj[2,1],aPosObj[2,2],aPosObj[2,3],aPosObj[2,4],nOpcx,"a630LinOk","a630TudOk","",(nOpcx <> 2),,,,700,"A630VldCpo()")
ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{||nOpca:=1,if(oGet:TudoOk(),oDlg:End(),nOpca := 0)},{||oDlg:End()},,aButtons)
EndIf
Set Key VK_F4 To

IF nOpcA == 1
	Begin Transaction

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Executa o Ponto de Entrada MA630ALT                          ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		lConfAlt := .T.
		If lMA630Alt
			lConfAlt := ExecBlock('MA630ALT',.F.,.F.)
			If ValType(lConfAlt) # 'L'
				lConfAlt := A630Ret("MA630ALT")
			EndIf
		EndIf

		If lConfAlt
			A630Grava(cAlias)
		EndIf

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Executa o Ponto de Entrada QP010J11 - Utilizado no Modulo de Insp. de Processos ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If lQP010J11
			ExecBlock('QP010J11',.F.,.F.)
		EndIf

		//Processa Gatilhos
		EvalTrigger()
	End Transaction
Else
	dbSelectArea(cAlias)
	dbSetOrder(1)
	For i:=1 to Len(aSavlock)
		dbgoto(aSavLock[i])
		MsUnLock()
	Next
Endif

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura a integridade da janela						     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
dbSetOrder(1)
dbGoto(nReg)
Return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630Deleta³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Programa de exclusao de operacoes						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³ Void A630Deleta(ExpC1,ExpN1,ExpN2)						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Alias do arquivo									  ³±±
±±³			 ³ ExpN1 = Numero do registro 								  ³±±
±±³			 ³ ExpN2 = Numero da opcao selecionada 			   		      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630Deleta(cAlias,nReg,nOpcx)
LOCAL bCampo,nSavRec,nCnt:=0
Local cDescProd	 :=""
Local cVarTemp
Local lMA630DelT := ExistTemplate('MA630DEL')
Local lMA630Del  := ExistBlock('MA630DEL')
Local lConfDel   := .T.
Local oDlg,oGet
Local i
Local aButtons 	 := {}
Local nIndexOrd
Local cSeekWhile := "G2_FILIAL+G2_PRODUTO+G2_CODIGO"
Local oComboLin  := NIL
Local aComboLin  := {}
Local nComboLin  := 0
Local lCheckList := SuperGetMV("MV_CHKOPER",.F.,.F.)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Walk-Thru						                              ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local aNoFields	 := { "G2_PRODUTO","G2_CODIGO","G2_REFGRD" }
Local bSeekWhile := {} // Condicao While para montar o aCols
Local cSeek		 := ""

PRIVATE c630Prod
PRIVATE c630Cod
PRIVATE c630RefGrd
PRIVATE c630Linhapr
PRIVATE c630TipLin

aItensChk :=  LoadSGR(SG2->G2_PRODUTO,SG2->G2_CODIGO)

nOpca:=0

//-- Integracao APS e SFC: bloqueia alteracao se em uso
If !A630BlqSHY()
	Return
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe algum dado no arquivo 					 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
dbSetOrder(1)
c630Cod		:= G2_CODIGO
c630Prod	:= G2_PRODUTO
c630RefGrd	:= G2_REFGRD
c630Linhapr := G2_LINHAPR
c630TipLin  := G2_TPLINHA

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para exportar dados para EXCEL                    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If RemoteType() == 1
	aAdd(aButtons   , {PmsBExcel()[1],{|| DlgToExcel({ {"CABECALHO",cCadastro,{OemToAnsi(STR0007),OemToAnsi(STR0008)},{c630Cod,c630Prod}},{"GETDADOS",OemToAnsi(STR0036),aHeader,aCols}})},PmsBExcel()[2],PmsBExcel()[3]})
EndIf
                     
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Botao para selecao de checklist                         ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lCheckList
	aAdd(aButtons,{"MA631CHK", {|| If(!Empty(aCols[n,1]),A630ExecCh(nOpcx),MsgInfo(STR0053,STR0050))} ,STR0052,STR0054})	//CheckList 	
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de Entrada criado para mudar os botoes da enchoicebar                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("MA630BUT")
	aButtons := ExecBlock( "MA630BUT",.F.,.F.,{nOpcx,aButtons})
	If ValType(aButtons)# "A"
		aButtons := {}
	EndIf
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se o Roteiro podera ser excluido caso a Integracao  ³
//³ QIP x PCP esteja definida.								     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If IntQIP(c630Prod)
	dbSeek(xFilial("SG2")+C630Prod+c630Cod)
	If ( !QIPCheckRoteiro(c630Prod,,c630Cod) )
		Return(NIL)
	EndIf
EndIf


//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se existe algum dado no arquivo 				     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
nSavRec 	:= Recno()
aSavLock	:= {}

If a630SeekSG2(1,c630Prod,xFilial("SG2")+If(Empty(c630RefGrd),c630Prod,c630RefGrd)+c630Cod,@cSeekWhile)
	While !Eof() .And. Eval(&cSeekWhile)
		AADD(aSavLock,Recno())
		SoftLock(cAlias)
		nCnt++
		dbSkip()
	EndDo
EndIf

dbGoTo(nSavRec)
If nCnt == 0
	dbGoTo(nReg)
	Return .T.
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se esta' na filial correta                          ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If xFilial("SG2") != G2_FILIAL
	For i:=1 to Len(aSavLock)
		dbGoto(aSavLock[i])
		MsUnLock()
	Next
	dbGoTo(nReg)
	Help(" ",1,"A000FI")
	Return
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta a entrada de dados do arquivo							 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
PRIVATE aTELA[0][0],aGETS[0],aHeader[0],Continua,nUsado:=0,aCols:={}
bCampo := {|nCPO| Field(nCPO) }

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Monta aHeader e aCols utilizando a funcao FillGetDados   	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
//-- Verifica se utilizar codigo referencia de grade (familia) ou codigo completo
If Empty(c630RefGrd)
	cSeek		:= xFilial("SG2")+c630Prod+c630Cod
	bSeekWhile	:= { || SG2->( G2_FILIAL+G2_PRODUTO+G2_CODIGO ) }
	nIndexOrd	:= 1

	//-- Definido a descricao
	SB1->(dbSetOrder(1))
	If SB1->(dbSeek(xFilial("SB1")+c630Prod))
		cDescProd := SB1->B1_DESC
	EndIf
Else
	cSeek		:= xFilial("SG2")+c630RefGrd+c630Cod
	bSeekWhile	:= { || SG2->( G2_FILIAL+G2_REFGRD+G2_CODIGO ) }
	nIndexOrd	:= 7

	//-- Definido a descricao
	If !MatGrdPrrf(SG2->G2_REFGRD)
		MatOrigGrd("SBQ")
	EndIf
	cDescProd	:= MaGetDescGrd(SG2->G2_REFGRD)

	//-- Muda visualizao de campo
	c630Prod := c630RefGrd
EndIf

DbSelectArea(cAlias)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Sintaxe da FillGetDados( nOpcx, cAlias, nOrder, cSeekKey, bSeekWhile, uSeekFor, aNoFields, aYesFields, lOnlyYes, cQuery, bMontCols, lEmpty, aHeaderAux, aColsAux, bAfterCols, bBeforeCols, bAfterHeader, cAliasQry ) |
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
FillGetDados(nOpcX,cAlias,nIndexOrd,cSeek,bSeekWhile,{||.T.},aNoFields)

nUsado := Len(aHeader)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Calcula dimensões ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
oSize := FwDefSize():New( .F. )

oSize:AddObject( "CIMA" , 100, 20, .T., .F., .T. ) // Nao dimensiona Y 
oSize:AddObject( "BAIXO", 100, 100, .T., .T., .T. ) // Totalmente dimensionavel

oSize:lProp := .T. // Proporcional 
oSize:aMargins := { 3, 3, 3, 3 } // Espaco ao lado dos objetos 0, entre eles 3 

oSize:Process() // Dispara os calculos 
If !__lAutomacao
DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0006) PIXEL From aSize[7],0 TO aSize[6],aSize[5] OF oMainWnd	//"Roteiro de Opera‡”es"

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Adiciona Panel ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

oPanel1:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[1,3])
oPanel2:= tPanel():New(000,000,,oDlg,,,,,,100,oSize:aPosObj[2,3])

oPanel1:Align := CONTROL_ALIGN_TOP
oPanel2:Align := CONTROL_ALIGN_ALLCLIENT

@ oSize:aPosObj[1,1],oSize:aPosObj[1,2] To oSize:aPosObj[1,3],oSize:aPosObj[1,4] PIXEL
@ oSize:aPosObj[1,1]+2,007 SAY OemToAnsi(STR0007) SIZE 18,7 OF oPanel1 PIXEL	//"&C¢digo"
@ oSize:aPosObj[1,1],028 MSGET c630Cod Picture "@!" WHEN .F. SIZE 9,10 OF oPanel1 PIXEL
@ oSize:aPosObj[1,1]+2,055 SAY OemToAnsi(STR0008) SIZE 25,7 OF oPanel1 PIXEL	//"&Produto"
@ oSize:aPosObj[1,1],077 MSGET c630Prod Picture "@!" WHEN .F. SIZE 100,10 OF oPanel1 PIXEL
@ oSize:aPosObj[1,1],185 MSGET cDescProd PICTURE "@!" WHEN .F. SIZE 100,10 OF oPanel1 PIXEL

If SuperGetMV("MV_UNILIN",.F.,.F.)
	aComboLin := A630CombLi()
	nComboLin := aScan(aComboLin[1], {|x| AllTrim(x) == AllTrim(c630TipLin)})
	
	@ 37,007 SAY RetTitle("G2_LINHAPR") SIZE 18,7 OF oDlg PIXEL
	@ 35,028 MSGET c630Linhapr PICTURE "@!" WHEN .F. SIZE 9,10 OF oDlg PIXEL
	@ 35,077 MSGET Posicione("SHL",1,xFilial("SHL")+c630Linhapr,"HL_DESC") PICTURE "@!" WHEN .F. SIZE 100,10 OF oDlg PIXEL
	@ 37,300 SAY RetTitle("G2_TPLINHA") SIZE 30,7 OF oDlg PIXEL
	oComboLin := tComboBox():New(35,335,{|u|if(PCount()>0,c630TipLin:=u,c630TipLin)},aComboLin[2],50,20,oDlg,,nil,,,,.T.,,,,{||.f.},,,,,'c630TipLin')
	oComboLin:Select(nComboLin)
EndIf
oGet := MSGetDados():New(aPosObj[2,1],aPosObj[2,2],aPosObj[2,3],aPosObj[2,4],nOpcx,"a630LinOk","a630TudOk","",,,,,700)
ACTIVATE MSDIALOG oDlg ON INIT EnchoiceBar(oDlg,{||nOpca:=1,if(oGet:TudoOk(),oDlg:End(),nOpca := 0)},{||oDlg:End()},,aButtons)
EndIf
If nOpcA == 1

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Valida se o Roteiro podera ser excluido                      ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	lConfDel := A630ValDel(c630Prod,c630Cod)
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Executa o Ponto de Entrada MA630DEL                          ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If lMA630DelT
		lConfDel := ExecTemplate('MA630DEL',.F.,.F.)
		If ValType(lConfDel) # 'L'
			lConfDel := A630Ret("MA630DEL")
		EndIf
	EndIf
	If lMA630Del
		lConfDel := ExecBlock('MA630DEL',.F.,.F.)
		If ValType(lConfDel) # 'L'
			lConfDel := A630Ret("MA630DEL")
		EndIf
	EndIf

	If lConfDel
		A630Apaga(c630Prod,c630Cod,nSavRec)
	EndIf

Else
	dbSelectArea(cAlias)
	dbSetOrder(1)
	For i:=1 to Len(aSavLock)
		dbGoto(aSavLock[i])
		MsUnLock()
	Next i
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Restaura a integridade da janela							 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
dbSelectArea(cAlias)
dbSetOrder(1)
dbGoto(nReg)
Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿±±
±±³						 ROTINAS DE CRITICA DE CAMPOS 					  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630LinOk ³ Autor ³ Claudinei M. Benzi    ³ Data 		      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se a linha digitada esta' Ok                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado. 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MatA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630LinOk(o)
Local nx,lRet := .T.,cNewCod, z, x
Local nTempDes:=0,nTipoDes:=0,nTempSobre:=0,nTipoSobre:=0,nDesProp:=0
Local nPosOper:= Ascan(aHeader, { |x| alltrim(x[2]) == "G2_OPERAC" })
Local nPosCTrab:= Ascan(aHeader, { |x| alltrim(x[2]) == "G2_CTRAB" })
For nx = 1 To Len(aHeader)
	If Trim(aHeader[nx][2]) == "G2_TEMPDES"
		nTempDes:=nx
	ElseIf Trim(aHeader[nx][2]) == "G2_TPDESD"
		nTipoDes:=nx
	ElseIf Trim(aHeader[nx][2]) == "G2_TPSOBRE"
		nTipoSobre:=nx 	
	ElseIf Trim(aHeader[nx][2]) == "G2_TEMPSOB"
		nTempSobre:=nx
	EndIf
Next nx

For nx = 1 To Len(aHeader)
	If Empty(aCols[n][nx]) .And. !(aCols[n][Len(aHeader)+1])
		If Trim(aHeader[nx][2]) == "G2_TEMPAD"
			Help(" ",1,"A630SEMTMP")
			lRet := .F.
			Exit
		EndIf
		If Trim(aHeader[nx][2]) == "G2_OPERAC"  .OR.;
			(Trim(aHeader[nx][2]) == "G2_RECURSO" .And. ! TipoAps())
			Help(" ",1,"A630VZ")
			lRet := .F.
			Exit
		EndIf
		If Trim(aHeader[nx][2]) == "G2_TEMPSOB"
			If nTipoSobre > 0
				If !Empty(aCols[n][nTipoSobre])
					Help(" ",1,"A630TIPSOB")
					lRet := .F.
				EndIf
			EndIf
		EndIf
		If Trim(aHeader[nx][2]) == "G2_TPSOBRE"
			If nTempSobre > 0
				If !Empty(aCols[n][nTempSobre])
					Help(" ",1,"A630TMPSOB")
					lRet := .F.
				EndIf
			EndIf
		EndIf
		If Trim(aHeader[nx][2]) == "G2_TEMPDES"
			If nTipoDes > 0
				If !Empty(aCols[n][nTipoDes])
					Help(" ",1,"A630TIPDES")
					lRet := .F.
				EndIf
			EndIf
		EndIf
		If Trim(aHeader[nx][2]) == "G2_TPDESD"
			If nTempDes > 0
				If !Empty(aCols[n][nTempDes])
					Help(" ",1,"A630TMPDES")
					lRet := .F.
				EndIf
			EndIf
		EndIf
	ElseIf !(aCols[n][Len(aHeader)+1])
		If Trim(aHeader[nx][2]) == "G2_OPERAC"
			cNewCod:=aCols[n][nx]
			z:=Len(aCols[n])
			lDeleted:=aCols[n][z]
			If !lDeleted
				For x:=1 to Len(aCols)
					If aCols[x][nx] == cNewCod .And. n != x .And. aCols[x][z] == .F.
						Help(" ",1,"A630OPERJA")
						lRet := .F.
						Exit
					EndIf
				Next x
			EndIf
		EndIf
	EndIf
Next nx
If lRet .And. TipoAps()
	lRet := A630DoGrupo(.T.)
Endif

If lRet .And. (TipoAps(.F.,"DRUMMER") .Or. SuperGetMV("MV_APS",.F.,"")=="TOTVS" .Or. IntegraSFC()) .And. Empty(aCols[n][nPosCTrab])
	Help(" ",1,"OBRIGAT2",,RetTitle("G2_CTRAB"),04,01)
	lRet := .F.
EndIf              

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Valida se a operacao podera ser deletada³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lRet .And. GdDeleted()
	lRet := A630ValDel(c630Prod,c630Cod)
EndIf

//Ponto de Entrada na validação linha da operação
If lRet .And. ExistBlock("MA630VLI")
	lRet := ExecBlock('MA630VLI',.F.,.F.)
EndIf

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630TudOk ³ Autor ³ Claudinei M. Benzi	  ³ Data ³		  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se todo a operacao esta Ok						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado. 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ MatA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630TudOk(o)
Local nx
Local nPosCT
Local lRet := .T.
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ verifica se o ultimo elemento do array esta em branco	     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nMaxArray := Len(aCols)
For nx = 1 to Len(aHeader)
	If Empty(aCols[nMaxArray][nx])
		If Trim(aHeader[nx][2]) == "G2_OPERAC"  .Or.;
			(! TipoAps() .And. Trim(aHeader[nx][2]) == "G2_RECURSO")
			nMaxArray--
			Exit
		EndIf
	EndIf
Next nx

//Ponto de Entrada na validação das operaçôes cadastradas
If lRet .And. ExistBlock("MA630VTU")
	lRet := ExecBlock('MA630VTU',.F.,.F.)
EndIf

If nMaxArray <= 0
	Continua := .T.
EndIf

If lRet .And. (TipoAps(.F.,"DRUMMER") .Or. SuperGetMV("MV_APS",.T.,"") == "TOTVS" .Or. IntegraSFC())
	nPosCT := GdFieldPos( "G2_CTRAB" )
	aEval(aCols, {|x| If(Empty(x[nPosCT]) .And. ! Atail(x), lRet := .F.,)})
	If !lRet
		Help(" ",1,"OBRIGAT2",,RetTitle("G2_CTRAB"),04,01)
		lRet := .F.
	EndIf
EndIf         

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Validacoes do Quality³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lRet .AND. IntQIP(c630Prod)
	lRet := QIPValDOpr( c630Prod, c630Cod, aCols, Len(aHeader)+1 )
EndIf

Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ A630F4	³ Autor ³ Rodrigo de A. Sartorio³ Data ³28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Faz a verificacao e gravacao dos recursos alternativos	 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ A630F4(cExp1,nExp1)										 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630F4(nOpcx)
Local nx,cOper,cRecPrin, cFerram,cCTrab, i
Local nHdl := GetFocus()
Local lRet := .T.
Private nAlias,nUsadoAux, nAcolsPrinc
Private aHeadOld:={},aColsOld:={}

If ReadVar() == "M->G2_RECURSO" .Or. ReadVar() == "M->G2_FERRAM" .Or. ( TipoAps(.F.,"DRUMMER") .And. ReadVar() == "M->G2_CTRAB" )

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³	Salva area de trabalho anterior                   ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	nAlias	 := Alias()
	nAcolsPrinc := n

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Arrays auxiliares para armazenar a getdados      ³
	//³ principal.                                       ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	aHeadOld:=Aclone(aHeader)
	aColsOld:=Aclone(aCols)

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Salva linha da primeira GetDados.                 ³
	//³ Salva variavel p/ HotArea.                        ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	nUsadoAux:=nUsado

EndIf

If ReadVar() == "M->G2_RECURSO" .or. __lAutomacao

	While .T.

		For nx := 1 To Len(aHeader)
			Do Case
				Case Trim(aHeader[nx][2]) == "G2_OPERAC"
					cOper := aCols[n][nx]
				Case Trim(aHeader[nx][2]) == "G2_RECURSO"
					cRecPrin := aCols[n][nx]
			EndCase
		Next nx

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica se a opera‡„o e o recurso n„o est„o vazios. ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		IF Empty(cOper) .Or. Empty(cRecPrin)
			Help(" ",1,"A630F4")
			Exit
		Else
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Se for uma inclus„o.                                 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If nOpcx = 3
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Verifica se Array de recursos Alternativos ja existe.³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If Empty(aColsRec)
					For i:= 1 to n
						AADD(aColsRec,{})
					Next i
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Verifica se Array de recursos Alternativos tem o	    ³
					//³mesmo tamanho da posi‡„o atual de aCols.			    ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If Len(aColsRec) < n
						For i:= (Len(aColsRec)+1) to n
							AADD(aColsRec,{})
						Next i
					EndIf
				EndIf

				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Verifica se a posi‡„o correspondente a linha do aCols³
				//³ esta vazia no  Array  de Recursos Alternativos.	    ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If Empty(aColsRec[n])
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Se .T., liga o flag p/ criar um Acols em branco.	    ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					aCols:={}
					lPrim:=.F.
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Se .F.,copia a posi‡„o do Array de Rec. Alt. p/ aCols³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					aCols:=Aclone(aColsRec[n])
				EndIf
				aHeader:={}
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Se for uma altera‡„o.                                ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			ElseIf nOpcx = 4
				aheader:={}
				If Len(aColsRec) < n
					For i:= (Len(aColsRec)+1) to n
						AADD(aColsRec,{})
					Next i
				Endif
				aCols:={}
				If !Empty(aColsRec[n])
					aCols:=Aclone(aColsRec[n])
				Else
					lPrim:=.F.
				EndIf
			EndIf

			lRet := MontaF4(nOpcx,"R",n)

			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Volto array da GetDados principal e as posicoes de³
			//³ Linha e da Hot Area.                              ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			aHeader:={};aHeader:=Aclone(aHeadOld)
			aCols  :={};aCols  :=Aclone(aColsOld)
			nUsado:=nUsadoAux
			n := nAcolsPrinc
			dbSelectArea(nAlias)
		EndIf
		Exit
	End

ElseIf ReadVar() == "M->G2_FERRAM"

	While .T.

		For nx := 1 To Len(aHeader)
			Do Case
				Case Trim(aHeader[nx][2]) == "G2_OPERAC"
					cOper := aCols[n][nx]
				Case Trim(aHeader[nx][2]) == "G2_FERRAM"
					cFerram := aCols[n][nx]
			EndCase
		Next nx

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica se a opera‡„o e o recurso n„o est„o vazios. ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If Empty(cOper) .Or. Empty(cFerram)
			Help(" ",1,"A630F42")
			Exit
		Else
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Se for uma inclus„o.								 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If nOpcx = 3
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Verifica se Array de Ferramentas j  existe.		    ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If Empty(aColsFer)
					For i:= 1 to n
						AADD(aColsFer,{})
					Next i
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Verifica se Array de Ferramentas tem o mesmo tamanho ³
					//³da posi‡„o atual de aCols. 					   	    ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If Len(aColsFer) < n
						For i:= (Len(aColsFer)+1) to n
							AADD(aColsFer,{})
						Next i
					EndIf
				EndIf

				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Verifica se a posi‡„o correspondente a linha do aCols³
				//³ esta vazia no  Array  de Ferramentas. 			    ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If Empty(aColsFer[n])
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Se .T., liga o flag p/ criar um Acols em branco.     ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					aCols:={}
					lPrim:=.F.
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Se .F.,copia a posi‡„o do Array de Ferram.  p/ aCols ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					aCols:=Aclone(aColsFer[n])
				EndIf
				aHeader:={}
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Se for uma altera‡„o.                                ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			ElseIf nOpcx = 4
				aheader:={}
				If Len(aColsFer) < n
					For i:= (Len(aColsFer)+1) to n
						Aadd(aColsFer,{})
					Next i
				Endif
				aCols:={}
				If !Empty(aColsFer[n])
					aCols:=Aclone(aColsFer[n])
				Else
					lPrim:=.F.
				EndIf
			EndIf

			lRet := MontaF4(nOpcx,"F",n)

			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Volto array da GetDados principal e as posicoes de³
			//³ Linha e da Hot Area.						      ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			aHeader:={};aHeader:=Aclone(aHeadOld)
			aCols  :={};aCols  :=Aclone(aColsOld)
			nUsado:=nUsadoAux
			n := nAcolsPrinc
			dbSelectArea(nAlias)
		EndIf
		Exit
	End
ElseIf TipoAps(.F.,"DRUMMER") .And. ReadVar() == "M->G2_CTRAB"
	While .T.
        cOper	:= GdFieldGet( "G2_OPERAC" )
        cCTrab	:= M->G2_CTRAB

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Verifica se a opera‡„o e o recurso n„o est„o vazios. ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		IF Empty(cOper) .Or. Empty(cCTrab)
			Help(" ",1,"A630F4")
			Exit
		Else
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Se for uma inclus„o.                                 ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If nOpcx = 3
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³Verifica se Array de recursos restritivos por C.T    ³
				//³ja existe para esta operacao                         ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				If Empty(aColsRecCT)
					For i:= 1 to n
						AADD(aColsRecCT,{})
					Next i
				Else
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³Verifica se Array de recursos restritivos por C.T Tem³
					//³o mesmo tamanho da posi‡„o atual de aCols.		    ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If Len(aColsRecCT) < n
						For i:= (Len(aColsRecCT)+1) to n
							AADD(aColsRecCT,{})
						Next i
					EndIf
				EndIf

				aHeader:={}
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Se for uma altera‡„o.                                ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			ElseIf nOpcx = 4
				aheader:={}
				If Len(aColsRecCT) < n
					For i:= (Len(aColsRecCT)+1) to n
						AADD(aColsRecCT,{})
					Next i
				Endif
				aCols:={}
				If !Empty(aColsRecCT[n])
					aCols:=Aclone(aColsRecCT[n])
				Else
					lPrim:=.F.
				EndIf
			EndIf

			lRet := MontaF4(nOpcx,"C",n)

			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Volto array da GetDados principal e as posicoes de³
			//³ Linha e da Hot Area.                              ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			aHeader:={};aHeader:=Aclone(aHeadOld)
			aCols  :={};aCols  :=Aclone(aColsOld)
			nUsado:=nUsadoAux
			n := nAcolsPrinc
			dbSelectArea(nAlias)
		EndIf
		Exit
	End
EndIf


SetFocus(nHdl)
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ MontaF4	³ Autor ³Rodrigo de A. Sartorio ³ Data ³28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Monta Array com Recursos Alternativos					 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe e ³ MontaF4(ExpN1,ExpC1,ExpN2) 								 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpN1 = Opcao vinda do aRotina							 ³±±
±±³			 ³ ExpC1 = Flag que indica se e'recurso ou ferramenta        ³±±
±±³			 ³ ExpN2 = Numero da linha da Get-Dados original	    	 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Static Function MontaF4(nOpcx,cOpc,nLinha)
Local nCnt:=0,nUsado:=0,lOk := .T.,continua,i
Local oDlg,oGet
Local aSavCols := {aHeader, aCols}

Private cAlias:="SH3",nOpca:=0

If cOpc == "R"

	If Empty(aHeadRec)

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Monta aHeadRec											  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		dbSelectArea("SX3")
		dbSetOrder(1)
		If dbSeek("SH3")
			While !Eof() .And. (x3_arquivo == "SH3")
				If X3USO(x3_usado) .And. cNivel >= x3_nivel	.And. ;
					( Trim(x3_campo) == "H3_RECALTE" .Or. Trim(x3_campo) == "H3_DESC" .Or. ;
					Trim(x3_campo) == "H3_TIPO" .Or. Trim(x3_campo) == "H3_EFICIEN" )
					Aadd(aHeadRec,{ Trim(X3Titulo()), x3_campo, x3_picture,;
					x3_tamanho, x3_decimal, x3_valid,;
					x3_usado, x3_tipo, x3_arquivo, x3_context } )
				EndIf
				dbSkip()
			EndDo
			ADHeadRec("SH3",aHeadRec)   // Walk-Thru
		EndIf
	EndIf

	aHeader := aClone(aHeadRec)
	nUsado  := Len(aHeader)

ElseIf cOpc == "F"

	If Empty(aHeadFer)

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Monta aHeadFer 											  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		dbSelectArea("SX3")
		dbSetOrder(1)
		If dbSeek("SH3")
			While !Eof() .And. (x3_arquivo == "SH3")
				If X3USO(x3_usado) .And. cNivel >= x3_nivel	.And. ;
					( Trim(x3_campo) == "H3_FERRAM" .Or. Trim(x3_campo) == "H3_DESCFER" )
					Aadd(aHeadFer,{ Trim(X3Titulo()), x3_campo, x3_picture,;
					x3_tamanho, x3_decimal, x3_valid,;
					x3_usado, x3_tipo, x3_arquivo, x3_context } )
				EndIf
				dbSkip()
			EndDo
			ADHeadRec("SH3",aHeadFer)	// Walk-Thru
    	EndIf
	EndIf

	aHeader := aClone(aHeadFer)
	nUsado := Len(aHeader)
	
ElseIf cOpc == "C" //CENTRO DE TRABALHO 
	cAlias := "SHJ"
	If Empty(aHeadRecCT)

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Monta aHeadRecCT										  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		dbSelectArea("SX3")
		dbSetOrder(1)
		If dbSeek("SHJ")
			While !Eof() .And. (x3_arquivo == "SHJ")
				If X3USO(x3_usado) .And. cNivel >= x3_nivel	
					Aadd(aHeadRecCT,{ Trim(X3Titulo()), x3_campo, x3_picture,;
					x3_tamanho, x3_decimal, x3_valid,;
					x3_usado, x3_tipo, x3_arquivo, x3_context } )
				EndIf
				dbSkip()
			EndDo
			ADHeadRec("SHJ",aHeadRecCT)	// Walk-Thru
    	EndIf
	EndIf

	aHeader := aClone(aHeadRecCT)
	nUsado := Len(aHeader)
EndIf

nUsado := Len(aHeader)

If !__lAutomacao
If cOpc == "R"
	aCols := aClone(aColsRec[nLinha])
ElseIf cOpc == "F"
	aCols := aClone(aColsFer[nLinha])
ElseIf cOpc == "C"
	aCols := aClone(aColsRecCT[nLinha])
EndIf
EndIf
If Len(aCols) == 0 
	aCols    := {{}}
	aCols[1] := Array(nUsado+1)
	dbSelectArea("SX3")
	dbSetOrder(1)
	dbSeek(cAlias)
	nUsado:=0
	While !Eof() .And. (x3_arquivo == cAlias)
		If cOpc == "R"
			If X3USO(x3_usado) .AND. cNivel >= x3_nivel
				If x3_context # "V" .And. (Trim(X3_CAMPO) == "H3_RECALTE" .Or.;
					Trim(X3_CAMPO) == "H3_TIPO" .Or. Trim(X3_CAMPO) == "H3_EFICIEN")
					nUsado++
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Monta Array de 1 elemento ³
					//³ vazio. Se inclus†o.       ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If x3_tipo == "C"
						aCols[1][nUsado] := SPACE(x3_tamanho)
					ElseIf x3_tipo == "N"
						aCols[1][nUsado] := 0
					EndIf
				ElseIf x3_context == "V" .And. Trim(X3_CAMPO) == "H3_DESC"
					nUsado++
					aCols[1][nUsado] := CriaVar(Alltrim(x3_campo))
				Endif
			EndIf
		ElseIf cOpc == "F"
			If X3USO(x3_usado) .AND. cNivel >= x3_nivel
				If x3_context # "V" .And. Trim(X3_CAMPO) == "H3_FERRAM"
					nUsado++
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Monta Array de 1 elemento ³
					//³ vazio. Se inclus†o. 	  ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					aCols[1][nUsado] := SPACE(x3_tamanho)
				ElseIf x3_context == "V" .And. Trim(X3_CAMPO) == "H3_DESCFER"
					nUsado++
					aCols[1][nUsado] := CriaVar(Alltrim(x3_campo))
				Endif
			EndIf
		ElseIf cOpc == "C" //Centro de trabalho
			If X3USO(x3_usado) .AND. cNivel >= x3_nivel
				If x3_context # "V" 
					nUsado++
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Monta Array de 1 elemento ³
					//³ vazio. Se inclus†o.       ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If x3_tipo == "C"
						aCols[1][nUsado] := SPACE(x3_tamanho)
					ElseIf x3_tipo == "N"
						aCols[1][nUsado] := 0
					EndIf
				ElseIf x3_context == "V"
					nUsado++
					aCols[1][nUsado] := CriaVar(Alltrim(x3_campo),.f.)
				Endif
			EndIf
		EndIf
		dbSkip()
	EndDo
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Walk-Thru						                              ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	aCols[1][Len(aHeader)-1] := cAlias
	aCols[1][Len(aHeader)]   := 0

	aCols[1][Len(aHeader)+1] := .F.
	lPrim:=.T.
Endif

Continua := .F.
nOpca    := 0
If !__lAutomacao
If cOpc == "C" //Centro de trabalho
	DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0038) From 9,10 To 25,60 OF oMainWnd  // ### "Recursos restritivos do Centro de Trabalho"
		oGet := MSGetDados():New(12,7,96,190,nOpcx, ,"A630TOKR()" , ,.T., , , ,500,"A630VldCpo()" , , ,)
		DEFINE SBUTTON FROM 103 ,125 TYPE 1 ACTION (nOpca:=1,If(oGet:TudoOk(),oDlg:End(),nOpca:=0)) ENABLE OF oDlg
		DEFINE SBUTTON FROM 103 ,152 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg
	ACTIVATE MSDIALOG oDlg
Else
	DEFINE MSDIALOG oDlg TITLE OemToAnsi(STR0010) From 9,10 To 20,60 OF oMainWnd	//"Recursos Alternativos / Secund rios"
		If cOpc == "R"
			oGet := MSGetDados():New(12,7,56,190,nOpcx,"A630RLINOK","A630RTUDOK","",.T.)
		ElseIf cOpc == "F"
			oGet := MSGetDados():New(12,7,56,190,nOpcx,"A630FLINOK","A630FTUDOK","",.T.)
		EndIf
		DEFINE SBUTTON FROM 63 ,125 TYPE 1 ACTION (nOpca:=1,If(oGet:TudoOk(),oDlg:End(),nOpca:=0)) ENABLE OF oDlg
		DEFINE SBUTTON FROM 63 ,152 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg
	ACTIVATE MSDIALOG oDlg

EndIf
EndIf
If nOpcA == 1
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Crio Arrays auxiliares para armazenar a getdados  ³
	//³ secundaria .                                      ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If cOpc == "R"
		aColsRec[nLinha]:=Aclone(aCols)
	ElseIf cOpc == "F"
		aColsFer[nLinha]:=Aclone(aCols)
	ElseIf cOpc == "C"
		aColsRecCT[nLinha]:=Aclone(aCols)
		n := nLinha
	EndIf
Endif
dbSelectArea(cAlias)

aHeader := aClone(aSavCols[1])
aCols   := aClone(aSavCols[2])

Return (nOpca == 1)

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630RLINOK³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se a linha digitada esta' Ok na GetDados Secundaria³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado. 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MatA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630RLINOK(o)
Local nx,lRet := .T.

For nx = 1 To Len(aHeader)
	If Empty(aCols[n][nx])
		If Trim(aHeader[nx][2]) == "H3_RECALTE" .And. n == Len(aCols)
			Exit
		EndIf
		If Trim(aHeader[nx][2]) == "H3_RECALTE"  .Or.;
			Trim(aHeader[nx][2]) == "H3_TIPO"
			Help(" ",1,"A630ALTVZ")
			lRet := .F.
			Exit
		EndIf
	EndIf
Next nx
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630RTUDOK³ Autor ³ Rodrigo de A. Sartorio³ Data ³28/09/95  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se toda a opera‡„o esta' Ok na GetDados Secundaria ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado. 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630RTUDOK(o)
Local   nx ,lRet := .T., nMaxArray2
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ verifica se o ultimo elemento do array esta em branco	     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nMaxArray2:= Len(aCols)
For nx = 1 to Len(aHeader)
	If Empty(aCols[nMaxArray2][nx])
		If Trim(aHeader[nx][2]) == "H3_RECALTE"
			nMaxArray2--
			Exit
		EndIf
	EndIf
Next nx

If nMaxArray2 <= 0
	Continua := .T.
EndIf
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630FLINOK³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se a linha digitada esta' Ok na GetDados Secundaria³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado. 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MatA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630FLINOK(o)
Local nx,lRet := .T.

For nx = 1 To Len(aHeader)
	If Empty(aCols[n][nx])
		If Trim(aHeader[nx][2]) == "H3_FERRAM" .And. n == Len(aCols)
			Exit
		EndIf
		If Trim(aHeader[nx][2]) == "H3_FERRAM"
			Help(" ",1,"A631ALTVZ")
			lRet := .F.
			Exit
		EndIf
	EndIf
Next nx
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630FTUDOK³ Autor ³ Rodrigo de A. Sartorio³ Data ³28/09/95  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Critica se toda a opera‡„o esta' Ok na GetDados Secundaria ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Objeto a ser verificado. 						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630FTUDOK(o)
Local   nx ,lRet := .T., nMaxArray2
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ verifica se o ultimo elemento do array esta em branco	     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
nMaxArray2:= Len(aCols)
For nx = 1 to Len(aHeader)
	If Empty(aCols[nMaxArray2][nx])
		If Trim(aHeader[nx][2]) == "H3_FERRAM"
			nMaxArray2--
			Exit
		EndIf
	EndIf
Next nx

If nMaxArray2 <= 0
	Continua := .T.
EndIf
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630VldCpo³ Autor ³ Erike Yuri da Silva   ³ Data ³05/09/2006³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Valida os campos do getdados                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ NENHUM                              						  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630VldCpo()
Local lRet 		:= .T.
Local nOpc		:= If(Inclui,3,If(Altera,4,0))
Local nCount	:= 0
Local aArea		:= {}
Local aSH1 		:= {}
Local nX 		:= 0

If TipoAps(.F.,"DRUMMER")
	If ReadVar()=="M->HJ_RECURSO"
		If Empty(aScan(aCols,{|x| AllTrim( x[1] )== AllTrim( M->HJ_RECURSO ) }))
			aArea	:= GetArea()
			aSH1	:= GetArea("SH1")
			DbSelectArea("SH1")
			DbSetOrder(1)
			If MsSeek(xFilial("SH1")+M->HJ_RECURSO)
				If SH1->H1_CTRAB <> M->G2_CTRAB
					Aviso(STR0012,STR0039,{"Ok"})	// ### "Recurso invalido para este centro de trabalho"
					lRet := .F.
				Else
					aCols[n][2]		:= SH1->H1_DESCRI
				EndIf
			Else
				Help(" ", 1, "REGNOIS")
				lRet := .F.
			EndIf
			RestArea(aSH1)
			RestArea(aArea)
		Else
			Help(" ",1,"MA610JAEXI")
			lRet:=.F.
		EndIf
	ElseIf ReadVar() =="M->G2_CTRAB" .And. !Empty(nOpc) .And. !Empty( M->G2_CTRAB )
		aArea	:= GetArea()
		
		SG2->(dbSetOrder(1))
		SG2->(dbSeek(xFilial("SG2")+c630Prod+c630Cod+GDFieldGet("G2_OPERAC")))
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Caso tenha alterado o centro de trabalho remove do  aCols|
		//|recursos pertencentes ao centro de trabalho antigo		³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If Len(aColsRecCT) >= n
			For nX := 1 To Len(aColsRecCT[n])
				If Posicione("SH1",1,xFilial("SH1")+aColsRecCT[n,nX,1],"H1_CTRAB") # M->G2_CTRAB
					aDel(aColsRecCT[n],nX)
					aSize(aColsRecCt[n],Len(aColsRecCt[n])-1)
				EndIf
			Next nX
		EndIf
		If nOpc == 4 .And. M->G2_CTRAB == SG2->G2_CTRAB .And. Len(aColsRecCt[n]) < Len(aRecBkp[n])
			aColsRecCt[n] := aClone(aRecBkp[n])
		EndIf
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Verifica se existe array dos recursos restritivos do CT. Se ³
		//³existir valida se tem conteudo                              ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If !Empty(aColsRecCT) .And. Len(aColsRecCT) >= n
			aEval(aColsRecCT[n], {|x| If(!(Empty(x[1]) .Or. Atail(x)), nCount++,)})
		Else
			nCount := -1
		EndIf

		DbSelectArea("SHJ")
		While !( nCount > 0 .Or. If(Len(aColsRecCT)>=n,Len(aColsRecCt[n])>0,.F.))
			If !A630F4(nOpc) .And. 	( Aviso(STR0012,STR0040,{"&"+STR0041,"&"+STR0042}) ) == 2 // ### "Nao existe nenhum recurso restrivo cadastrado para este centro de trabalho. Deseja continuar cadastrando?"  ### "Sim"  ### "Nao"						
				M->G2_CTRAB := Space( Len(SG2->G2_CTRAB) )
				Exit
			EndIf
			nCount := 0
			aEval(aColsRecCT[n], {|x| If(!(Empty(x[1]) .Or. Atail(x)), nCount++,)})
		EndDo
		RestArea(aArea)
	EndIf
EndIf
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ A630Grava³ Autor ³ Rodrigo de A. Sartorio³ Data ³28/09/95  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Grava as informacoes das operacoes digitadas               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Grava(cAlias)
Local nx,ny,nZ,nCntItem := 1 ,aAnterior:={},nDelSG2:=0,i:=0,r:=0,t:=0,e:=0,x:=0,cOldAlias
Local nDelSH3:=0,nDelSHJ:=0, uVar
Local cRevi := ""
Local nOperGrp		:= aScan(aHeader,{ |x| AllTrim(x[2]) == "G2_OPERGRP"} )
Local nPosOper		:= aScan(aHeader,{ |x| alltrim(x[2]) == "G2_OPERAC" } )
Local nPosChave 	:= aScan(aHeader,{ |x| AllTrim(x[2]) == "G2_CHAVE"  } )
Local nPosCTrab 	:= aScan(aHeader,{ |x| AllTrim(x[2]) == "G2_CTRAB"  } )
Local cReviQP6		:= " "
Local nPosMemo      := ""	
Local nM            := 0
Local lMA630GRV 	:= (ExistBlock("MA630GRV"))
Local bBlocWhile	:= {}                              
Local nPos			:= 0

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Indica a Integracao com o Inspecao de Processos (SIGAQIP)³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local lQipMat := IntQIP(c630Prod)
Local aDelQQK := {}

dbSelectArea("SG2")
If !INCLUI 
	If Empty(c630RefGrd)
		DbSetOrder(1)
		DbSeek( xFilial("SG2")+ c630Prod + c630Cod )
		bBlocWhile := {|| SG2->(G2_FILIAL+G2_PRODUTO+G2_CODIGO) == xFilial("SG2")+c630Prod+c630Cod }
	Else
		DbSetOrder(7)
		DbSeek( xFilial("SG2")+ c630RefGrd + c630Cod )
		bBlocWhile := {|| SG2->(G2_FILIAL+G2_REFGRD+G2_CODIGO) == xFilial("SG2")+c630RefGrd+c630Cod }
	EndIf

	While !Eof() .And. Eval(bBlocWhile)
		Aadd(aAnterior,RecNo())
		dbSkip()
	EndDo
EndIf
                        
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Apaga registros dos recursos restritivos				 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
A630DelSHJ(c630Prod,c630Cod)

dbSelectArea("SH3")
dbSetOrder(1)
If Empty(c630RefGrd)
	If dbSeek(xFilial("SH3")+c630Prod+c630Cod)
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Apaga registros da operacao corrente					 ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		While !Eof() .And. (H3_FILIAL == xFilial("SH3") ;
			.And. H3_PRODUTO == c630Prod ;
			.And. H3_CODIGO  == c630Cod)
			RecLock("SH3",.F.,.T.)
			dbDelete()
			nDelSH3++
			dbSkip()
		End
	EndIf
Else
	If dbSeek(xFilial("SH3")+Trim(c630RefGrd),.T.)
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Apaga registros da operacao corrente					 ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		While SH3->( !Eof() .And. H3_FILIAL == xFilial("SH3") .And. Trim(c630RefGrd) $ H3_PRODUTO	)
			If ( H3_CODIGO == c630Cod )
				RecLock("SH3",.F.,.T.)
				dbDelete()
				nDelSH3++
			EndIf
			SH3->( dbSkip() )
		End
	EndIf
EndIf

For nx = 1 to nMaxArray
	dbSelectArea(cAlias)
	If Len(aAnterior) >= nx
		Go aAnterior[nx]
		RecLock(cAlias,.F.)
	Else
		// Verifica se tem marcacao para apagar
		If !aCols[nx][Len(aCols[nx])]
			RecLock(cAlias,.T.)
		EndIf
	EndIf

	// Verifica se tem marcacao para apagar
	If aCols[nx][Len(aCols[nx])]
		If Altera .And. Len(aAnterior) >= nx
			SGR->(dbSetOrder(1))
			SGR->(dbSeek(xFilial("SGR")+c630Prod+c630Cod+aCols[nx][nPosOper]))
			While !SGR->(EOF()) .And. SGR->(GR_FILIAL+GR_PRODUTO+GR_ROTEIRO+GR_OPERAC) == xFilial("SGR")+c630Prod+c630Cod+aCols[nx][nPosOper]
				RecLock("SGR",.F.)
				SGR->(dbDelete())
				SGR->(MsUnLock())		
				SGR->(dbSkip())
			End

			AADD(aDelQQK, {c630Cod, aCols[nx][nPosOper]})
			dbDelete()
			nDelSG2++

			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Exclui campos Memos Virtuais da tabela SYP vinculado aos memos SG2³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If Type("aMemos") == "A"
				For nM := 1 to Len(aMemos)
					nPosMemo := aScan(aHeader,{|x| AllTrim(x[2])== aMemos[nM][2] })	
					If nPOSMemo <> 0 .And. !Empty(aCols[nX][nPosMemo])
						MSMM(aMemos[nM][1],,,,2)
					EndIf
				Next nM
			EndIf

		Else
			Loop
		EndIf
	Else
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Atualiza dados padroes do arquivo de operacoes 			 ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		SG2->G2_FILIAL  := xFilial("SG2")
		SG2->G2_CODIGO  := c630Cod
		If Empty(c630RefGrd)
			SG2->G2_PRODUTO	:= c630Prod
		Else
			SG2->G2_REFGRD	:= c630RefGrd
		EndIf
		
		If SuperGetMV("MV_UNILIN",.F.,.F.)
			SG2->G2_LINHAPR := c630Linhapr
			SG2->G2_TPLINHA := C630TipLin
		EndIf

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Atualiza dados selecionados pelo cliente                 ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		For ny = 1 to Len(aHeader)
			uVar := Trim(aHeader[ny][2])
			If aHeader[ny][10] # "V"
				Replace &uVar. With aCols[nx][ny]
			Endif
		Next ny

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Se for alteração irá pesquisar os registros, deletar, incluir ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ		
		/*If ExistBlock( "MA630MEM" )
			dbSelectArea("SYP")
			dbSeek(xFilial("SYP")+SG2->G2_MUS)
				If found()
					While SYP->YP_CHAVE==SG2->G2_MUS
						Reclock("SYP",.F.)
						dbDelete()
						MsUnlock()
						dbSkip()
					Enddo
				Endif
		EndIf*/
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³Grava os campos Memos Virtuais					 				  ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		If Type("aMemos") == "A"
			For nM := 1 to Len(aMemos)
				nPosMemo := aScan(aHeader,{|x| AllTrim(x[2])== aMemos[nM][2] })	
				If nPOSMemo <> 0 .And. !Empty(aCols[nX][nPosMemo])
					MSMM(,TamSx3(aMemos[nM][1])[1],,aCols[nX][nPosMemo],1,,,"SG2",aMemos[nM][1])
				EndIf
			Next nM
		EndIf
		MsUnLock()
		           
		//-- Grava checklist operacoes
		nPos := aScan(aItensChk,{|x| x[1] == aCols[nx,nPosOper]})
		If !Empty(nPos)
			SGR->(dbSetOrder(1))			
			For nY := 1 To Len(aItensChk[nPos,2])
		 		SGR->(dbSeek(xFilial("SGR")+c630Prod+c630Cod+aCols[nx,nPosOper]+aItensChk[nPos,2,nY,SGR->(FieldPos("GR_ITCHK"))]))
		 		If SGR->(Found()) .Or. !aTail(aItensChk[nPos,2,nY])
					RecLock("SGR",!SGR->(Found()))
					If !aTail(aItensChk[nPos,2,nY])
						SGR->GR_FILIAL	:= xFilial("SGR")
						SGR->GR_PRODUTO	:= c630Prod
						SGR->GR_ROTEIRO	:= c630Cod
						SGR->GR_OPERAC	:= aCols[nX,nPosOper]
						For nZ := 1 To SGR->(FCount())
							If aItensChk[nPos,2,nY,nZ] # NIL
								SGR->(FieldPut(nZ,aItensChk[nPos,2,nY,nZ]))
							EndIf
						Next nZ
					Else
						SGR->(dbDelete())
					EndIf
					SGR->(MsUnLock())
				EndIf
			Next nY
		EndIf
	EndIf

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Ponto de Entrada apos gravacao/exclusao (SG2)            ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If lMA630GRV
		ExecBlock("MA630GRV",.F.,.F.,{nx})
	EndIf

	If Len(aColsRec) >= nx
		If !Empty(aColsRec[nx])
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Monta aHeadRec caso este nao exista.                      ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If Empty(aHeadRec)
				dbSelectArea("SX3")
				dbSetOrder(1)
				If dbSeek("SH3")
					While !Eof() .And. (x3_arquivo == "SH3")
						If X3USO(x3_usado) .And. cNivel >= x3_nivel	.And. ;
							( Trim(x3_campo) == "H3_RECALTE" .Or. Trim(x3_campo) == "H3_DESC" .Or. ;
							Trim(x3_campo) == "H3_TIPO" .Or. Trim(x3_campo) == "H3_EFICIEN" )
							Aadd(aHeadRec,{ Trim(X3Titulo()), x3_campo, x3_picture,;
							x3_tamanho, x3_decimal, x3_valid,;
							x3_usado, x3_tipo, x3_arquivo, x3_context } )
						EndIf
						dbSkip()
					EndDo
					ADHeadRec("SH3",aHeadRec)
				EndIf
			EndIf

			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Localiza campos de Recurso Alternativo, Tipo e Eficiencia.³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			For x:= 1 To Len(aHeadRec)
				If Trim(aHeadRec[x][2]) == "H3_RECALTE"
					r:=x
				ElseIf Trim(aHeadRec[x][2]) == "H3_TIPO"
					t:=x
				ElseIf Trim(aHeadRec[x][2]) == "H3_EFICIEN"
					e:=x
				EndIf
			Next x

			dbSelectArea("SH3")
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Atualiza SH3 com os recursos alternativos de F4 (aColsRec)³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			For i := 1 To Len(aColsRec[nx])
				If !Empty(aColsRec[nx,i])
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Verifica se o Codigo do Recurso Alternativo e' Valido.  ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If r > 0 .And. !(aColsRec[nx,i,r] == Space(Len(H3_RECALTE))) .And. !aColsRec[nx,i,Len(aHeadRec)+1]
						RecLock("SH3",.T.)
						Replace H3_FILIAL With xFilial("SH3"),;
							H3_PRODUTO	With c630Prod,;
							H3_CODIGO	With c630Cod,;
							H3_OPERAC	With SG2->G2_OPERAC,;
							H3_RECPRIN	With SG2->G2_RECURSO,;
							H3_RECALTE	With aColsRec[nx][i][r],;
							H3_TIPO		With If(t > 0,aColsRec[nx][i][t],CriaVar("H3_TIPO")),;
							H3_EFICIEN	With If(e > 0,aColsRec[nx][i][e],CriaVar("H3_EFICIEN"))
					EndIf
				EndIf
			Next i
		Endif
	EndIf
	If Len(aColsFer) >= nx
		If !Empty(aColsFer[nx])
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Monta aHeadFer caso este nao exista.					  ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If Empty(aHeadFer)
				dbSelectArea("SX3")
				dbSetOrder(1)
				If dbSeek("SH3")
					While !Eof() .And. (x3_arquivo == "SH3")
						If X3USO(x3_usado) .And. cNivel >= x3_nivel	.And. ;
							( Trim(x3_campo) == "H3_FERRAM" .Or. Trim(x3_campo) == "H3_DESCFER" )
							Aadd(aHeadFer,{ Trim(X3Titulo()), x3_campo, x3_picture,;
							x3_tamanho, x3_decimal, x3_valid,;
							x3_usado, x3_tipo, x3_arquivo, x3_context } )
						EndIf
						dbSkip()
					EndDo
					ADHeadRec("SH3",aHeadFer)
				EndIf
			EndIf

			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Localiza campo de Ferramenta 							  ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			r:=0
			For x:= 1 To Len(aHeadFer)
				If Trim(aHeadFer[x][2]) == "H3_FERRAM"
					r:=x
					Exit
				EndIf
			Next x

			dbSelectArea("SH3")
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Atualiza SH3 com os recursos alternativos de F4 (aColsFer)³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			For i := 1 To Len(aColsFer[nx])
				If !Empty(aColsFer[nx,i])
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Verifica se o Codigo do Recurso Alternativo e' Valido.  ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If r > 0 .And. !(aColsFer[nx,i,r] == Space(Len(H3_FERRAM))) .And. !aColsFer[nx,i,Len(aHeadFer)+1]
						RecLock("SH3",.T.)
						Replace H3_FILIAL With xFilial("SH3"),;
							H3_PRODUTO	With c630Prod,;
							H3_CODIGO	With c630Cod,;
							H3_OPERAC	With SG2->G2_OPERAC,;
							H3_TIPO		With "F",;
							H3_FERRAM	With aColsFer[nx][i][r]
					EndIf
				EndIf
			Next i
		Endif
	EndIf

	If TipoAps(.F.,"DRUMMER") .And. Len(aColsRecCT) >= nx .And. !Atail(aCols[nX])
		If !Empty(aColsRecCT[nx])
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Monta aHeadRecCT caso este nao exista.                    ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			If Empty(aHeadRecCT)
				dbSelectArea("SX3")
				dbSetOrder(1)
				If dbSeek("SHJ")
					While !Eof() .And. (x3_arquivo == "SHJ")
						If X3USO(x3_usado) .And. cNivel >= x3_nivel
							Aadd(aHeadRecCT,{ Trim(X3Titulo()), x3_campo, x3_picture,;
							x3_tamanho, x3_decimal, x3_valid,;
							x3_usado, x3_tipo, x3_arquivo, x3_context } )
						EndIf
						dbSkip()
					EndDo
					ADHeadRec("SHJ",aHeadRecCT)
				EndIf
			EndIf

			dbSelectArea("SHJ")
			dbSetOrder(1)
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Atualiza SHJ com os recursos restritivos de F4 (aColsRecCT)³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			For i := 1 To Len(aColsRecCT[nx])
				If !Empty(aColsRecCT[nx,i])
					//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
					//³ Verifica se o Codigo do Recurso e' Valido               ³
					//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
					If !Empty(aColsRecCT[nx,i,1]) .And. !aColsRecCT[nx,i,Len(aHeadRecCT)+1]
						RecLock("SHJ",.T.)
						SHJ->HJ_FILIAL	:= xFilial("SHJ")
						SHJ->HJ_ROTEIRO	:= c630Cod
						SHJ->HJ_PRODUTO	:= c630Prod
						SHJ->HJ_OPERAC	:= SG2->G2_OPERAC
						SHJ->HJ_CTRAB  	:= SG2->G2_CTRAB
						For nY := 1 To Len(aHeadRecCT)-2
							If aHeadRecCT[nY,10] # "V"
								SHJ->&(aHeadRecCT[nY,2]) := aColsRecCT[nX,i,nY]
							EndIf
						Next nY
						SHJ->( MsUnLock() )
					EndIf
				EndIf
			Next i
		Endif
	EndIf

Next nx

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Integracao PCP x QIP									 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If lQipMat .And. (Inclui .Or. Altera)
	QAtuMatQIP(c630Prod,Nil,c630Cod,"PCP",Nil,"1",Nil,aDelQQK)	
EndIf                 

Return .T.

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o    ³A630Tempo() ³ Autor ³ Waldemiro Lustosa   ³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Valida‡„o dos Campos de tempo.                             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³ MATA690                                                    ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Tempo()
Local nX
Local cTipo := GetMV("MV_TPHR")
Local nPrecisao := GetMV("MV_PRECISA")
Local nDec,nPosTpOper,nPosTemPad,nPosSetup,nPosTempEnd
Local lValid := .F.
Default nVal := 0
Default cCampo := ''

If !__lAutomacao //não são criados na automação
nVal := &(ReadVar())
cCampo := ReadVar()
EndIf

nDec := ( nVal - Int( nVal ) ) * 100
nPrecisao := 60 / nPrecisao

If cCampo == "M->G2_TEMPSOB"
	lValid := GDFieldGet("G2_TPSOBRE") == "3"
ElseIf cCampo == "M->G2_TEMPDES"
	lValid := GDFieldGet("G2_TPDESD") == "2"
ElseIf cCampo == "M->G2_TEMPAD" .Or. cCampo == "M->G2_SETUP" .Or. cCampo == "M->G2_TEMPEND"
	lValid := .T.
Endif

If nDec >= 60 .And. cTipo == "N" .And. lValid
	Help(" ",1,"NAOMINUTO")
	Return .F.
EndIf

For nx = 1 To Len(aHeader)
	If Trim(aHeader[nx][2]) == "G2_TPOPER"
		nPosTpOper:=nx
	ElseIf Trim(aHeader[nx][2]) == "G2_TEMPAD"
		nPosTemPad:=nx
	ElseIf Trim(aHeader[nx][2]) == "G2_SETUP"
		nPosSetUp:=nx
	ElseIf Trim(aHeader[nx][2]) == "G2_TEMPEND"
		nPosTempEnd:=nx
	EndIf
Next nx


If cCampo $ "M->G2_TEMPAD/M->G2_SETUP/M->G2_TEMPEND"
	If cTipo == "N"
		If nVal < 1
			If cCampo == "M->G2_TEMPAD"
				nDec += (aCols[n,nPosSetUp] - Int(aCols[n,nPosSetUp])) * 100
			ElseIf cCampo == "M->G2_SETUP"
				nDec += (aCols[n,nPosTemPad] - Int(aCols[n,nPosTemPad])) * 100
			ElseIf cCampo == "M->G2_TEMPEND"
				nDec += (aCols[n,nPosTempEnd] - Int(aCols[n,nPosTempEnd])) * 100
			EndIf
			If NoRound(nDec,2) < NoRound(nPrecisao,2)
				Help(" ",1,"MENORPREC")
				If cCampo == "M->G2_TEMPAD"
					aCols[n,nPosTemPad]:=nVal
				ElseIf cCampo == "M->G2_SETUP"
					aCols[n,nPosSetUp]:=nVal
				ElseIf cCampo == "M->G2_TEMPEND"
					aCols[n,nPosTempEnd]:=nVal
				EndIf
				If (aCols[n][nPosTpOper]) == "2" .Or. (aCols[n][nPosTpOper]) == "3"
					Return .F.
				EndIf
			EndIf
		EndIf
	ElseIf cTipo == "C"
		If nVal < 1
			nDec := ( nVal - Int( nVal ) ) * 60
			If cCampo == "M->G2_TEMPAD"
				nDec += (aCols[n,nPosSetUp] - Int(aCols[n,nPosSetUp])) * 60
			ElseIf cCampo == "M->G2_SETUP"
				nDec += (aCols[n,nPosTemPad] - Int(aCols[n,nPosTemPad])) * 60
			ElseIf cCampo == "M->G2_TEMPEND"
				nDec += (aCols[n,nPosTempEnd] - Int(aCols[n,nPosTempEnd])) * 60
			EndIf
			If NoRound(nDec,2) < NoRound(nPrecisao,2)
				Help(" ",1,"MENORPREC")
				If cCampo == "M->G2_TEMPAD"
					aCols[n,nPosTemPad]:=nVal
				ElseIf cCampo == "M->G2_SETUP"
					aCols[n,nPosSetUp]:=nVal
				ElseIf cCampo == "M->G2_TEMPEND"
					aCols[n,nPosTempEnd]:=nVal
				EndIf
				If (aCols[n][nPosTpOper]) == "2" .Or. (aCols[n][nPosTpOper]) == "3"
					Return .F.
				EndIf
			EndIf
		EndIf
	EndIf
EndIf
Return .T.


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³A630TpLin() ³ Autor ³ Waldemiro Lustosa   ³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Valida‡„o do Campo G2_TPLINHA.							  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA690													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630TpLin()
Local lRet := .T.
Local nX

Local cLinha
Default cTipo := ''

If !__lAutomacao
cTipo := &(ReadVar())
EndIf

If cTipo == "D"

	If n # 1
		For nX=1 to Len(aHeader)
			If Trim(aHeader[nX][2]) == "G2_LINHAPR"
				cLinha := aCols[n-1][nX]
				Exit
			EndIf
		Next nX
	EndIf

	If Empty(cLinha)
		Help(" ",1,"A630TPLIND")
		lRet := .F.
	Else
		aCols[n][nX]:=cLinha
	EndIf

ElseIf cTipo $ "OP"

	For nX=1 to Len(aHeader)
		If Trim(aHeader[nX][2]) == "G2_LINHAPR"
			cLinha := aCols[n][nX]
			Exit
		EndIf
	Next nX

	If Empty(cLinha)
		Help(" ",1,"A630TPLINO")
		lRet := .F.
	EndIf

EndIf

Return lRet
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³A630Cod	³ Autor ³ Waldemiro L. Lustosa  ³ Data ³ 12/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Validacao de Get. 										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Cod(oGet)
Local cConteudo := &(ReadVar()), cAlias := Alias()
Local lRet      := .T.
Local nPosOpe	:= ""
Local nPosSeq	:= ""
Local nPosLau	:= ""

If Empty(cConteudo)
	Help(" ",1,"C630COD")
	lRet := .F.
Else
	If !Empty(c630Prod)
		dbSelectArea("SG2")
		dbSeek(xFilial("SG2")+c630Prod+cConteudo)
		If Found()
			Help(" ",1,"A630ROTJAE")
			lRet := .F.
		EndIf
	EndIf
EndIf

dbSelectArea(cAlias)
Return lRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³A630Prod	³ Autor ³ Waldemiro L. Lustosa  ³ Data ³ 12/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Validacao de Get. 										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpC1 = Descricao do Produto que retornara como referencia ³±±
±±³          ³ ExpC2 = Codigo da referencia de grade que retornara por    ³±±
±±³          ³         referencia.                                        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Prod(cDescProd,c630RefGrd)
Local cAlias := Alias()
Local cRefGrd	:= ""
Local lRefGrd	:= .F.
Local lRet		:= .T. 
Local lVldProd  := .T. 
Local cVldGr	:= ""
DEFAULT c630RefGrd := Space(Len(SG2->G2_REFGRD))
Default cDescProd := ''

If Empty(c630Prod)
	Help(" ",1,"C630PROD")
	lRet := .F.
Else
	If !Empty(c630Prod) .And. A093IsGrade(c630Prod) .And. AllTrim(c630Prod) == AllTrim(A093VldBase(c630Prod)) .And.;
					Aviso(STR0045,STR0046,{STR0047,STR0048}) == 1 //O código digitado é referência de uma família de produtos. Deseja cadastrar para qual entidade?
		cRefGrd	:= A093VldBase(c630Prod)
		lRefGrd := .T.
		dbSelectArea("SG2")
		dbSetOrder(7)
		c630RefGrd := PadR(cRefGrd,Len(SG2->G2_REFGRD))
		If dbSeek(xFilial("SG2")+c630RefGrd+c630Cod)
			Help(" ",1,"A630CODJAE")
			lRet := .F.
		EndIf
	ElseIf !Empty(c630Prod)
		If AllTrim(c630Prod) == AllTrim(A093VldBase(c630Prod))
			If A093IsGrade(c630Prod) .Or. Aviso(STR0045,STR0046,{STR0047,STR0048}) == 2 //O código digitado é referência de uma família de produtos. Deseja cadastrar para qual entidade?
				A093Prod()
			Else
				c630RefGrd := PadR(A093VldBase(c630Prod),Len(SG2->G2_REFGRD))
				lRefGrd := .T.
				lVldProd := .F.
				MatOrigGrd("SBQ")
			EndIf
		EndIf
		cRefGrd	:= c630Prod
		cVldGr := c630Prod
		If !IntQIP(c630Prod) .And. MatGrdPrrf(@cRefGrd,.T.) .And. ;
			Len(AllTrim(cRefGrd))==Len(AllTrim(c630Prod)) .And. AllTrim(cRefGrd) == AllTrim(c630Prod) .And.;
			If(A093IsGrade(@cVldGr,.T.),AllTrim(c630Prod) == cVldGr,.T.)
			lRefGrd := .T.
			dbSelectArea("SG2")
			dbSetOrder(7)
			c630RefGrd := PadR(cRefGrd,Len(SG2->G2_REFGRD))
			If dbSeek(xFilial("SG2")+c630RefGrd+c630Cod)
				Help(" ",1,"A630CODJAE")
				lRet := .F.
			EndIf
		ElseIf !lRefGrd
			dbSelectArea("SB1")
			If dbSeek(xFilial("SB1")+c630Prod)
				dbSelectArea("SG2")
				dbSetOrder(1)
				dbSeek(xFilial("SG2")+c630Prod+c630Cod)
				If Found()
					Help(" ",1,"A630CODJAE")
					lRet := .F.
				EndIf
			Else
				Help(" ",1,"CODNEXIST")
				lRet := .F.
			EndIf
		EndIf
	EndIf
EndIf

If lRet
	If lRefGrd
		cDescProd	:= MaGetDescGrd(c630RefGrd)  
	Else
		cDescProd	:= SB1->B1_DESC
		c630RefGrd	:= Space(Len(SG2->G2_REFGRD))
	EndIf
EndIf

dbSelectArea(cAlias)
Return lRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³A630CodAux³ Autor ³ Waldemiro L. Lustosa  ³ Data ³ 12/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Validacao de Get. 										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630CodAux()
Local cConteudo := &(ReadVar()), cAlias := Alias()
Local lRet := .T.

If !Empty(cConteudo)
	If !SG2->(Eof()) .And. xFilial("SG2") == SG2->G2_FILIAL
		c630ProdAu:=SG2->G2_PRODUTO
	EndIf
EndIf
dbSelectArea(cAlias)
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³MA630Tempo³ Autor ³ Eveli Morasco 		³ Data ³ 15/01/93 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se o tempo digitado e' valido em horas            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe	 ³ ExpL1 := MA630Tempo()									  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ ExpL1 = .T. ou .F. devolvido pela funcao	  	  		      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MA630Tempo()
Local lRetorna:=.T.,nX,cCod
Default nVar := 0

If !__lAutomacao
nVar := &(ReadVar())
EndIf
If GetMV("MV_TPHR") == "N"
	nVar := nVar - Int(nVar)
	If nVar > .5999999999
		HELP(" ",1,"NAOMINUTO")
		lRetorna := .F.
	EndIf
EndIf
Return lRetorna

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡„o	 ³A630ProdAux³ Autor ³ Waldemiro L. Lustosa ³ Data ³ 12/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡„o ³ Validacao de Get. 										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpL1: Variavel que indica se o produto informado eh refere-³±±
±±³          ³      ncia de grade, e so deve ser utilizada para retornar  ³±±
±±³          ³      valores por referencia.                               ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ MATA630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630ProdAux(lRefGrd)
Local cCampo	:= ''
Local cConteudo := ''
Local cRefGrd	:= ""
Local cAlias	:= Alias()
Local lRet 		:= .T.

If !__lAutomacao
cCampo	:= ReadVar()
cConteudo := &(ReadVar())
EndIf

lRefGrd := .F.

If !Empty(cConteudo)
	If !Empty(c630CodAux) .And. A093Prod()
		cRefGrd := c630ProdAu 
		SG2->( dbSetOrder(1) )
		If MatGrdPrrf(@cRefGrd,.T.) .And. !SG2->( MsSeek(xFilial("SG2")+cConteudo+c630CodAux) )
			lRefGrd := .T.
			dbSelectArea("SG2")
			dbSetOrder(7)
			cRefGrd := PadR(cRefGrd,Len(G2_REFGRD))
			If !MsSeek(xFilial("SG2")+cRefGrd+c630CodAux)
				Help(" ",1,"A630ROTNAE")
				lRet			:= .F.
				&(ReadVar())	:= Space(15)
			EndIf
		Else
			dbSelectArea("SG2") 
			dbSetOrder(1)
			If !MsSeek(xFilial("SG2")+cConteudo+c630CodAux)
				Help(" ",1,"A630ROTNAE")
				lRet			:= .F.
				&(ReadVar())	:= Space(15)
			EndIf
		EndIf
	Else
		Help(" ",1,"A630ROTNAE")
		lRet			:= .F.
		&(ReadVar())	:= Space(15)
	EndIf
Else
	If !Empty(c630CodAux)
		c630CodAux		:= Space(2)
		&(ReadVar())	:= Space(15)
	EndIf
EndIf
dbSelectArea(cAlias)
Return lRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630IniCpo³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Inicializa campos p/ gravacao de Recursos Alternativos.	  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630IniCpo()
Local cNewCod, cAlias, nx, nNum, nRec, nFer, nTipo

cAlias := Alias()
cNewCod := &(ReadVar())

If Trim(ReadVar()) == "M->H3_RECALTE"
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Pesquisa qual e' o Recurso Principal da GETDADOS principal . ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nx:= 1 To Len(aHeadOld)
		IF Trim(aHeadOld[nx][2]) == "G2_RECURSO"
			nRec:=nx
			Exit
		EndIf
	Next nx

	If aColsOld[nAcolsPrinc][nRec] == cNewcod
		Help(" ",1,"A630RECPR")
		Return .F.
	EndIf

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Pesquisa GETDADOS secundaria em busca do Recurso digitado .  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nx:= 1 To Len(aHeader)
		If Trim(aHeader[nx][2]) == "H3_RECALTE"
			nNum:=nx
		Elseif Trim(aHeader[nx][2]) == "H3_TIPO"
			nTipo:=nx
		EndIf
	Next nx

	For nx:= 1 To Len(aCols)
		If aCols[nx][nNum] == cNewcod
			If aCols[nx][nTipo] == "A" .And. n != nx
				Help(" ",1,"A630JAA")
				Return .F.
			ElseIf aCols[nx][nTipo] == "S" .And. n != nx
				Help(" ",1,"A630JAS")
				Return .F.
			EndIf
			Exit
		EndIf
	Next nx

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Inicializa GETDADOS secundaria com Eficiencia = "100" , tipo ³
	//³ do Recurso como "S" (Secundario) e descri‡„o do Recurso de   ³
	//³ acordo com o Cadastro de Recursos (SH1). 				     ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nx:= 1 To Len(aHeader)
		If Trim(aHeader[nx][2]) == "H3_TIPO"
			aCols[n][nx]:="A"
		Elseif Trim(aHeader[nx][2]) == "H3_EFICIEN"
			aCols[n][nx]:=100
		Endif
	Next nx

	dbSelectArea("SH1")
	dbSetOrder(1)
	dbSeek(xFilial("SH1")+cNewCod)
	If Found()
		For nx:= 1 To Len(aHeader)
			If Trim(aHeader[nx][2]) == "H3_DESC"
				aCols[n][nx]:=Subs(SH1->H1_DESCRI,1,30)
				Exit
			EndIf
		Next nx
	Else
		Help(" ",1,"A640NAOREC",,cNewCod,01,09)
	EndIf

ElseIf Trim(ReadVar()) == "M->H3_FERRAM"
	If Empty(cNewCod)
		Help(" ",1,"H3_FERRAM")
		Return .F.
	EndIf
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Pesquisa qual e' a Ferramenta da GetDados principal.         ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nx:= 1 To Len(aHeadOld)
		If Trim(aHeadOld[nx][2]) == "G2_FERRAM"
			nFer:=Nx
			Exit
		EndIf
	Next nx

	If aColsOld[nAcolsPrinc][nFer] == cNewcod
		Help(" ",1,"A630FERPR")
		Return .F.
	EndIf

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Pesquisa GetDados secundaria em busca do Recurso digitado .  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	For nx:= 1 To Len(aHeader)
		If Trim(aHeader[nx][2]) == "H3_FERRAM"
			nNum:=Nx
			Exit
		EndIf
	Next nx

	For nx:= 1 To Len(aCols)
		If aCols[nx][nNum] == cNewcod
			Help(" ",1,"A630FERJA")
			Return .F.
		EndIf
	Next nx

	// Preenche Descricao da Ferramenta
	dbSelectArea("SH4")
	dbSeek(xFilial("SH4")+cNewCod)
	If Found()
		For nx:= 1 To Len(aHeader)
			If Trim(aHeader[nx][2]) == "H3_DESCFER"
				aCols[n][nx]:=Subs(SH4->H4_DESCRI,1,25)
				Exit
			EndIf
		Next nx
	Else
		Help(" ",1,"A630NAOFER",,cNewCod,01,14)
	EndIf

EndIf

dbSelectArea(cAlias)
Return .T.

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630Recur ³ Autor ³ Rodrigo de A. Sartorio³ Data ³ 28/09/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Valida campo de Recurso j  Cadastrado como Alternativo.	  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
FUNCTION A630Recur()
Local cNewCod,cAlias,nx,nRec,nRec2,lRet:=.T.
cAlias := Alias()
cNewCod := &(ReadVar())

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Pesquisa qual ‚ a Posi‡„o do Rec. Alt. e do tipo na GETDADOS Secund ria.³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
For nx:= 1 To Len(aHeadRec)
	IF Trim(aHeadRec[nx][2]) == "H3_RECALTE"
		nRec:=Nx
	ElseIf Trim(aHeadRec[nx][2]) == "H3_TIPO"
		nRec2:=Nx
	EndIf
Next nx

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se Recurso Principal j  foi cadastrado como Alternativo.³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Len(aColsRec) >= n
	For nx:= 1 To Len(aColsRec[n])
		If aColsRec[n][nx][nRec] == cNewCod
			If aColsRec[n][nx][nRec2] == "A"
				Help(" ",1,"A630JAA")
			ElseIf aColsRec[n][nx][nRec2] == "S"
				Help(" ",1,"A630JAS")
			EndIf
			lRet:=.F.
			Exit
		EndIf
	Next nx
EndIf
Return lRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡Æo	 ³A630Ferram³ Autor ³ Waldemiro L. Lustosa  ³ Data ³ 16/01/96 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡Æo ³ Valida campo de Ferramenta (G2_FERRAM).					  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630Ferram()
Local cNewCod,cAlias,nx,nFer,lRet:=.T.
Local nPosTPA

cAlias := Alias()
cNewCod := &(ReadVar())

If Empty(cNewCod)
	nPosTPA := AsCan(aHeader,{|x| AllTrim(x[2])=="G2_TPALOCF"})
	aCols[n,nPosTPA] := Space(1)
	
	Return lRet
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Pesquisa qual ‚ a Posi‡„o da Ferramenta na GetDados Secund ria.	   	    ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
For nx:= 1 To Len(aHeadFer)
	If Trim(aHeadFer[nx][2]) == "H3_FERRAM"
		nFer:=nx
		Exit
	EndIf
Next nx

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se esta Ferramenta j  foi cadastrada. 				  	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Len(aColsFer) >= n
	For nx:= 1 To Len(aColsFer[n])
		If aColsFer[n][nx][nFer] == cNewCod
			Help(" ",1,"A630FERJA")
			lRet:=.F.
			Exit
		EndIf
	Next nx
EndIf
Return lRet


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡Æo	 ³A630TPAFer³ Autor ³ Erike Yuri da Silva   ³ Data ³ 24/05/05 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡Æo ³ Valida campo que define o tipo de alocacao da ferramenta	  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630TPAFer()
Local cNewCod,cAlias,nx,nFer,lRet:=.T.
Local nPos := AsCan(aHeader,{|x| AllTrim(x[2])=="G2_FERRAM"})

cAlias := Alias()
cNewCod := &(ReadVar())

If Empty(cNewCod)
	Return lRet
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Verifica se a Ferramenta foi informada.      				  	 ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If Empty(aCols[n][nPos])
	If !IsBlind()
		Alert(STR0035)	//"O campo ferramenta nao foi informado"
	EndIf
	lRet := .F.
EndIf
Return lRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡Æo	 ³A630NewaCols³ Autor ³ Waldemiro L. Lustosa³ Data ³ 16/01/96 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡Æo ³ Atualiza os Arrays aColsFer, aColsRec e aColsRecCT 		  ³±±
±±³			 ³(Respectivamente) 										  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso		 ³ Mata630													  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßFßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630NewaCols()
Local i, aColsRTmp, aColsFTmp, nCntRec, nCntFer, nCntRecCT, nRegSX3, nPosOperac,;
			c630PrdOld,c630CodOld
Local nPosCTrab
Local nX := 0

Aadd(aColsRec,{})
If Len(aColsRec) < Len(aCols)
	For i:= (Len(aColsRec)+1) to Len(aCols)
		Aadd(aColsRec,{})
	Next i
EndIf
Aadd(aColsFer,{})
If Len(aColsFer) < Len(aCols)
	For i:= (Len(aColsFer)+1) to Len(aCols)
		Aadd(aColsFer,{})
	Next i
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Utilizado na integracao APS Drummer  ³
//³para informar os recursos restritivos³
//³por centro de trabalho               ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If TipoAps(.F.,"DRUMMER")
	Aadd(aColsRecCT,{})
	If Len(aColsRecCT) < Len(aCols)
		For i:= (Len(aColsRecCT)+1) to Len(aCols)
			Aadd(aColsRecCT,{})
		Next i
	EndIf
EndIf

nPosOperac 	:= AsCan(aHeader,{|x| AllTrim(x[2])=="G2_OPERAC"})	
nPosCTrab	:= AsCan(aHeader,{|x| AllTrim(x[2])=="G2_CTRAB" })

If lPadrao
	c630PrdOld:=c630Prod
	c630CodOld:=c630Cod
	c630Prod:=c630ProdAu
	c630Cod:=c630CodAux
EndIf

For i:=1 to Len(aCols)
	dbSelectArea("SH3")
    dbSetOrder(1)
	If dbSeek(xFilial("SH3")+c630Prod+c630Cod+aCols[i][nPosOperac])
		aColsRTmp:={}
		aColsFTmp:={}
		nRegSX3 := 0
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Carrega aColsRec e aColsFer com dados do SH3		  	     ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		nCntRec := 0
		nCntFer := 0
		While !Eof() .And. xFilial("SH3")+c630Prod+c630Cod+aCols[i][nPosOperac] == H3_FILIAL+H3_PRODUTO+H3_CODIGO+H3_OPERAC
			dbSelectArea("SX3")
			If nRegSX3 == 0
				dbSetOrder(1)
				dbSeek("SH3")
				nRegSX3 := Recno()
			Else
				dbGoto(nRegSX3)
			EndIf
			If !Empty(SH3->H3_RECPRIN) .And. !Empty(SH3->H3_RECALTE) .And. Empty(SH3->H3_FERRAM)
				Aadd(aColsRTmp,{})
				nCntRec++
				While !Eof() .And. (x3_arquivo == "SH3")
					If X3USO(x3_usado) .And. cNivel >= x3_nivel
						If x3_context # "V" .And. ( Trim(X3_CAMPO) == "H3_RECALTE" .Or.;
						Trim(X3_CAMPO) == "H3_TIPO" .Or. Trim(X3_CAMPO) == "H3_EFICIEN" )
							Aadd(aColsRTmp[nCntRec],SH3->&(SX3->X3_CAMPO))
						ElseIf x3_context == "V" .And. Trim(X3_CAMPO) == "H3_DESC"
							dbSelectArea("SH1")
							dbSeek(xFilial("SH1")+SH3->H3_RECALTE)
							If Found()
								Aadd(aColsRTmp[nCntRec],Subs(SH1->H1_DESCRI,1,30))
							Else
								Help(" ",1,"A640NAOREC",,SH3->H3_RECALTE,01,09)
							EndIf
							dbSelectArea("SX3")
						Endif
					Endif
					dbSkip()
				EndDo
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Walk-Thru						                              ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				AADD(aColsRTmp[nCntRec],"SH3")
				AADD(aColsRTmp[nCntRec],SH3->(RecNo()))

				AADD(aColsRTmp[nCntRec],.F.)
				aColsRec[i]:=aClone(aColsRTmp)
			ElseIf Empty(SH3->H3_RECPRIN) .And. Empty(SH3->H3_RECALTE) .And. !Empty(SH3->H3_FERRAM)
				Aadd(aColsFTmp,{})
				nCntFer++
				While !Eof() .And. (x3_arquivo == "SH3")
					If X3USO(x3_usado) .And. cNivel >= x3_nivel
						If x3_context # "V" .And. Trim(X3_CAMPO) == "H3_FERRAM"
							Aadd(aColsFTmp[nCntFer],SH3->&(SX3->X3_CAMPO))
						ElseIf x3_context == "V" .And. Trim(X3_CAMPO) == "H3_DESCFER"
							dbSelectArea("SH4")
							dbSeek(xFilial("SH4")+SH3->H3_FERRAM)
							If Found()
								Aadd(aColsFTmp[nCntFer],Subs(SH4->H4_DESCRI,1,25))
							Else
								Help(" ",1,"A630NAOFER",,SH3->H3_FERRAM,01,14)
							EndIf
							dbSelectArea("SX3")
						Endif
					Endif
					dbSkip()
				EndDo
				//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
				//³ Walk-Thru						                              ³
				//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
				AADD(aColsFTmp[nCntFer],"SH3")
				AADD(aColsFTmp[nCntFer],SH3->(RecNo()))

				Aadd(aColsFTmp[nCntFer],.F.)
				aColsFer[i]:=aClone(aColsFTmp)
			EndIf
			dbSelectArea("SH3")
			dbSkip()
		End
	EndIf

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Utilizado na integracao APS Drummer  ³
	//³para informar os recursos restritivos³
	//³por centro de trabalho               ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If TipoAps(.F.,"DRUMMER")
		If Len(aHeadRecCT) == 0
			dbSelectArea("SX3")
			dbSetOrder(1)
			If dbSeek("SHJ")
				While !Eof() .And. (x3_arquivo == "SHJ")
					If X3USO(x3_usado) .And. cNivel >= x3_nivel	
						Aadd(aHeadRecCT,{ Trim(X3Titulo()), x3_campo, x3_picture,;
						x3_tamanho, x3_decimal, x3_valid,;
						x3_usado, x3_tipo, x3_arquivo, x3_context } )
					EndIf
					dbSkip()
				EndDo
				ADHeadRec("SHJ",aHeadRecCT)
			EndIf
		Endif

		dbSelectArea("SHJ")
    	dbSetOrder(1)
		If dbSeek(xFilial("SHJ")+c630Cod+c630Prod+aCols[i][nPosOperac]+aCols[i][nPosCTrab])
			aColsRTmp:={}
			//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
			//³ Carrega aColsRecCT  da tabela SHJ	                 	     ³
			//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
			While SHJ->(!Eof() .And. xFilial("SHJ")+c630Cod+c630Prod+aCols[i][nPosOperac]+aCols[i][nPosCTrab] == ;
						HJ_FILIAL+HJ_ROTEIRO+HJ_PRODUTO+HJ_OPERAC+HJ_CTRAB)
				
				aAdd(aColsRTmp,{})
				For nX := 1 To Len(aHeadRecCT)-2
					If aHeadRecCT[nX,2] # "HJ_DESCREC" .And. aHeadRecCT[nX,10] # "V"
						aAdd(aColsRTmp[Len(aColsRTmp)],&(aHeadRecCT[nX,2]))
					ElseIf aHeadRecCT[nX,2] == "HJ_DESCREC"
						aAdd(aColsRTmp[Len(aColsRTmp)],Posicione("SH1",1,xFilial("SH1")+SHJ->HJ_RECURSO,"H1_DESCRI"))
					Else
						aAdd(aColsRTmp[Len(aColsRTmp)],CriaVar(aHeadRecCT[nX,2],.T.))
					EndIf
				Next nX
				aAdd(aColsRTmp[Len(aColsRTmp)],"SHJ")
				aAdd(aColsRTmp[Len(aColsRTmp)],SHJ->(RecNo()))
				aAdd(aColsRTmp[Len(aColsRTmp)],.F.)
				aColsRecCT[i]:=aClone(aColsRTmp)
				SHJ->( dbSkip() )
			End
		EndIf
	EndIf
Next i

If lPadrao
	c630Prod:=c630PrdOld
	c630Cod:=c630CodOld
EndIf

Return NIL

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ A630Apaga³ Autor ³Rodrigo de A. Sartorio ³ Data ³05/03/96 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Executa TTS e apaga regisros. 							 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630Apaga(c630Prod,c630Cod,nSavRec)
Local nDelSG2 := 0, nDelSH3 := 0,cSeek
Local bSeekWhile
//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Indica a Integracao com o Inspecao de Processos (SIGAQIP)³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
Local lQipMat := IntQIP(c630Prod)

Begin Transaction

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Exclusao da Integracao PCP x QIP						 ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If lQipMat
		QAtuMatQIP(c630Prod,,c630Cod,"PCP",.T.)
	EndIf

	dbGoTo(nSavRec)
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Deleta registros da operacao em SG2 				 ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ

	If Empty(c630RefGrd)
		bSeekWhile	:= { || SG2->(G2_FILIAL+G2_PRODUTO+G2_CODIGO) == xFilial("SG2")+c630Prod+c630Cod }
		SG2->( DbSetOrder(1) )
		DbSeek(xFilial("SG2")+c630Prod+c630Cod)
	Else
		bSeekWhile	:= { || SG2->(G2_FILIAL+G2_REFGRD+G2_CODIGO) == xFilial("SG2")+c630RefGrd+c630Cod }
		SG2->( DbSetOrder(7) )
		DbSeek(xFilial("SG2")+c630RefGrd+c630Cod)
	EndIf

	While !Eof() .And. Eval( bSeekWhile )
		dbSelectArea("SH3")
		cSeek:=xFilial("SH3")+SG2->G2_PRODUTO+SG2->G2_CODIGO+SG2->G2_OPERAC
		dbSeek(cSeek)
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Deleta maquinas alternativas da operacao ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		While !Eof() .And. cSeek==H3_FILIAL+H3_PRODUTO+H3_CODIGO+H3_OPERAC
			RecLock("SH3",.F.,.T.)
			dbDelete()
			nDelSH3++
			dbSkip()
		End

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Deleta recursos restritivos da operacao  ³
		//³ quando existir integracao                ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		A630DelSHJ(c630Prod,c630Cod,SG2->G2_OPERAC)

		dbSelectArea("SG2")
		RecLock("SG2",.F.,.T.)
		dbDelete()
		nDelSG2++
		dbSkip()  
		
		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Deleta checklist da operacao 			 ³
		//³ quando estiver cadastrado                ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		SGR->(dbSetOrder(1))
		SGR->(dbSeek(xFilial("SGR")+c630Prod+c630Cod+SG2->G2_OPERAC))       
		While !SGR->(EOF()) .And. SGR->(GR_FILIAL+GR_PRODUTO+GR_ROTEIRO+GR_OPERAC) == xFilial("SGR")+c630Prod+c630Cod+SG2->G2_OPERAC
			RecLock("SGR",.F.)
			SGR->(dbDelete())
			SGR->(MsUnLock())		
			SGR->(dbSkip())
		End	 
	End

End Transaction
Return


/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ A630aCols³ Autor ³ Cristina O. Iabuki    ³ Data ³20/12/95 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Monta ACols quando usa Roteiro Padrao					 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630aCols(c630CodAux,c630ProdAu,lOk,cAlias,oGet,lRefGrd)
Local nCnt := 0, i,nSavRec, cVarTemp, cNewCha, axTextos := {}, cElemento := "QIPA010 ", nRegSX3 := 0
Local nPosRotOp := AsCan(aHeader,{ |x| AllTrim(x[2]) == "G2_OPERAC" } )
Local cProdAux	:= c630CodAux
Local nTamLin   := 0
Local aColsAnt  := {}
Local nRegSX32  := 0
Local bChave
Default lRefGrd := .F.

//-- Verifica se eh referencia de grade 
If lRefGrd
	bChave		:= {|| SG2->(G2_FILIAL+G2_REFGRD+G2_CODIGO)}
	cProdAux	:= PadR(c630ProdAu,Len(SG2->G2_REFGRD))
Else
	bChave		:= {|| SG2->(G2_FILIAL+G2_PRODUTO+G2_CODIGO)}
	cProdAux	:= c630ProdAu
EndIf

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Carrega dados do Roteiro Similar                     ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
SG2->(dbSeek(Eval(bChave)))
If !Empty(c630ProdAu) .And. lOk .And. Eval( bChave ) == xFilial("SG2")+cProdAux+c630CodAux
	aCols := {}
	lPadrao:=.T.
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Carrega aCols com dados de SG2                               ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	dbSelectArea(cAlias)
	nSavRec := Recno()
	nCnt:=0
	While !Eof() .And. Eval(bChave) == xFilial("SG2")+cProdAux+c630CodAux

		aAdd(aCols, Array(Len(aHeader)+1) )

		For nCnt := 1 To Len(aHeader)
			If IsHeadRec(aHeader[nCnt][2])
				aCols[Len(aCols)][nCnt] := (cAlias)->( Recno() )
			ElseIf IsHeadAlias(aHeader[nCnt][2])
				aCols[Len(aCols)][nCnt] := cAlias
			ElseIf aHeader[nCnt,10] == "V"
				aCols[Len(aCols)][nCnt] := CriaVar(AllTrim(aHeader[nCnt, 2]))
			Else
				aCols[Len(aCols)][nCnt] := FieldGet(FieldPos(aHeader[nCnt,2]))
			EndIf
		Next nCnt

		aCols[Len(aCols)][Len(aHeader)+1] := .F.

		dbSelectArea(cAlias)
		dbSkip()
	End
	dbGoTo(nSavRec)

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Monta aColsRec e aColsFer.								  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	A630NewaCols()

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ Monta aHeadRec e aHeadFer.								  ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If Len(aHeadRec) == 0
		dbSelectArea("SX3")
		dbSetOrder(1)
		If dbSeek("SH3")
			While !Eof() .And. (x3_arquivo == "SH3")
				If X3USO(x3_usado).And. cNivel >= x3_nivel  .And. ;
					( Trim(x3_campo) == "H3_RECALTE" .Or. Trim(x3_campo) == "H3_DESC" .Or. ;
					Trim(x3_campo) == "H3_TIPO" .Or. Trim(x3_campo) == "H3_EFICIEN" )
					Aadd(aHeadRec,{ Trim(X3Titulo()), x3_campo, x3_picture,;
					x3_tamanho, x3_decimal, x3_valid,;
					x3_usado, x3_tipo, x3_arquivo, x3_context } )
				ElseIf X3USO(x3_usado) .And. cNivel >= x3_nivel  .And. ;
					( Trim(x3_campo) == "H3_FERRAM" .Or. Trim(x3_campo) == "H3_DESCFER" )
					Aadd(aHeadFer,{ Trim(X3Titulo()), x3_campo, x3_picture,;
					x3_tamanho, x3_decimal, x3_valid,;
					x3_usado, x3_tipo, x3_arquivo, x3_context } )
				EndIf
				dbSkip()
			EndDo
			ADHeadRec("SH3",aHeadRec)	// Walk-Thru
			ADHeadRec("SH3",aHeadFer)
		EndIf
	Endif
	dbSelectArea(cAlias)
	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³ PE executado apos atualizacao do aCols com o roteiro si- ³
	//³ milar.                                                   ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If ExistBlock("MA630RS")
		aColsAnt := ExecBlock( "MA630RS",.F.,.F.,{c630Cod,c630Prod,c630CodAux,c630ProdAu,aHeader,aCols})
		If ValType(aColsAnt)=="A"
			aCols := aClone(aColsAnt)
		EndIf
	EndIf
EndIf
oGet:ForceRefresh()
Return .T.

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630RecOpe   ³ Autor ³Marcelo Iuspa       ³ Data ³ 27/06/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Faz o relacionamento dos recursos com operacoes             ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630RecOpe                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630RecOper(cAlias,nReg,nOpcx)
Local oDlg
Local nOpc    := 0
Local cFiltro := 'H1_CODIGO $ "' + A630RecGru(SG2->G2_GRUPREC) + '"'

SH1->(dbSetFilter({|| &cFiltro}, cFiltro))

aHeader := A610CriaHeader("SGC", "GC_PRODUTO; GC_OPERAC; GC_ROTEIRO",, .T./*lWalkThru*/ )
nUsado  := Len(aHeader)

/*
1  GC_FILIAL+GC_PRODUTO+GC_OPERAC+GC_ROTEIRO+GC_RECURSO
1  G2_FILIAL+G2_PRODUTO+G2_CODIGO+G2_OPERAC
*/

aCriaCols := A610CriaCols("SGC", aHeader, xFilial("SGC") + SG2->(G2_PRODUTO+G2_OPERAC+G2_CODIGO), {|| SGC->(GC_FILIAL+GC_PRODUTO+GC_OPERAC+GC_ROTEIRO) == xFilial("SGC") + SG2->(G2_PRODUTO+G2_OPERAC+G2_CODIGO)})
aCols     := aCriaCols[1]
aRegCol   := aCriaCols[2]

n := 1
DEFINE MSDIALOG oDlg TITLE OemToAnsi(cCadastro) From 9,10 To 20,60 OF oMainWnd
oGet := MSGetDados():New(12,7,56,190,nOpcx,"A630ROLINOK","A630ROTUDOK","",If(nOpcx==2.Or.nOpcx==1,Nil,.T.))
DEFINE SBUTTON FROM 63 ,125 TYPE 1 ACTION (nOpc:=1,If(oGet:TudoOk(),oDlg:End(),nOpc:=0)) ENABLE OF oDlg
DEFINE SBUTTON FROM 63 ,153 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg
ACTIVATE MSDIALOG oDlg
If nOpc == 1
	A610GravaCol(aCols, aHeader, aRegCol, "SGC", {|| SGC->GC_PRODUTO := SG2->G2_PRODUTO, SGC->GC_OPERAC := SG2->G2_OPERAC, SGC->GC_ROTEIRO := SG2->G2_CODIGO})
Endif
SH1->(dbClearFilter())
Return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630ROLINOK  ³ Autor ³Marcelo Iuspa       ³ Data ³ 27/06/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Valida digitacao da linha                                   ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630ROLINOK                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630ROLINOK()
Local nx,lRet := .T.
For nx := 1 To Len(aHeader)
	If !IsHeadAlias(aHeader[nx, 2]) .And. !IsHeadRec(aHeader[nx, 2]) .And. ;
	   Empty(aCols[n][nx]) .And. ! AllTrim(aHeader[nx, 2]) $ "GC_LIBERAR; GC_FIXAR; GC_QUANRES; GC_FERRAM; GC_USOREST; GC_LIMTEM; GC_SETUP"
		lRet := .F.
		Exit
	EndIf
Next nx
Return lRet

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630ROTUDOK  ³ Autor ³Marcelo Iuspa       ³ Data ³ 27/06/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Faz o relacionamento dos recursos com ferramentas           ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630ROTUDOK                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630ROTUDOK()
Return(.T.)


/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630FerOpe  r³ Autor ³Marcelo Iuspa       ³ Data ³ 27/06/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Faz o relacionamento das ferramentas com operacoes          ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630FerOpe                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630FerOpe(cAlias,nReg,nOpcx)
Local oDlg, oGet
Local nOpc   := 0
Local nOldOrd := SG7->(IndexOrd())

SG7->(dbSetOrder(2))
aHeader  := A610CriaHeader("SG7", "G7_RECURSO; G7_PRODUTO; G7_OPERAC; G7_ROTEIRO",, .T./*lWalkThru*/ )
nUsado   := Len(aHeader)
aCriaCols := A610CriaCols("SG7", aHeader, xFilial("SG7")+G2_PRODUTO+G2_CODIGO+G2_OPERAC, {||  G7_FILIAL+G7_PRODUTO+G7_ROTEIRO+G7_OPERAC == xFilial("SG7")+SG2->(G2_PRODUTO+G2_CODIGO+G2_OPERAC)})
aCols     := aCriaCols[1]
aRegReSe  := aCriaCols[2]

n := 1
DEFINE MSDIALOG oDlg TITLE OemToAnsi(cCadastro) From 9,10 To 20,60 OF oMainWnd
oGet := MSGetDados():New(12,7,56,190,nOpcx,"A610RSLINOK","A610RSTUDOK","",If(nOpcx==2.Or.nOpcx==1,Nil,.T.))
DEFINE SBUTTON FROM 63 ,125 TYPE 1 ACTION (nOpc:=1,If(oGet:TudoOk(),oDlg:End(),nOpc:=0)) ENABLE OF oDlg
DEFINE SBUTTON FROM 63 ,153 TYPE 2 ACTION oDlg:End() ENABLE OF oDlg
ACTIVATE MSDIALOG oDlg
If nOpc == 1
	A610GravaCol(aCols, aHeader, aRegReSe, "SG7", {|| SG7->G7_PRODUTO:=SG2->G2_PRODUTO, SG7->G7_ROTEIRO:= SG2->G2_CODIGO, SG7->G7_OPERAC := SG2->G2_OPERAC})
Endif

SG7->(dbSetOrder(nOldOrd))
dbSElectArea("SG2")
Return

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630APS      ³ Autor ³Marcelo Iuspa       ³ Data ³ 27/08/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Valida recurso quando usado PREACTOR                        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630APS                                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630APS()
Local lRet := TipoAps()
If Atail(aCols[n])
	lRet := .T.
ElseIf lRet
	SH1->(dbClearFilter())
	lRet := A630DoGrupo()
Endif
Return(lRet)

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630RecGru   ³ Autor ³Marcelo Iuspa       ³ Data ³ 13/11/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Retorna recursos do grupo informado                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630RecGru                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630RecGru(cGrupo)
Local cSeek := xFilial("SG6") + cGrupo
Local cRecursos := ""
Local aSave := {SG6->(RecNo()), SG6->(IndexOrd()), Alias()}
dbSelectArea("SG6")
dbSetOrder(1)
dbSeek(cSeek)
do While ! Eof() .And. G6_FILIAL + G6_GRUPO == cSeek
	cRecursos += If(Empty(cRecursos), "", "; ") + G6_RECURSO
	dbSkip()
Enddo
dbGoto(aSave[1])
dbSetOrder(aSave[2])
dbSelectArea(aSave[3])
Return(cRecursos)

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630FilRec   ³ Autor ³Marcelo Iuspa       ³ Data ³ 13/11/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Filtra Recursos pelo Grupo                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630FilRec                                                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³OBSERVACAO³A funcao A630FilRec devera ser colocada no X3_WHEN do campo ³±±
±±³          ³G2_RECURSO que fara a filtragem dos recursos                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630FilRec(cGrupo)
Local cRecursos, cFiltro
If TipoAps()
	cGrupo   := If(cGrupo=Nil, A610FieldCol("G2_GRUPREC"), cGrupo)
	cRecursos:= A630RecGru(cGrupo)
	cFiltro  := 'H1_CODIGO $ "' + cRecursos + '"'
	If ! Empty(cGrupo) .And. ! Empty(cRecursos)
		SH1->(dbSetFilter({|| &cFiltro}, cFiltro))
	Endif
Endif
Return(.T.)

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630DoGrupo  ³ Autor ³Marcelo Iuspa       ³ Data ³ 13/11/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Checa se recurso esta no grupo de recursos                  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630DoGrupo                                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A630DoGrupo(lChecaGrupo)
Local cRecurso, cGrupRec
Local lRet := .T.
lChecaGrupo := If(lChecaGrupo == Nil, .F., lChecaGrupo)
If ! TipoAps() .Or. Atail(aCols[n])
	Return(.T.)
Endif
cRecurso := If(ReadVar() == "M->G2_RECURSO", M->G2_RECURSO, A610FieldCol("G2_RECURSO"))
cGrupRec := If(ReadVar() == "M->G2_GRUPREC", M->G2_GRUPREC, a610FieldCol("G2_GRUPREC"))
If lChecaGrupo .And. Empty(cGrupRec)
	Help(" ",1,"OBRIGAT2",,RetTitle("G2_GRUPREC"),04,01)
	Return(.F.)
Endif
If ! Empty(cRecurso) .And. ! Empty(cGrupRec)
	If ! cRecurso $ A630RecGru(cGrupRec)
		Aviso(RetTitle("G2_RECURSO"), STR0030, {"OK"}) //"O Recurso nao faz parte do grupo de recursos selecionado"
		lRet := .F.
	Endif
ElseIf ! Empty(cRecurso) .And. Empty(cGrupRec) .And. ReadVar() == "M->G2_RECURSO"
	lRet := .F.
Endif
Return(lRet)

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A630Ret      ³ Autor ³Marcelo Iuspa       ³ Data ³ 13/12/01 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Avisa usuario sobre retorno do RdMake                       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630Ret(cStr)   cStr: RdMake                                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³ Uso      ³MATA630                                                     ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A630Ret(cRdMake)
Return(Aviso("Erro", STR0031 + Upper(cRdMake) +  STR0032, {STR0033,STR0034})==1) //"O Retorno do RDMake "###" nao foi Logico. Continua ou Aborta a Inclusao ?"###"Continua"###"Aborta"


/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³A630DelSHJ³ Autor ³Erike Yuri da Silva    ³ Data ³05/09/06 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Executa TTS e apaga regisros do SHJ						 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Static Function A630DelSHJ(c630Prod,c630Cod,c630Oper)
LOCAL  cSeek
If SuperGetMV("MV_APS",.F.,"")=="DRUMMER" .And. SX2->( MsSeek("SHJ") )
	Begin Transaction

		//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
		//³ Deleta recursos restritivos da operacao  ³
		//³ quando existir integracao                ³
		//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
		dbSelectArea("SHJ")
		dbSetOrder(1)
		If c630Oper == NIL
			cSeek:=xFilial("SHJ")+c630Cod+c630Prod
			dbSeek(cSeek)
			While !Eof() .And. cSeek==HJ_FILIAL+HJ_ROTEIRO+HJ_PRODUTO
				RecLock("SHJ",.F.,.T.)
				dbDelete()
				dbSkip()
			End
		Else
			cSeek:=xFilial("SHJ")+c630Cod+c630Prod+c630Oper
			dbSeek(cSeek)
			While !Eof() .And. cSeek==HJ_FILIAL+HJ_ROTEIRO+HJ_PRODUTO+HJ_OPERAC
				RecLock("SHJ",.F.,.T.)
				dbDelete()
				dbSkip()
			End
		EndIf
	End Transaction
EndIf
Return

/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Programa  ³MenuDef   ³ Autor ³ Fabio Alves Silva     ³ Data ³08/11/2006³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Utilizacao de menu Funcional                               ³±±
±±³          ³                                                            ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³Array com opcoes da rotina.                                 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³Parametros do array a Rotina:                               ³±±
±±³          ³1. Nome a aparecer no cabecalho                             ³±±
±±³          ³2. Nome da Rotina associada                                 ³±±
±±³          ³3. Reservado                                                ³±±
±±³          ³4. Tipo de Transa‡„o a ser efetuada:                        ³±±
±±³          ³	  1 - Pesquisa e Posiciona em um Banco de Dados     	  ³±±
±±³          ³    2 - Simplesmente Mostra os Campos                       ³±±
±±³          ³    3 - Inclui registros no Bancos de Dados                 ³±±
±±³          ³    4 - Altera o registro corrente                          ³±±
±±³          ³    5 - Remove o registro corrente do Banco de Dados        ³±±
±±³          ³5. Nivel de acesso                                          ³±±
±±³          ³6. Habilita Menu Funcional                                  ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/

Static Function MenuDef()
PRIVATE aRotina	:= {{STR0001,"AxPesqui"  , 0 , 1, 0, .F.},;  //"Pesquisar"
					{STR0002,"A630Visual", 0 , 2, 0, nil},;  //"Visualizar"
					{STR0003,"A630Inclui", 0 , 3, 0, nil},;  //"Incluir"
					{STR0004,"A630Altera", 0 , 4, 0, nil},;  //"Alterar"
					{STR0005,"A630Deleta", 0 , 5, 3, nil}}	 //"Excluir"	

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³ Ponto de entrada utilizado para inserir novas opcoes no array aRotina  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If ExistBlock("MTA630MNU")
	ExecBlock("MTA630MNU",.F.,.F.)
EndIf
Return(aRotina)



/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcao    ³a630SeekSG³ Autor ³Erike Yuri da Silva    ³ Data ³07.04.07  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Pesquisa SG2 procurando 1o o codigo completo do produto, se ³±±
±±³          ³nao encontrar verifica se existe codigo referencia de grade ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpL1: Indicativo de achou alguma ocorrencia                ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpN1: Ordem do de pesquisa                                 ³±±
±±³          ³ExpC2: Codigo do produto que sera analisado se eh ref.grade ³±±
±±³          ³ExpC3: Chave de pesquisa                                    ³±±
±±³          ³ExpC4: Chave de pesquisa que sera convertida para formato   ³±±
±±³          ³       de bloco de codigo, que retornara por referencia e   ³±±
±±³          ³       podera ser utilizado em Lacos do tipo while.         ³±±
±±³          ³ExpL5: Variavel que deve ser tornada por referencia indicado³±±
±±³          ³       se a chave de pesquisa busca uma familia ou um codigo³±±
±±³          ³       completo de produto.                                 ³±±
±±³          ³ExpL6: Variavel logica opcional utilizada como SoftSeek nas ³±±
±±³          ³       pesquisas.                                           ³±±
±±³          ³ExpL7: Indica se deve ou nao mostrar help se nao localizar  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Function a630SeekSG2(nIndexOrd,cProduto,cChave,cSeekWhile,lFamilia,lSoftSeek,lShowHelp)
Local lRet
Local nTamChave
Local nTamCodSB1
Local cSubChave
Local cAlias        	:= Alias()
Local lNewSearch		:= .F.
Local nTamRef 		:= LEN(cProduto)
Local nTamRot			:= 0
Default cProduto		:= ""
Default cSeekWhile 	:= ""
Default lFamilia		:= .F.
Default lSoftSeek		:= .F.
Default lShowHelp		:= .F.

dbSelectArea("SG2")
dbSetOrder(nIndexOrd)

nTamRot := 1+Len(G2_FILIAL)+nTamRef

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Pesquisa na chave principal                                                ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
lRet := dbSeek(cChave,lSoftSeek)

//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
//³Caso nao localize na chave principal verifica se devera considerar o codigo³
//³de referencia de grade de produto , fazendo nova pesquisa                  ³
//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
If (!lRet .And. MaConsRefG()) .or. __lAutomacao
	nTamCodSB1 := TamSX3("B1_COD")[1]

	If !Empty(cProduto) .And. ( Len(cProduto) == nTamCodSB1 ) .And. (!Empty(A093VldBase(cProduto)) .Or. MatGrdPrrf(@cProduto,.T.))
		If !MatGrdPrrf(@cProduto,.T.) //Se nao tem grade, pega somente o cod. da familia
			cProduto := A093VldBase(cProduto)
		ElseIf MatOrigGrd() == "SBQ" //Como e config com grade, procura tambem a referencia do produto
			lNewSearch := .T.
		EndIf
		cProduto	:= PadR(cProduto,Len(G2_REFGRD))
		cSubChave	:= Substr(cChave,nTamRot)
		cChave		:= Substr(cChave,1,Len(G2_FILIAL)) + cProduto + If(Empty(cSubChave),"",LTRIM(cSubChave))
	Else
		//-- G2_FILIAL+G2_REFGRD     + G2_CODIGO
		//-- 12       +12345678901234  12
		//-- 12        34567890123456  78
	    nTamChave := Len(G2_FILIAL+G2_REFGRD+G2_CODIGO)

	    //-- Ajusta chave de pesquisa de maneira generica
	  	If Len(cChave) > nTamChave
	  		cChave := SubStr(cChave,1,16)+SubStr(cChave,18)
	  	EndIf
	EndIf

	//-- Ajusta indice
	DO CASE
		CASE nIndexOrd == 1
			nIndexOrd := 7
		CASE nIndexOrd == 3
			nIndexOrd := 8
	ENDCASE
	
	If lNewSearch .or. __lAutomacao
		dbSetOrder(nIndexOrd)
		If dbSeek(cChave,lSoftSeek)
			lRet 		:= .T.
			lFamilia 	:= .T.
		Else
			cProduto	:= PadR(A093VldBase(cProduto),Len(G2_REFGRD))
			cSubChave	:= Substr(cChave,17)
			cChave		:= Substr(cChave,1,Len(G2_FILIAL)) + cProduto + If(Empty(cSubChave),"",cSubChave)
		EndIf
	EndIf

	//ÚÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ¿
	//³Pesquisa na chave alternativa (Referencia de grade)                        ³
	//ÀÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ
	If !lRet
		dbSelectArea("SG2")
		dbSetOrder(nIndexOrd)
		If dbSeek(cChave,lSoftSeek)
			lRet 		:= .T.
			lFamilia 	:= .T.
		EndIf
	EndIf
EndIf

//-- Atualiza expressao do bloco de codigo para while
If lRet .And. !Empty(cSeekWhile)
	cSeekWhile := a630CondSG2(lFamilia,cChave,cSeekWhile)
EndIf

//-- Verifica se deve mostrar help informando que nao encontrou o roteiro
If !lRet .And. lShowHelp
	Help(" ",1,"A630ROTNAE")
EndIf

dbSelectArea(cAlias)
Return ( lRet )




/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Funcao    ³a630WhSG2 ³ Autor ³Erike Yuri da Silva    ³ Data ³07.04.07  ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³Confeverte a chave de condicao para utilizacao no While     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Retorno   ³ExpC1: Chave de condicao convertida para uso no while       ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ExpL1: Variavel que deve ser tornada por referencia indicado³±±
±±³          ³       se a chave de pesquisa busca uma familia ou um codigo³±±
±±³          ³       completo de produto.                                 ³±±
±±³          ³ExpC1: Chave de pesquisa                                    ³±±
±±³          ³ExpC2: Chave de pesquisa que sera convertida para formato   ³±±
±±³          ³       de bloco de codigo, que retornara por referencia e   ³±±
±±³          ³       podera ser utilizado em Lacos do tipo while.         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³   DATA   ³ Programador   ³Manutencao Efetuada                         ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³          ³               ³                                            ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/      
Function a630CondSG2(lFamilia,cChave,cSeekWhile)
Local nTamChave
Default cSeekWhile 	:= ""
Default lFamilia	:= .F.

If lFamilia	
	//-- Troca chave de pesquisa para while
	cSeekWhile := StrTran(cSeekWhile,"G2_PRODUTO","G2_REFGRD")	
EndIf

//-- Descubro o tamanho da chave de pesquisa para cortar posteriormente com PadR, para evitar "z" 
//-- em buscas incrementais que possam interferir no bloco do While.
nTamChave := Len(SG2->(&cSeekWhile))

//-- Atualiza expressao do bloco de codigo para while
cSeekWhile := "{||"+cSeekWhile+"=='"+PadR(cChave,nTamChave)+"'}"

Return ( cSeekWhile )

/*
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o	 ³ MA630VALD³ Autor ³ Felipe Nunes de Toledo³ Data ³07/11/07 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Verifica se existem Ops em Abertas utilizando o Roteiro   ³±±
±±³          ³ de Operacoes, com apontamentos parciais na tabela SH6.    ³±±
±±³          ³ (.T.) => Nao possui / (.F.) => Possui                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Sintaxe   ³A630ValDel(cProduto,cRoteiro)								 ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Uso		 ³ Mata630													 ³±±
±±ÀÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÙ±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
*/
Function A630ValDel(cProduto,cRoteiro)
Local lRet  := .T.
Local aArea := GetArea()
Local cAliasQry := ""
Local cQuery    := ""

If ExistBlock("MA630VLE")
	lRet := ExecBlock("MA630VLE",.F.,.F.)
	If ValType(lRet) # "L"
		lRet := .T.
	EndIf
	
	Return lRet
EndIf

cAliasQry := GetNextAlias()
cQuery := "SELECT SH6.H6_OP FROM "+RetSqlName("SC2")+" SC2 "
cQuery += "JOIN "+RetSqlName("SH6")+" SH6 ON SH6.H6_FILIAL = '"+xFilial("SH6")+"' AND SH6.D_E_L_E_T_ = '' AND "
cQuery += "SH6.H6_OP = SC2.C2_NUM || SC2.C2_ITEM || SC2.C2_SEQUEN || SC2.C2_ITEMGRD "
cQuery += "WHERE SC2.D_E_L_E_T_ = '' AND SC2.C2_FILIAL  = '"+xFilial("SC2")+"' AND "
cQuery += "SC2.C2_PRODUTO = '"+cProduto+"' AND SC2.C2_ROTEIRO = '"+cRoteiro+"' AND SC2.C2_DATRF  = '' "

cQuery := ChangeQuery(cQuery)
dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasQry,.T.,.T.)

If (cAliasQry)->(!Eof())
    	Aviso(OemToAnsi(STR0012),STR0043,{STR0027}) //"Atençäo" ## "Roteiro\Operação não podera ser excluido. Existem produções em andamento utilizando esse Roteiro\Operação" ## "Ok"
	lRet:=.F.
EndIf
dbSelectArea(cAliasQry)
dbCloseArea()

RestArea( aArea )
Return( lRet )

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ A630TOKR ºAutor  ³Andre Anjos         º Data ³  26/01/09   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Valida aCols de recursos restritivos                       º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA630                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function A630TOKR()
Local lRet := .T.

// Busca nao deletado e com recurso preenchido
If aScan(aCols,{|x| !(x[Len(aHeader)+1]) .And. !Empty(x[GDFieldPos("HJ_RECURSO")])}) == 0
	Aviso(STR0012,STR0044,{"&Ok"})
	lRet := .F.
EndIf

Return lRet   

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³A630CombLiºAutor  ³Guadalupe Santacruz º Data ³  12/17/10   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Funcao que retorna as opcoes de combo para tipo de linha.  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºRetorno   ³ aRet: array com as opcoes de combo.						  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA630													  º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A630CombLi()
Local cCombo := ""
Local nPosPc := 0
Local aValor := {' '}
Local aDescr := {' '}

SX3->(dbSetOrder(2))
If SX3->(dbSeek("G2_TPLINHA"))
	cCombo := AllTrim(X3Cbox())
	nPosPc := Len(cCombo)
	While nPosPc <> 0
		aAdd(aValor,Substr(cCombo,At("=",cCombo)-1,1))
		nPosPc := At(";",cCombo)
		If nPosPc == 0
			aAdd(aDescr,Substr(cCombo,At("=",cCombo)+1,Len(cCombo)))
		Else
			aAdd(aDescr,Substr(cCombo,At("=",cCombo)+1,nPosPc-3))
		EndIf
		If !Empty(nPospc)
			cCombo := Substr(cCombo,nPosPc+1,Len(cCombo))
		EndIf	           
	End
EndIf
		
Return {aValor,aDescr}

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³MT630VlDepºAutor  ³Guadalupe Santacruz º Data ³  17/12/10   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Inicializa a descricao do departamento.                    º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºRetorno   ³ lRet: validacao do campo G2_DEPTO.						  º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA630                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Function MT630VlDep()
Local nPosDesc := GdFieldPos("G2_DESCRI",aHeader)
Local lRet 	   := .T.
Default cDep :=  ''

If !__lAutomacao
	cDep := &(ReadVar())
EndIf

SX5->(dbSetOrder(1))
If SX5->(dbSeek(xFilial("SX5")+"OP"+cDep))
   aCols[n,nPosDesc] := X5Descri()
Else                            
   aCols[n,nPosDesc] := ""  
EndIf

Return lRet


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³A630ExecCh ºAutor  ³ Leonardo Quintania º Data ³  30/12/11   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Faz chamada da edicao de Check List 				           º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºParametros³ nOpc: operacao em execucao						           º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA631                                                     º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A630ExecCh(nOpc)
Local lBkpInc   := INCLUI
Local lBkpAlt   := ALTERA

SGR->(dbSetOrder(1))
SGR->(dbSeek(xFilial("SGR")+c630Prod+c630Cod+aCols[n,GDFieldPos("G2_OPERAC")]))
If nOpc == 3 .Or. nOpc == 4 //Incluir ou alteracao
	If aScan(aItensChk,{|x| x[1] == aCols[n,GDFieldPos("G2_OPERAC")]}) > 0
		FWExecView(STR0052,"MATA631",MODEL_OPERATION_UPDATE,,{|| .T. },,,,,,,A631SetVal()) //-- Altera Check List
	Else
		FWExecView(STR0052,"MATA631",MODEL_OPERATION_INSERT,,{|| .T. },,,,,,,A631SetVal()) //-- Inclui Check List
	EndIf
ElseIf SGR->(Found())
	FWExecView(STR0052,"MATA631",1,,{|| .T.}) //-- Visualiza Check List
Else 
	Aviso(STR0050,STR0051,{"OK"}) //"Não há check list cadastrado para este item"
EndIf

INCLUI := lBkpInc
ALTERA := lBkpAlt

Return

/*/
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³A631SetVal ³ Autor ³Leonardo Quintania    ³ Data ³27/12/2011³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Realiza Load do model para enviar dados para a View        ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Nenhum                                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±ºUso       ³ MATA631                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function A631SetVal()
Local oModel    := FWLoadModel( "MATA631" )
Local oGrid     := oModel:GetModel("MATA631_SGR")
Local nPos	    := 0
Local nX	    := 0
Local nY	    := 0
Local aCpsModel := oGrid:GetStruct():GetFields()
Local nPosDesc 	:= GdFieldPos("G2_DESCRI",aHeader)

//-- Cria o objeto de View
oModel:SetOperation(3)                                 
oModel:Activate() 
oModel:SetValue("MATA631_CAB","GR_PRODUTO", c630Prod)                                                        
oModel:SetValue("MATA631_CAB","GR_ROTEIRO", c630Cod) 
oModel:SetValue("MATA631_CAB","GR_OPERAC" , aCols[n,nPosOper])
oModel:SetValue("MATA631_CAB","GR_DESCOP", aCols[n,nPosDesc])  

nPos := aScan(aItensChk,{|x| x[1] == aCols[n,GDFieldPos("G2_OPERAC")]})
 
If !Empty(nPos)
	For nX := 1 To Len(aItensChk[nPos,2])
		If nX > 1
			oGrid:AddLine()
			oGrid:GoLine(oGrid:Length())
		EndIf
		For nY := 1 To Len(aItensChk[nPos,2,nX])
			If aScan(aCpsModel,{|x| x[3] == SGR->(FieldName(nY))}) > 0
				FwFldPut(SGR->(FieldName(nY)),aItensChk[nPos,2,nX,nY])
			EndIf
		Next nY
		If aTail(aItensChk[nPos,2,nX])
			oGrid:DeleteLine()
		EndIf
	Next nX
EndIf

Return oModel

/*/
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÚÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÂÄÄÄÄÄÄÂÄÄÄÄÄÄÄÄÄÄ¿±±
±±³Fun‡…o    ³LoadSGR	 ³ Autor ³Leonardo Quintania    ³ Data ³27/12/2011³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÁÄÄÄÄÄÄÁÄÄÄÄÄÄÄÄÄÄ´±±
±±³Descri‡…o ³ Carrega os checklists conforme a operação selecionada      ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±³Parametros³ Nenhum                                                     ³±±
±±ÃÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄ´±±
±±ºUso       ³ MATA630                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
/*/
Static Function LoadSGR(cProduto,cRoteiro)
Local aArea 	 := GetArea()
Local aRet    	 := {}
Local nPosChk 	 := 0
Local nX      	 := 0
Local lCheckList := SuperGetMV("MV_CHKOPER",.F.,.F.)  
Local cOper		 := ""

If lCheckList
	SGR->(dbSetOrder(1))
	SGR->(dbSeek(xFilial("SGR")+cProduto+cRoteiro))
	While !SGR->(EOF()) .And. SGR->(GR_FILIAL+GR_PRODUTO+GR_ROTEIRO) == xFilial("SGR")+cProduto+cRoteiro
		If (nPosChk := aScan(aRet,{|x| x[1] == SGR->GR_OPERAC})) == 0
			aAdd(aRet,{SGR->GR_OPERAC,{}})
			nPosChk := Len(aRet)
		EndIf

		cOper := SGR->GR_OPERAC
		While !SGR->(EOF()) .And. SGR->(GR_FILIAL+GR_PRODUTO+GR_ROTEIRO+GR_OPERAC) == xFilial("SGR")+cProduto+cRoteiro+cOper
			aAdd(aRet[nPosChk,2],Array(SGR->(FCount()) + 1))			
			For nX := 1 To SGR->(FCount())
				aTail(aRet[nPosChk,2])[nX] := SGR->&(FieldName(nX))
			Next nX
			aTail(aTail(aRet[nPosChk,2])) := .F.

			SGR->(dbSkip())
		End	
	End
Endif

RestArea(aArea)

Return aRet

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³A630BlqSHYºAutor  ³ Andre Anjos		 º Data ³  08/03/13   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Bloqueia alteração/exclusao de roteiro vinculado a OP.     º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ MATA630                                                    º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function A630BlqSHY()
Local lRet := .T.

If SuperGetMV("MV_APS",.F.,"") == "TOTVS" .Or. SuperGetMV("MV_INTSFC",.F.,0) == 1
	BeginSQL Alias "TMPSC2"
		SELECT COUNT(*) QTDOPS
		FROM %Table:SC2%
		WHERE %NotDel% AND
			C2_FILIAL = %xFilial:SC2% AND
			C2_PRODUTO = %Exp:SG2->G2_PRODUTO% AND
			C2_ROTEIRO = %Exp:SG2->G2_CODIGO% AND
			C2_DATRF = %Exp:Space(8)%
		
		UNION
		
		SELECT COUNT(*) QTDOPS
		FROM %Table:SC2% SC2
		JOIN %Table:SB1% SB1 ON
			SB1.%NotDel% AND
			SB1.B1_FILIAL = %xFilial:SB1% AND
			SB1.B1_COD = %Exp:SG2->G2_PRODUTO% AND
			CASE SB1.B1_OPERPAD WHEN '  ' THEN '01' ELSE SB1.B1_OPERPAD END = %Exp:SG2->G2_CODIGO%
		WHERE SC2.%NotDel% AND
			SC2.C2_FILIAL = %xFilial:SC2% AND
			SC2.C2_PRODUTO = %Exp:SG2->G2_PRODUTO% AND
			SC2.C2_ROTEIRO = %Exp:CriaVar("G2_CODIGO",.F.)% AND
			SC2.C2_DATRF = %Exp:Space(8)%
	EndSQL
	While !TMPSC2->(EOF())
		If !Empty(TMPSC2->QTDOPS)
			lRet := .F.
			Exit
		EndIf
		TMPSC2->(dbSkip())
	End
	TMPSC2->(dbCloseArea())

	If !lRet
		Help(" ",1,"EMUSO",,STR0062,1) //-- Este roteiro está sendo utilizado em OPs e não poderá ser alterado.
	EndIf
EndIf

Return lRet

/*--------------------------------------------------------
Data:  15/04/2014
Autor: Lucas Pereira
Obj:   Validar se o código da operação já existe na base.
----------------------------------------------------------*/
Function A630ValOpe()
Local aArea := GetArea()
Local cOperac := ''

If !__lAutomacao
	cOperac := M->G2_OPERAC
EndIf

	DbSelectArea("SG2")
	if MatGrdPrrf(c630Prod)
		DbSetOrder(7)
		if GdFieldGet( "G2_OPERAC" ) <> cOperac
			If dbSeek(xFilial("SG2")+c630RefGrd+c630Cod+cOperac) .And. (SG2->G2_OPERAC == cOperac)
				Help(" ",1,"A630OPERJA")
				Return .F.
			EndIf
		EndIf
	else
		DbSetOrder(1)
		if GdFieldGet( "G2_OPERAC" ) <> cOperac
			If dbSeek(xFilial("SG2")+c630Prod+c630Cod+cOperac) .And. (SG2->G2_OPERAC == cOperac)
				Help(" ",1,"A630OPERJA")
				Return .F.
			EndIf
		EndIf
	EndIf
	
RestArea(aArea)
Return .T.
